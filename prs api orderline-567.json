{"createdAt":"2023-10-27T10:39:45.683Z","updatedAt":"2023-11-02T09:05:33.000Z","id":"567","name":"PRS API OrderLine","active":true,"nodes":[{"parameters":{},"id":"c0c4a304-6a48-4a48-a9ee-7d43faa0cecb","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[540,860]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"api","value":"https://dstt.postmart.vn/api/prs/v2/"},{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"},{"name":"modules[0]","value":"salesOrder"},{"name":"modules[1]","value":"purchasesOrder"},{"name":"modules[2]","value":"goodsReceipt"},{"name":"apiCom","value":"https://dstt.postmart.com.vn/api/prs/v2/"}],"number":[{"name":"limit","value":100}]},"options":{}},"id":"f67208c0-049c-41e9-a393-a3430402a88a","name":"meta","type":"n8n-nodes-base.set","typeVersion":2,"position":[760,860]},{"parameters":{"fieldToSplitOut":"modules","options":{"destinationFieldName":"module"}},"id":"b39ac54b-a182-42da-a022-533544eaea6d","name":"ModuleLists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[980,860]},{"parameters":{"rule":{"interval":[{"field":"seconds","secondsInterval":150}]}},"id":"e24d6f6c-74a0-49f9-af17-8b3c4e9c6b6e","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[540,1120]},{"parameters":{"options":{}},"id":"aee48755-1eb5-4842-a075-05048163cf6e","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[1680,760]},{"parameters":{"batchSize":1,"options":{"reset":"={{ $('SplitModules').context[\"noItemsLeft\"] }}"}},"id":"8fc3e44b-a345-43ec-a35c-48f44593e11f","name":"SplitModules","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1240,860]},{"parameters":{"url":"={{ $('meta').item.json.api }}sync-data/{{ $('Set').item.json.module }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"={{ $('meta').item.json.limit }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"21f6fa1a-1c65-4dc3-b886-ca0f9881deb5","name":"getDataApi","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1920,760],"retryOnFail":true},{"parameters":{"fieldToSplitOut":"body.data.result","options":{"destinationFieldName":"lines"}},"id":"a0001a63-fb4d-402c-a0b3-9e0c8f2cd457","name":"Item Lists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[2140,760]},{"parameters":{"batchSize":1,"options":{"reset":"={{ $('Split1order').context[\"noItemsLeft\"] }}"}},"id":"e4c28424-1ce4-4635-9e91-8895f3636197","name":"Split1order","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[2360,760]},{"parameters":{"conditions":{"boolean":[{"value1":true,"value2":"={{ $('Split1order').context[\"noItemsLeft\"] }}"}]}},"id":"cf9947e8-e6b7-442c-8964-e9a620023a54","name":"IFDoneOrderLine","type":"n8n-nodes-base.if","typeVersion":1,"position":[2820,500]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"error"}]}},"id":"3ff6bd23-dcc3-4ba7-8680-ad45f5c6dbee","name":"ifEmptyData","type":"n8n-nodes-base.if","typeVersion":1,"position":[2140,980]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"error"}]}},"id":"5dca4ede-f12b-487b-b9cc-df5d7693ddc4","name":"ifError","type":"n8n-nodes-base.if","typeVersion":1,"position":[2840,740]},{"parameters":{"chatId":"=-548413896","text":"=PRS OrderLines -- ERR\n{{ $('Split1order').item.json.lines.order_id }}\n{{ $json.body.message }}","additionalFields":{}},"id":"9432dac4-7f19-4bb8-bdcd-d42711136080","name":"Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[3060,720],"credentials":{"telegramApi":{"id":"85","name":"Telegram account"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.module }}","operation":"isNotEmpty"}]}},"id":"d2bd4ed9-4fd0-4f69-97b6-d5863186fb44","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[1480,780]},{"parameters":{"method":"POST","url":"={{ $('meta').item.json.apiCom }}contents/{{ $('Set').item.json.module }}Products","sendQuery":true,"queryParameters":{"parameters":[{"name":"bulk_insert","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.lines }}","options":{"response":{"response":{"fullResponse":true}}}},"id":"eadbb6c9-bbc5-4bfb-b8f9-a81a95852b40","name":"AddOrderLine","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2600,740],"retryOnFail":true}],"connections":{"When clicking \"Execute Workflow\"":{"main":[[{"node":"meta","type":"main","index":0}]]},"meta":{"main":[[{"node":"ModuleLists","type":"main","index":0}]]},"ModuleLists":{"main":[[{"node":"SplitModules","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"meta","type":"main","index":0}]]},"SplitModules":{"main":[[{"node":"IF","type":"main","index":0}]]},"Set":{"main":[[{"node":"getDataApi","type":"main","index":0}]]},"getDataApi":{"main":[[{"node":"Item Lists","type":"main","index":0},{"node":"ifEmptyData","type":"main","index":0}]]},"Item Lists":{"main":[[{"node":"Split1order","type":"main","index":0}]]},"Split1order":{"main":[[{"node":"AddOrderLine","type":"main","index":0}]]},"IFDoneOrderLine":{"main":[[{"node":"SplitModules","type":"main","index":0}],[{"node":"Split1order","type":"main","index":0}]]},"ifEmptyData":{"main":[[{"node":"SplitModules","type":"main","index":0}]]},"ifError":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"IF":{"main":[[{"node":"Set","type":"main","index":0}]]},"AddOrderLine":{"main":[[{"node":"IFDoneOrderLine","type":"main","index":0},{"node":"ifError","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"9c401df0-ba94-47c2-989b-312a55e42140","triggerCount":1,"tags":[]}