{"createdAt":"2023-07-19T04:15:51.284Z","updatedAt":"2023-08-31T01:31:44.000Z","id":"193","name":"Enroll Thinkific","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"thinkific","options":{}},"id":"0e17f16b-7fe9-4e42-9e14-820da97e8e50","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[40,900],"webhookId":"e315873f-1073-4606-909e-254bac1c6bb5"},{"parameters":{"conditions":{"number":[{"value1":"={{ $json.items[0].id }}","operation":"isNotEmpty"}]}},"id":"2f1011a7-5028-4574-94e6-75ca6b417a6d","name":"Chua co tk?","type":"n8n-nodes-base.if","typeVersion":1,"position":[1040,900]},{"parameters":{"method":"POST","url":"=https://api.quanchatbot.com/thinkific/new-user.php","sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"first_name","value":"={{ $node.Webhook.json.body.first_name }}"},{"name":"last_name","value":"={{ $node.Webhook.json.body.last_name }}"},{"name":"email","value":"={{ $node.Webhook.json.body.email }}"},{"name":"phone","value":"={{ $node.Webhook.json.body.phone }}"},{"name":"messid","value":"={{ $node.Webhook.json.body.messid }}"},{"name":"password","value":"={{ $node.Webhook.json.body.password }}"}]},"options":{}},"id":"b00b93e2-3830-4cf9-9730-38022b02082e","name":"New User","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[80,1160],"disabled":true,"continueOnFail":true},{"parameters":{"url":"=https://api.thinkific.com/api/public/v1/users?query[email]={{ $node.Webhook.json.body.email }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"options":{}},"id":"fb3188fd-e64f-4b00-8383-b0abb276390e","name":"Check da co tk?","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[900,900],"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $node.Webhook.json.body.type }}","value2":"course"}]}},"id":"641e2d0a-0772-4b1f-a80f-35eeb4015d3d","name":"is Course","type":"n8n-nodes-base.if","typeVersion":1,"position":[1260,920]},{"parameters":{"conditions":{"string":[{"value1":"={{ $node.Webhook.json.body.type }}","value2":"bundle"}]}},"id":"06ca0799-c8ed-4245-b04f-45056cd0e083","name":"is Bundle","type":"n8n-nodes-base.if","typeVersion":1,"position":[1460,1000]},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/enrollments","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"course_id\": {{ $node.Webhook.json.body.learning_id }},\n  \"user_id\": {{ $node[\"Check da co tk?\"].json[\"items\"][0][\"id\"] }},\n  \"activated_at\": \"{{ $node[\"Now Year\"].json[\"NowYear\"] }}T01:01:00Z\",\n  \"expiry_date\": \"{{ $node[\"Add 1 Year\"].json[\"NextYear\"] }}T01:01:00Z\"\n}","options":{}},"id":"2f6543a0-a491-429b-9229-52eb908f6a95","name":"Enroll Course","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1460,800],"retryOnFail":true,"executeOnce":false,"continueOnFail":true},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/bundles/{{ $node.Webhook.json.body.learning_id }}/enrollments","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={  \n  \"user_id\": {{ $json[\"items\"][0][\"id\"] }},\n  \"activated_at\": \"{{ $node[\"Now Year\"].json[\"NowYear\"] }}T01:01:00Z\",\n  \"expiry_date\": \"{{ $node[\"Add 1 Year\"].json[\"NextYear\"] }}T01:01:00Z\"\n}","options":{"response":{"response":{"fullResponse":true,"responseFormat":"json"}}}},"id":"a24e5e29-48b4-421e-bcbe-82a785abcb3f","name":"Enroll Bundle","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1660,1000],"notesInFlow":false,"retryOnFail":false,"alwaysOutputData":true,"continueOnFail":true},{"parameters":{"value":"={{ $now }}","dataPropertyName":"NowYear","toFormat":"YYYY-MM-DD","options":{}},"id":"908acc46-dd38-4b95-a5c1-c66a93f8524d","name":"Now Year","type":"n8n-nodes-base.dateTime","typeVersion":1,"position":[380,900]},{"parameters":{"value":"={{ $now.plus(1, 'year') }}","dataPropertyName":"NextYear","toFormat":"YYYY-MM-DD","options":{}},"id":"4baffa5c-e9e7-4a18-9d0e-4710a20aaa41","name":"Add 1 Year","type":"n8n-nodes-base.dateTime","typeVersion":1,"position":[540,900]},{"parameters":{"conditions":{"string":[{"value1":"={{ $node.Webhook.json.body.type }}","value2":"course"}]}},"id":"887a91d3-591f-4624-8c7d-000541760eca","name":"is Course1","type":"n8n-nodes-base.if","typeVersion":1,"position":[800,560],"disabled":true},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/enrollments","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"course_id\": {{ $node[\"Webhook\"].json[\"body\"][\"learning_id\"] }},\n  \"user_id\": {{ $node[\"New User2\"].json[\"id\"] }},\n  \"activated_at\": \"{{ $node[\"Now Year\"].json[\"NowYear\"] }}T01:01:00Z\",\n  \"expiry_date\": \"{{ $node[\"Add 1 Year\"].json[\"NextYear\"] }}T01:01:00Z\"\n}","options":{}},"id":"60849a74-2a95-41f2-bce7-be3982101528","name":"Enroll Course1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1040,500],"disabled":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $node.Webhook.json.body.type }}","value2":"bundle"}]}},"id":"8006c285-b27a-49ac-83ef-b76a0321b32e","name":"is Bundle1","type":"n8n-nodes-base.if","typeVersion":1,"position":[1080,680],"disabled":true},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/bundles/{{ $node[\"Webhook\"].json[\"body\"][\"learning_id\"] }}/enrollments ","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={  \n  \"user_id\": {{ $node[\"New User2\"].json[\"id\"] }},\n  \"activated_at\": \"{{ $node[\"Now Year\"].json[\"NowYear\"] }}T01:01:00Z\",\n  \"expiry_date\": \"{{ $node[\"Add 1 Year\"].json[\"NextYear\"] }}T01:01:00Z\"\n}","options":{}},"id":"dc5ab4e7-5150-49f6-84e8-0cf3bee1c49a","name":"Enroll Bundle1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1260,620],"disabled":true},{"parameters":{},"id":"55272fcb-e5cc-4f67-8240-bb4597de1727","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[480,1180],"disabled":true},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/users","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={   \"first_name\": \"{{ $node[\"Webhook\"].json[\"body\"][\"first_name\"] }}\",   \"last_name\": \"{{ $node[\"Webhook\"].json[\"body\"][\"last_name\"] }}\",   \"email\": \"{{ $node[\"Webhook\"].json[\"body\"][\"email\"] }}\",   \"password\": \"TG2023@TTL\",    \"bio\": \"{{ $node.Webhook.json.body.first_name }} {{ $node[\"Webhook\"].json[\"body\"][\"last_name\"] }}\",   \"company\": \"TTL\",   \"headline\": \"Student\", \"custom_profile_fields\": [     {       \"value\": \"{{$node[\"Webhook\"].json[\"body\"][\"phone\"]}}\",       \"custom_profile_field_definition_id\": 67351     },  {       \"value\": \"{{$node[\"Webhook\"].json[\"body\"][\"messid\"]}}\",       \"custom_profile_field_definition_id\": 67352     }   ],   \"skip_custom_fields_validation\": false,   \"send_welcome_email\": true }","options":{}},"id":"7570592e-4a02-46f8-a449-de0228115aba","name":"New User1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[320,1160],"disabled":true},{"parameters":{"method":"POST","url":"=https://api.quanchatbot.com/thinkific/new-user.php","sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"first_name","value":"={{ $node.Webhook.json.body.first_name }}"},{"name":"last_name","value":"={{ $node.Webhook.json.body.last_name }}"},{"name":"email","value":"={{ $node.Webhook.json.body.email }}"},{"name":"phone","value":"={{ $node.Webhook.json.body.phone }}"},{"name":"messid","value":"={{ $node.Webhook.json.body.messid }}"},{"name":"password","value":"={{ $node.Webhook.json.body.password }}"}]},"options":{}},"id":"7ad45a75-8b98-457a-a2ef-20436268c485","name":"New User2","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[380,580],"disabled":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.data }}","operation":"contains","value2":"has already been taken"},{"value1":"{{ $json.data }}","operation":"contains","value2":"Error creating user"}]},"combineOperation":"any"},"id":"e9dcfd0d-1a2a-41a0-adb3-ec1e2e6deb70","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[580,560],"disabled":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.email }}","operation":"regex","value2":"(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])"}]}},"id":"963b5ec2-7fea-4463-957b-abd2119a1f2c","name":"IF2","type":"n8n-nodes-base.if","typeVersion":1,"position":[220,900]},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/bundles/{{ $node.Webhook.json.body.learning_id }}/enrollments","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={  \n  \"user_id\": {{ $json[\"items\"][0][\"id\"] }},\n  \"activated_at\": \"{{ $node[\"Now Year\"].json[\"NowYear\"] }}T01:01:00Z\",\n  \"expiry_date\": \"{{ $node[\"Add 1 Year\"].json[\"NextYear\"] }}T01:01:00Z\"\n}","options":{}},"id":"fe91075c-0ed4-4693-be72-801ee0658046","name":"Enroll Bundle2","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1780,1220],"notesInFlow":false,"retryOnFail":true,"continueOnFail":true},{"parameters":{"conditions":{"string":[{}]}},"id":"161622a6-2c2b-4f99-a11e-429a0033c59a","name":"IF3","type":"n8n-nodes-base.if","typeVersion":1,"position":[1580,1200],"continueOnFail":true},{"parameters":{"method":"POST","url":"=https://api.thinkific.com/api/public/v1/users","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Auth-API-Key","value":"20c0d3dae7a7bf515967a24ad97f7bc2"},{"name":"X-Auth-Subdomain","value":"hita"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={   \n\t\"first_name\": \"{{ $('Webhook').item.json[\"body\"][\"first_name\"].toUpperCase() }}\",   \n\t\"last_name\": \"{{ $('Webhook').item.json[\"body\"][\"last_name\"].toUpperCase() }}\",   \n\t\"email\": \"{{ $('Webhook').item.json[\"body\"][\"email\"] }}\",   \n\t\"password\": \"TG2023@TTL\",    \n\t\"bio\": \"{{ $('Webhook').item.json[\"body\"][\"first_name\"] }} {{ $('Webhook').item.json[\"body\"][\"last_name\"] }}\",   \n\t\"company\": \"TTL\",   \n\t\"headline\": \"Student\", \n\t\"custom_profile_fields\": [     \n\t{       \n\t\t\"value\": \"{{ $('Webhook').item.json[\"body\"][\"phone\"] }}\",       \n\t\t\"custom_profile_field_definition_id\": 67351     \n\t\t},  \n\t\t{       \n\t\t\"value\": \"{{ $('Webhook').item.json[\"body\"][\"messid\"] }}\",       \n\t\t\"custom_profile_field_definition_id\": 67352     \n\t\t\t}   ],  \n\t\"skip_custom_fields_validation\": false,   \n\t\"send_welcome_email\": true\n\t}","options":{}},"id":"b0052bb4-6916-4430-9f0a-05923589eefa","name":"Check da co tk?1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[720,900],"retryOnFail":true,"continueOnFail":true},{"parameters":{"amount":10,"unit":"seconds"},"id":"aefc1a9d-50cd-4b22-aa8d-f44d20372988","name":"Wait","type":"n8n-nodes-base.wait","typeVersion":1,"position":[1260,1120],"webhookId":"ceb5595e-10f2-4343-81c2-ca2bd83ebdde"}],"connections":{"Webhook":{"main":[[{"node":"IF2","type":"main","index":0}]]},"Chua co tk?":{"main":[[{"node":"is Course","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Check da co tk?":{"main":[[{"node":"Chua co tk?","type":"main","index":0}]]},"is Course":{"main":[[{"node":"Enroll Course","type":"main","index":0}],[{"node":"is Bundle","type":"main","index":0}]]},"is Bundle":{"main":[[{"node":"Enroll Bundle","type":"main","index":0}]]},"Now Year":{"main":[[{"node":"Add 1 Year","type":"main","index":0}]]},"Add 1 Year":{"main":[[{"node":"Check da co tk?1","type":"main","index":0}]]},"is Course1":{"main":[[{"node":"Enroll Course1","type":"main","index":0}],[{"node":"is Bundle1","type":"main","index":0}]]},"is Bundle1":{"main":[[{"node":"Enroll Bundle1","type":"main","index":0}]]},"New User1":{"main":[[{"node":"IF","type":"main","index":0}]]},"IF1":{"main":[[],[{"node":"is Course1","type":"main","index":0}]]},"IF2":{"main":[[{"node":"Now Year","type":"main","index":0}]]},"Check da co tk?1":{"main":[[{"node":"Check da co tk?","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Check da co tk?1","type":"main","index":0}]]}},"settings":{"saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","executionTimeout":300},"staticData":null,"pinData":{"Webhook":[{"json":{"headers":{"host":"n8.quanchatbot.com","user-agent":"WordPress/6.2.2; https://5ptb.vn","content-length":"138","accept":"*/*","accept-encoding":"deflate, gzip, br","content-type":"application/x-www-form-urlencoded","x-forwarded-for":"103.173.227.161","x-forwarded-host":"n8.quanchatbot.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cc3a1a76fa48","x-real-ip":"103.173.227.161"},"params":{},"query":{},"body":{"first_name":"HV","last_name":"Le Quan Le","email":"quanchatbot@gmail.com","phone":"+84985767138","password":"TG2023@TTL","type":"bundle","learning_id":"114378"}},"pairedItem":{"item":0}}]},"versionId":"962b74e9-1bd4-472c-8f84-950420949188","triggerCount":1,"tags":[]}