{"createdAt":"2023-08-03T14:03:23.628Z","updatedAt":"2023-08-06T12:32:47.000Z","id":"449","name":"ATM_Send","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"atm","options":{}},"id":"c978d593-1395-4019-821b-52505241648c","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-240,-240],"webhookId":"2bbae009-b8ef-41a3-ba52-9dcb29b809b7"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal/","sendBody":true,"specifyBody":"json","jsonBody":"={ \"app_id\" : \"cli_a43f02058738d0099\",\n \"app_secret\" : \"ayBQyWmXTY2f1Js58pU1XdVIDrzqYDA2\" } ","options":{}},"id":"b8270881-5186-46ae-bdcc-7025cda541b4","name":"app_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[60,-240]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/Ofw7bK2PLaObBBsdvrBuCxJ7s3g/tables/tbl5NOLh9LCfYkOo/records/batch_create\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_token').item.json.app_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":\n{{ JSON.stringify($('CV').first().json.records) }}}","options":{}},"id":"b1e7c8bc-ec33-4228-aa9f-ff350a60f1c7","name":"Update record","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[480,-260]},{"parameters":{"jsCode":"// Hàm chuyển đổi chuỗi đầu vào thành chuỗi JSON\nfunction transformToJSON(items) {\n  const mnvArray = items.mnv.split(\",\");\n  const hotenArray = items.hoten.split(\",\");\n  const cmndArray = items.cmnd.split(\",\");\n  const stkArray = items.stk.split(\",\");\n  const cnArray = items.cn.split(\",\");\n  const mdaArray = items.mda.split(\",\");\n  const resultArray = [];\n\n  for (let i = 0; i < Math.min(mnvArray.length); i++) {\n    const obj = {\n      fields: {\n        \"Mã NV\": mnvArray[i],\n        \"Họ tên\": hotenArray[i],\n        \"CMND\": cmndArray[i],\n        \"Số TK\": stkArray[i],\n        \"Tên Chi nhánh\": cnArray[i],\n        \"Mã Dự án\": mdaArray[i]\n        \n      },\n    };\n    resultArray.push(obj);\n  }\n\n  return resultArray;\n}\n\n// Chuỗi đầu vào\nconst inputString = $node[\"Webhook\"].json[\"body\"];\n\n// Thực hiện chuyển đổi và trả về kết quả\nconst result = transformToJSON(inputString);\nreturn { records: result };\n"},"id":"46cb6675-c651-4b7c-b747-9fd506235a3e","name":"CV","type":"n8n-nodes-base.code","typeVersion":1,"position":[-80,-240]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').item.json.body.mnv }}","operation":"isNotEmpty"}]},"combineOperation":"any"},"id":"f5e73842-539b-4e7d-9e6f-2dfc9b0ebc21","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[200,-240]}],"connections":{"Webhook":{"main":[[{"node":"CV","type":"main","index":0}]]},"app_token":{"main":[[{"node":"IF1","type":"main","index":0}]]},"CV":{"main":[[{"node":"app_token","type":"main","index":0}]]},"IF1":{"main":[[{"node":"Update record","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"73406a42-cbdb-4693-ad92-b2e0605996ec","triggerCount":1,"tags":[{"createdAt":"2023-08-03T14:03:20.845Z","updatedAt":"2023-08-03T14:03:20.845Z","id":"33","name":"GSATM"}]}