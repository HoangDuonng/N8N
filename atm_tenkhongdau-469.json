{"createdAt":"2023-08-10T09:47:12.732Z","updatedAt":"2023-08-10T10:30:20.000Z","id":"469","name":"ATM_tenkhongdau","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"tenkodau","options":{}},"id":"508f599c-992e-423c-8fe7-8c030585c5cc","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-240,-240],"webhookId":"f6773842-c333-4cb9-91a4-02cae9b01081"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal/","sendBody":true,"specifyBody":"json","jsonBody":"={ \"app_id\" : \"cli_a43f02058738d0099\",\n \"app_secret\" : \"ayBQyWmXTY2f1Js58pU1XdVIDrzqYDA2\" } ","options":{}},"id":"da285e4e-42d1-422c-b18d-08c46bcc32aa","name":"app_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[60,-240]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/Ofw7bK2PLaObBBsdvrBuCxJ7s3g/tables/tblCwQAcBsZMH2sJ/records/batch_create\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_token').item.json.app_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":\n{{ JSON.stringify($('CV').first().json.records) }}}","options":{}},"id":"9269cf85-1e0e-4bdf-92fc-fd6f081035f0","name":"Update record","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[380,-300]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').item.json.query.ctk }}","operation":"isNotEmpty"}]},"combineOperation":"any"},"id":"bb92d416-740c-4abf-8ce9-63a5ca763a79","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[200,-240]},{"parameters":{"jsCode":"// Hàm chuyển đổi chuỗi đầu vào thành chuỗi JSON\nfunction transformToJSON(items) {\n  const ctkArray = items.ctk.split(\",\");\n  const stkArray = items.stk.split(\",\");\n  const resultArray = [];\n\n  for (let i = 0; i < Math.min(ctkArray.length); i++) {\n    const obj = {\n      fields: {\n        \"Tên người thụ hưởng/   Name of Beneficiary    (*)\": ctkArray[i],\n        \"Tài khoản hưởng/Beneficiary Account (*)\": stkArray[i],\n      },\n    };\n    resultArray.push(obj);\n  }\n\n  return resultArray;\n}\n\n// Chuỗi đầu vào\nconst inputString = $node[\"Webhook\"].json[\"query\"];\n\n// Thực hiện chuyển đổi và trả về kết quả\nconst result = transformToJSON(inputString);\nreturn { records: result };\n"},"id":"becb54f0-7b5f-4319-b6aa-bec19452be19","name":"CV","type":"n8n-nodes-base.code","typeVersion":1,"position":[-80,-240]}],"connections":{"Webhook":{"main":[[{"node":"CV","type":"main","index":0}]]},"app_token":{"main":[[{"node":"IF1","type":"main","index":0}]]},"IF1":{"main":[[{"node":"Update record","type":"main","index":0}]]},"CV":{"main":[[{"node":"app_token","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"69a0f8ce-f5ce-448f-8894-7a186668dc98","triggerCount":1,"tags":[{"createdAt":"2023-08-03T14:03:20.845Z","updatedAt":"2023-08-03T14:03:20.845Z","id":"33","name":"GSATM"}]}