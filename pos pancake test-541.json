{"createdAt":"2023-09-23T09:12:28.718Z","updatedAt":"2023-09-23T15:59:16.000Z","id":"541","name":"POS Pancake Test","active":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"1b91679a-ecce-4da8-95fd","options":{}},"id":"5cc752bc-6076-41fb-b3d1-532e9665c114","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-440,660],"webhookId":"958725bd-0229-4694-b9b4-ae6ff804bcc0"},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a4728c89b9b89010"},{"name":"appSecret","value":"VPxBThYjNh7CuRxNnXWQoGXCZmz7NWuP"},{"name":"baseId","value":"AYlRbXuWzaoThTsHtjult88dgMe"},{"name":"tableId","value":"tbl5KkoaZUI12oKE"}]},"options":{}},"id":"1e4b2058-ef4f-491c-99fa-af2bbf996081","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[-220,660]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\" : \"{{ $('Set').item.json[\"appId\"] }}\",\n\"app_secret\" : \"{{ $('Set').item.json[\"appSecret\"] }}\" \n}","options":{}},"id":"4aa30fdd-7d5d-4eec-b844-009f5e41ad2d","name":"get app_access_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[180,660]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{ $('Set').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"product_id\": \"{{ $('Webhook').item.json[\"body\"][\"items\"][0][\"id\"] }}\",\n \"product_name\": \"{{ $('Webhook').item.json[\"body\"][\"items\"][0][\"variation_info\"][\"name\"] }}\",\n    \"quantity\": {{ $('Webhook').item.json[\"body\"][\"items\"][0][\"quantity\"] }},\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"1a1e1e60-bfd5-4ef8-97b1-da6e22674397","name":"Add base","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[740,580]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Get record ID').item.json[\"data\"][\"items\"] }}","operation":"isEmpty"}]}},"id":"d7651f67-f60b-4b9a-aa64-b46e1b3f028f","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[540,660]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records?filter=CurrentValue.[id] = \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"09314925-4b7c-4a0d-9f57-c46212db1931","name":"Get record ID","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[380,660]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records/{{ $('Get record ID').item.json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"product_id\": \"{{ $('Webhook').item.json[\"body\"][\"items\"][0][\"id\"] }}\",\n \"product_name\": \"{{ $('Webhook').item.json[\"body\"][\"items\"][0][\"variation_info\"][\"name\"] }}\",\n    \"quantity\": {{ $('Webhook').item.json[\"body\"][\"items\"][0][\"quantity\"] }},\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"ebe2806b-ccad-4e5d-a63c-36dc784133a4","name":"Update","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[740,760]},{"parameters":{"operation":"formatDate","date":"={{ $('Webhook').item.json[\"body\"][\"updated_at\"] }}","format":"x","options":{}},"id":"a40b6fc5-489f-46b6-9fa6-7f09083a1606","name":"Date & Time","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-40,660]}],"connections":{"Webhook":{"main":[[{"node":"Set","type":"main","index":0}]]},"Set":{"main":[[{"node":"Date & Time","type":"main","index":0}]]},"get app_access_token":{"main":[[{"node":"Get record ID","type":"main","index":0}]]},"IF":{"main":[[{"node":"Add base","type":"main","index":0}],[{"node":"Update","type":"main","index":0}]]},"Get record ID":{"main":[[{"node":"IF","type":"main","index":0}]]},"Date & Time":{"main":[[{"node":"get app_access_token","type":"main","index":0}]]}},"settings":{"saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"525"},"staticData":null,"pinData":{},"versionId":"cff103ad-6221-4230-b058-d91b9ef41629","triggerCount":1,"tags":[]}