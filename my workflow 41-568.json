{"createdAt":"2023-10-28T04:12:52.812Z","updatedAt":"2023-11-20T16:37:52.000Z","id":"568","name":"My workflow 41","active":false,"nodes":[{"parameters":{"documentId":{"__rl":true,"value":"1d-ch9pub1iCvEzvdWBFa9NznBVRmnAfgeSXrp6Z8C5Y","mode":"id"},"sheetName":{"__rl":true,"value":"1494838516","mode":"id"},"options":{}},"id":"3cd057e2-aedd-4518-af1c-34cffd85a360","name":"Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[100,460],"credentials":{"googleSheetsOAuth2Api":{"id":"139","name":"Google Sheets account 3"}}},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nconst output = {\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"config\": {\"wide_screen_mode\": true},\n    \"elements\": [\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"grey\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Tên Tài Khoản**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Sản phẩm**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Tuổi**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Target**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Chi phí / Đơn**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Chi phí / Mess**\"\n              }\n            ]\n          }\n        ]\n      }\n    ],\n    \"header\": {\n      \"template\": \"blue\",\n      \"title\": {\n        \"content\": \"Báo cáo đơn tồn\",\n        \"tag\": \"plain_text\"\n      }\n    }\n  }\n}\n\n\nfor (const item of $input.all()) {\n  let format_item = {\n      \"tag\": \"column_set\",\n      \"flex_mode\": \"none\",\n      \"background_style\": \"grey\",\n      \"columns\": [\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Tên Tài Khoản\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Sản phẩm\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Tuổi\"].toString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Target\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Chi phí / Đơn\"].toLocaleString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Chi phí / mess\"].toLocaleString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        }\n      ]\n    }\n  output['card']['elements'].push(format_item);\n  output['card']['header'].title.content = \"Dữ liệu quảng cáo \" + item.json[\"Tên Tài Khoản\"] + \" - \" + item.json[\"Sản phẩm\"];\n}\n\nreturn {'card': output};"},"id":"3e971668-aeaa-40b9-8322-ec0528651bba","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[560,440]},{"parameters":{"batchSize":1,"options":{"reset":false}},"id":"47973f60-fd57-4019-b1cc-fc012bac38e8","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[320,460]},{"parameters":{"documentId":{"__rl":true,"value":"1d-ch9pub1iCvEzvdWBFa9NznBVRmnAfgeSXrp6Z8C5Y","mode":"id"},"sheetName":{"__rl":true,"value":"0","mode":"id"},"options":{}},"id":"8e3ae3ef-1041-48ed-ae4a-254e6ba53e3c","name":"Google Sheets1","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[100,700],"credentials":{"googleSheetsOAuth2Api":{"id":"139","name":"Google Sheets account 3"}}},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nconst output = {\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"config\": {\"wide_screen_mode\": true},\n    \"elements\": [\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"grey\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Tên sản phẩm**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Ngày tạo đơn**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Số lượng**\"\n              }\n            ]\n          }\n        ]\n      }\n    ],\n    \"header\": {\n      \"template\": \"blue\",\n      \"title\": {\n        \"content\": \"Báo cáo đơn tồn\",\n        \"tag\": \"plain_text\"\n      }\n    }\n  }\n}\n\n\nfor (const item of $input.all()) {\n  let format_item = {\n      \"tag\": \"column_set\",\n      \"flex_mode\": \"none\",\n      \"background_style\": \"grey\",\n      \"columns\": [\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Tên sản phẩm\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Ngày tạo đơn\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Số lượng\"].toLocaleString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        }\n      ]\n    }\n  output['card']['elements'].push(format_item);\n}\n\n// return {'a': output['elements']};\nreturn {'card': output};"},"id":"66293571-dcac-43cf-b84c-e9ef3043833e","name":"Code1","type":"n8n-nodes-base.code","typeVersion":1,"position":[320,700]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal","sendBody":true,"bodyParameters":{"parameters":[{"name":"app_id","value":"cli_a4f2f2539db8d02f"},{"name":"app_secret","value":"nnuHqN4YPTlQcGOduU0C6gpQtgpMkVNk"}]},"options":{}},"id":"4709aea0-9ffb-406e-ba01-5662542eef7c","name":"tenant_access_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[540,900]},{"parameters":{"documentId":{"__rl":true,"value":"1d-ch9pub1iCvEzvdWBFa9NznBVRmnAfgeSXrp6Z8C5Y","mode":"id"},"sheetName":{"__rl":true,"value":"102874219","mode":"id"},"options":{}},"id":"a0fdfffe-80d8-41b3-bec5-f08ec4452284","name":"Google Sheets2","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[100,900],"credentials":{"googleSheetsOAuth2Api":{"id":"139","name":"Google Sheets account 3"}}},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nconst input = $input.all();\nconst output = {records:[]};\nfor (const item of $input.all()){\n  const format_item = {\n    fields: {\n      \"Họ Tên\": item.json[\"Họ Tên\"],\n      \"Lương\": item.json[\"Lương\"] === '-' ? 0 : item.json[\"Lương\"],\n      \"Tiền thưởng\": item.json[\"Tiền thưởng\"] === '-' ? 0 : item.json[\"Tiền thưởng\"],\n      \"Chốt đơn\": item.json[\"Chốt đơn\"] === '-' ? 0 : item.json[\"Chốt đơn\"],\n      \"Tổng lương\": item.json[\"Tổng lương\"] === '-' ? 0 : item.json[\"Tổng lương\"],\n      \"Ghi chú\": item.json[\"Ghi chú\"] === '-' ? \"\" : item.json[\"Ghi chú\"]\n    }\n  }\n  output.records.push(format_item);\n}\nreturn {output: output};"},"id":"8c80bdb8-d5b3-45ad-b08f-eda850201a44","name":"Code2","type":"n8n-nodes-base.code","typeVersion":1,"position":[320,900]},{"parameters":{"rule":{"interval":[{}]}},"id":"a3a06306-97f4-4809-94ec-1c964dcb56fa","name":"Trigger Dữ liệu","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-120,900]},{"parameters":{"rule":{"interval":[{"triggerAtHour":7}]}},"id":"7802478b-1fae-43f4-83f1-996f8a57c239","name":"Trigger Dữ Liệu vào 7 AM","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-120,700]},{"parameters":{"rule":{"interval":[{"triggerAtHour":7}]}},"id":"30ab95b2-fa31-4b21-9b95-2cab03f05d01","name":"Trigger Dữ liệu khi Click","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-120,460]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bitable/v1/apps/TYteb8DQSaTPgssXZm5lci8Dgmg/tables/tbl9Uh4BJ3PY3nkJ/records/batch_create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json.tenant_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Code2').item.json.output }}","options":{}},"id":"e23577eb-4b50-4e6d-b852-201e35645eba","name":"Lưu dữ liệu Lark Base","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[760,900]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/6e4b3103-5b59-47ec-adb4-63ba3168403a","sendBody":true,"specifyBody":"json","jsonBody":"={{$json.card}}","options":{}},"id":"3d4b0b03-8850-4316-b642-1c92b2c70673","name":"Bot nhắn tin vào nhóm","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[760,440]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/6e4b3103-5b59-47ec-adb4-63ba3168403a","sendBody":true,"specifyBody":"json","jsonBody":"={{$json.card}}","options":{}},"id":"232afcd4-0244-415c-b224-6fea302e357b","name":"Bot nhắn tin vào nhóm1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[540,700]}],"connections":{"Google Sheets":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"Code":{"main":[[{"node":"Bot nhắn tin vào nhóm","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"Code","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Bot nhắn tin vào nhóm1","type":"main","index":0}]]},"tenant_access_token":{"main":[[{"node":"Lưu dữ liệu Lark Base","type":"main","index":0}]]},"Google Sheets2":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"tenant_access_token","type":"main","index":0}]]},"Trigger Dữ liệu":{"main":[[{"node":"Google Sheets2","type":"main","index":0}]]},"Trigger Dữ Liệu vào 7 AM":{"main":[[{"node":"Google Sheets1","type":"main","index":0}]]},"Trigger Dữ liệu khi Click":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Bot nhắn tin vào nhóm":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"af5f2f79-d090-47a7-b3ba-3d779be738de","triggerCount":0,"tags":[]}