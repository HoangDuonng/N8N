{"createdAt":"2023-04-18T08:51:00.702Z","updatedAt":"2023-04-20T14:21:36.000Z","id":"69","name":"Shopify flow","active":true,"nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":15}]}},"id":"2a816d9c-c467-40e3-9e86-194510d42c9f","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[80,120]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"{   \"app_id\": \"cli_a4b4819701b8902f\",   \"app_secret\": \"c2AKO70ot0MpDtH36TPpmhITkjr6tGOy\" }","options":{}},"id":"35aff4ad-1bf8-4e54-a0c8-22be650c452b","name":"Lấy tenant","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[660,120]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bitable/v1/apps/PwADb4L7kauBwUsKwUAlm1bggnd/tables/tblTJ4yLfdsBX16U/records/batch_create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"tenant_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":{{ JSON.stringify($node[\"code\"].json[\"records\"]) }}}\n","options":{}},"id":"cb495296-7365-4a3c-8552-c67d0609ae51","name":"Bắn về Base","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[880,120]},{"parameters":{"url":"=https://489f0e86bb73d141993e53799a1e9985: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@coollightshop-1077.myshopify.com/admin/api/2021-10/orders.json?created_at_min=2023-04-{{ $json[\"Day of month\"]-1 }}T00:00:00&created_at_max=2023-04-{{ $json[\"Day of month\"]-1 }}T23:59:59","options":{}},"id":"840d308f-770a-4949-a8af-bdbd78c5b7af","name":"Lấy dữ liệu Shopify","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[260,120]},{"parameters":{"jsCode":"// Loop over input items and add a new field\n// called 'myNewField' to the JSON of each one\nconst records = [];\n\nfor (const item of $input.all()) {\n  for (const order of item.json.orders) {\n      for (const lineItem of order.line_items){\n    const fields = {\n      Name: `${order.name}`,\n      Email: order.contact_email,\n      FinancialStatus: order.financial_status,\n      FulfillmentStatus: order.fulfillment_status,\n      Currency: order.currency,\n      Subtotal: Number(order.subtotal_price),\n      Shipping: Number(order.total_shipping_price_set.shop_money.amount),\n      Taxes: Number(order.current_total_tax),\n      Total: Number(order.total_price),\n      DiscountAmount: Number(order.current_total_discounts),\n      Createdat: order.created_at,\n      Lineitemquantity: lineItem.quantity,\n      Lineitemname: lineItem.name,\n      Lineitemprice: Number(lineItem.price),\n      Lineitemsku: lineItem.sku,\n      Lineitemrequiresshipping: lineItem.requies_shipping,\n      Lineitemtaxable: lineItem.taxable.toString(),\n      Lineitemfulfillmentstatus: lineItem.fulfillment_status,\n              BillingName: `${order.billing_address.first_name} ${order.billing_address.last_name}`,\n      BillingStreet:`${order.billing_address.address1}`,\n      BillingAddress1:`${order.billing_address.address1}`,\n      BillingCity: `${order.billing_address.city}`,\n      BillingZip:`${order.billing_address.zip}`,\n      BillingProvince: `${order.billing_address.province}`,\n      BillingCountry: `${order.billing_address.country}`,\n\n\n    };\n    \n    records.push({ fields });\n      }\n  \n      }\n}\n\n//return { records };\n\nlet result = { json: { records } };\nreturn result;\n\n\n\n"},"id":"5230bd44-5c87-4f12-82a0-43c43021b8bf","name":"code","type":"n8n-nodes-base.code","typeVersion":1,"position":[460,120]},{"parameters":{"jsCode":"let input = $('Get all users').first().json.data;\n\n// Get calls data\nlet records = input.pageLists.map((user) => {\n  let fields = {\n    id: user.id,\n    firstName: user.firstName,\n    lastName: user.lastName,\n    email: {\n      text: user.email,\n      link: user.email,\n    },\n    gender: user.gender,\n    phoneNumber: user.phoneNumber,\n    userType: user.userType,\n    userCode: user.userCode,\n  };\n  return { fields };\n});\n\nlet result = { json: { records } };\nreturn result;\n"},"id":"23cd0bb3-dc36-420b-9669-b8ff282a9dbf","name":"[Raw user list] Convert to Lark format","type":"n8n-nodes-base.code","typeVersion":1,"position":[660,340]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bitable/v1/apps/SJ5VbAzXOa9ub5sEOZdl1tPvgFf/tables/tblpf80ymKmM8V8k/records/batch_create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $node[\"Get tenant access token\"].json.tenant_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":{{ JSON.stringify($('[Raw user list] Convert to Lark format').first().json.records) }}}","options":{}},"id":"8efa1a85-6ec6-4b5b-9bf4-fa01b04e5458","name":"[Raw user list] Add records to Bitable","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[860,340]}],"connections":{"Schedule Trigger":{"main":[[{"node":"Lấy dữ liệu Shopify","type":"main","index":0}]]},"Lấy tenant":{"main":[[{"node":"Bắn về Base","type":"main","index":0}]]},"Lấy dữ liệu Shopify":{"main":[[{"node":"code","type":"main","index":0}]]},"code":{"main":[[{"node":"Lấy tenant","type":"main","index":0}]]},"[Raw user list] Convert to Lark format":{"main":[[{"node":"[Raw user list] Add records to Bitable","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"07279696-d0cd-4b78-a9f3-b00794bdab10","triggerCount":1,"tags":[]}