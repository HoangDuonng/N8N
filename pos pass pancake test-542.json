{"createdAt":"2023-09-23T15:59:31.652Z","updatedAt":"2023-09-23T16:13:55.000Z","id":"542","name":"POS pass Pancake TEST","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"1b91679a-ecce-4da8-95fd-123stufarm123","options":{}},"id":"0504e61f-7f12-4835-beb2-b24b550e5ce7","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-440,660],"webhookId":"ed3c0076-e943-47aa-8a71-6ece77ffb64f"},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a4728c89b9b89010"},{"name":"appSecret","value":"VPxBThYjNh7CuRxNnXWQoGXCZmz7NWuP"},{"name":"baseId","value":"AYlRbXuWzaoThTsHtjult88dgMe"},{"name":"tableId","value":"=tblOTkGOmrYxyYMr"}]},"options":{}},"id":"43c53c70-6ee5-4760-ae08-0c243f058b3e","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[0,660]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\" : \"{{ $('Set').item.json[\"appId\"] }}\",\n\"app_secret\" : \"{{ $('Set').item.json[\"appSecret\"] }}\" \n}","options":{}},"id":"82c83831-ffbf-45ab-b518-a695dc6d6b6c","name":"get app_access_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[420,660]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{ $('Set').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n    \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"partner_fee\": {{ $('Webhook').item.json[\"body\"][\"partner_fee\"] }},\n    \"transfer_money\": {{ $('Webhook').item.json[\"body\"][\"transfer_money\"] }},\n    \"charged_by_momo\": {{ $('Webhook').item.json[\"body\"][\"charged_by_momo\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"5cce6ce2-ef07-4544-9766-3d447f354abb","name":"Add base","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[960,580]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Get record ID').item.json[\"data\"][\"items\"] }}","operation":"isEmpty"}]}},"id":"c1df4332-ad0c-4777-9b31-e9a8ccd82211","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[780,660]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records?filter=CurrentValue.[id] = \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"6e68bda5-f572-41b5-9155-211af553326e","name":"Get record ID","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[640,660]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records/{{ $('Get record ID').item.json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n    \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"partner_fee\": {{ $('Webhook').item.json[\"body\"][\"partner_fee\"] }},\n    \"transfer_money\": {{ $('Webhook').item.json[\"body\"][\"transfer_money\"] }},\n    \"charged_by_momo\": {{ $('Webhook').item.json[\"body\"][\"charged_by_momo\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"1cf5f3cf-ea9c-4259-8050-63fb926aedc4","name":"Update","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[960,780]},{"parameters":{"operation":"formatDate","date":"={{ $('Webhook').item.json[\"body\"][\"updated_at\"] }}","format":"x","options":{}},"id":"e5a6b9ea-a239-49a4-ad73-84c3cd42db5f","name":"Date & Time","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[240,660]}],"connections":{"Webhook":{"main":[[{"node":"Set","type":"main","index":0}]]},"Set":{"main":[[{"node":"Date & Time","type":"main","index":0}]]},"get app_access_token":{"main":[[{"node":"Get record ID","type":"main","index":0}]]},"IF":{"main":[[{"node":"Add base","type":"main","index":0}],[{"node":"Update","type":"main","index":0}]]},"Get record ID":{"main":[[{"node":"IF","type":"main","index":0}]]},"Date & Time":{"main":[[{"node":"get app_access_token","type":"main","index":0}]]}},"settings":{"saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"525","executionTimeout":300},"staticData":null,"pinData":{},"versionId":"820ab999-ff10-4bad-82e2-ca8761c0c6fd","triggerCount":1,"tags":[]}