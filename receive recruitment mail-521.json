{"createdAt":"2023-09-11T03:57:52.827Z","updatedAt":"2023-09-13T02:18:57.000Z","id":"521","name":"Receive recruitment mail","active":false,"nodes":[{"parameters":{"mailbox":"inbox","format":"resolved","options":{}},"id":"ffa912b6-e657-475f-b2e3-83a2c67a8ec7","name":"Email Trigger (IMAP)","type":"n8n-nodes-base.emailReadImap","typeVersion":2,"position":[880,360],"credentials":{"imap":{"id":"120","name":"mela.recruitment.01@gmail.com"}}},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a4738d27c1b8d010"},{"name":"appSecret","value":"2z9YLhuBCoO1F62iOjUyJcgSk5K2Hkfb"}]},"options":{}},"id":"75aff06d-2711-4aa4-a93a-0370459f0390","name":"Set Lark auth data","type":"n8n-nodes-base.set","typeVersion":1,"position":[1340,360]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal/","sendBody":true,"specifyBody":"json","jsonBody":"={ \"app_id\" : \"{{ $('Set Lark auth data').item.json[\"appId\"] }}\", \"app_secret\" : \"{{ $('Set Lark auth data').item.json[\"appSecret\"] }}\" }","options":{}},"id":"a3026c55-95d6-4eac-8d25-12750126ef36","name":"Get Lark tenant access token","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[1560,360]},{"parameters":{"values":{"string":[{"name":"baseId","value":"LEHZbSKIBaQmYEspMGTlmxPMgzf"},{"name":"tableId","value":"tbliXbiUFBV6iMEG"}]},"options":{}},"id":"2747a170-6ff4-4028-ac82-dad8aa388afb","name":"Set Base config","type":"n8n-nodes-base.set","typeVersion":2,"position":[1760,360]},{"parameters":{"jsCode":"let input = $('Request to KDIGI extract email API').first().json;\nlet recruitmentCampaignData = $('Process recruitment campaign data').first().json.extractedData;\n\nlet campaignIds = recruitmentCampaignData.map((element,idx) => {\n  if(input.result.jobPosition == element[\"Vị trí tuyển dụng\"]) {\n    return element.record_id;  \n  }\n  return null;\n}).filter(element => element !== null);\n\nlet fields = {\n  \"Tên ứng viên\": input.result.candidateName,\n  \"CV link\": {\n    text: \"Nhấn vào để xem CV\",\n    link: input.result.urlAttachment\n  },\n  \"Chiến dịch tuyển dụng\": campaignIds,\n}\n\nlet result = { json: { ...$('Set Base config').first().json, fields } };\nreturn result;"},"id":"9c9b3902-f4c4-4909-8ba5-d4baf2d63ea3","name":"Convert data to Lark Base format","type":"n8n-nodes-base.code","typeVersion":1,"position":[2500,360]},{"parameters":{"method":"POST","url":"https://vn1.n8n.vn/webhook/kdigi/recruitment/extract/email","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"email","value":"={{ JSON.stringify($json) }}"}]},"options":{}},"id":"fe66f8d0-d0fe-4dcc-94c6-691e7ee4de86","name":"Request to KDIGI extract email API","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1100,360]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $json[\"baseId\"] }}/tables/{{ $json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"tenant_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={ \"fields\": {{ JSON.stringify($json[\"fields\"]) }} }","options":{}},"id":"cc39e4f0-f34b-471c-a390-9d00a52ceaca","name":"Add records to Bitable","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[2760,360]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $json[\"baseId\"] }}/tables/tblhVCRk3Gwlplj7/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"tenant_access_token\"] }}"}]},"options":{}},"id":"f047f2b7-b4c3-4325-b570-8ec392d57a87","name":"Get data in recruitment campaign table","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1980,360]},{"parameters":{"jsCode":"const input = $('Get data in recruitment campaign table').first().json.data;\n\nlet extractedData = input.items.map((element, idx) => {\n  return {\n    \"record_id\": element.record_id,\n    \"ID chiến dịch\": element.fields[\"ID chiến dịch\"],\n    \"Trạng thái\": element.fields[\"Trạng thái\"],\n    \"Vị trí tuyển dụng\": element.fields[\"Vị trí tuyển dụng\"]  \n  }\n})\n\nreturn {extractedData} ;"},"id":"8e043035-944a-4b92-b5af-09a7f7ebc4aa","name":"Process recruitment campaign data","type":"n8n-nodes-base.code","typeVersion":1,"position":[2240,360]}],"connections":{"Email Trigger (IMAP)":{"main":[[{"node":"Request to KDIGI extract email API","type":"main","index":0}]]},"Set Lark auth data":{"main":[[{"node":"Get Lark tenant access token","type":"main","index":0}]]},"Get Lark tenant access token":{"main":[[{"node":"Set Base config","type":"main","index":0}]]},"Set Base config":{"main":[[{"node":"Get data in recruitment campaign table","type":"main","index":0}]]},"Request to KDIGI extract email API":{"main":[[{"node":"Set Lark auth data","type":"main","index":0}]]},"Get data in recruitment campaign table":{"main":[[{"node":"Process recruitment campaign data","type":"main","index":0}]]},"Process recruitment campaign data":{"main":[[{"node":"Convert data to Lark Base format","type":"main","index":0}]]},"Convert data to Lark Base format":{"main":[[{"node":"Add records to Bitable","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Email Trigger (IMAP)":{"lastMessageUid":30}},"pinData":{"Email Trigger (IMAP)":[{"json":{"headers":{"delivered-to":"Delivered-To: recruitment-test@mela.com.vn","received":"Received: from u06.bc.larksuite.com (u06.bc.larksuite.com. [130.44.212.61])\r\n        by mx.google.com with UTF8SMTPS id b1-20020a05622a020100b00403a745aff8si4462485qtx.309.2023.09.11.02.28.14\r\n        for <mela.recruitment.01@gmail.com>\r\n        (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);\r\n        Mon, 11 Sep 2023 02:28:15 -0700 (PDT)","x-google-smtp-source":"X-Google-Smtp-Source: AGHT+IH1CFoN/d/NHbNHe6FyPJmC2vovPfFKY5rHXMlLzwLrtOcBGDUx635ZH+f44yv+sXVgqRAw","x-received":"X-Received: by 2002:a05:622a:d2:b0:413:6826:c12c with SMTP id p18-20020a05622a00d200b004136826c12cmr12540058qtw.58.1694424495773;\r\n        Mon, 11 Sep 2023 02:28:15 -0700 (PDT)","arc-seal":"ARC-Seal: i=1; a=rsa-sha256; t=1694424474; d=larksuite.com; s=arc230412; cv=none;\r\n    b=Ys/YxiSN6fcU2MiiklgUxZ55nkNaLZZsShA2lBO160C+EhRXdvC/dsYi8rISB0KEauBQvRY\r\n     C7gVX/JtHDkNZDVu62vSZw++FA0wlWz72ksBC1H/M0zoNtZVnj5ta5k+ejWefwnalHiasN/EH\r\n     xg4fK614Fqlc0YJfbV1R2eGcnMyXMuZH1nS1/G7aKREgxwUGr+eWbFbzNbADEmOLfHNgMCgst\r\n     ezIrm9rP7c29pm5m4tTK9SvRiznpV0YZtGclFO0d2LPWBbLmR7KXl0Zx8vN/z1XN9WAbX7wOS\r\n     Sm1gsjyiS4FdJC+z+eipPB7Oih6MWXJQ2TLePf2FjOI7nvwXvJqw==","arc-message-signature":"ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=larksuite.com;\r\n     s=arc230412;\r\n    h=from:to:subject:date:content-type:mime-version:message-id\r\n     :dkim-signature;\r\n    bh=rBIqcpiKuxSrko1h8hRtRCt9Z421NgKfFf9tyvxcYpY=;\r\n    b=sD3m7a5zsKbpptcJ4mSqQSh1px1irCzCvWbNR6avTyK9eckv9QN4xO+JgL5uEQeRuDrAD/k\r\n     vzc5JSRahPiDEhUj2MVdDVdQEd2hlsSwHOQsqJbxoFz26qzJxvZz4EbcBGX57QLhk0Vaqk6kE\r\n     CX6yef95Wf6473NiaK/hGMlVrlI3/m/pJaLtOt5TgHAKPXP2f4+DP02/FZ1Yma6hea6G4wOyh\r\n     21YdyO+t8pu0+SLzzSICbO74OMbagp7lmv1SbyPrrLlLLfYBLRI0OXLVzpd/ePOEK8v7N186k\r\n     nHbkCGL0UPrMokelNGKdSJEzzWi5TVmLe/bPZb18/QeQMH4/GBsw==","arc-authentication-results":"ARC-Authentication-Results: i=1; lms;\r\n    spf=permerror (client-ip:209.127.230.11) smtp.mailfrom=thanhkh@kdigi.vn;\r\n    dkim=pass header.b=XMYvmGGPqv header.i=@kdigi.vn header.s=lark2301150744;\r\n    dmarc=none;\r\n    arc=none","return-path":"Return-Path: <autoForward_recruitment-test_424488@mela.com.vn>","received-spf":"Received-SPF: permerror (lms verify) identity=mailfrom; client-ip=209.127.230.11; helo=s01.bc.larksuite.com; envelope-from=thanhkh@kdigi.vn; receiver=<UNKNOWN>;","authentication-results":"Authentication-Results: lms;\r\n    spf=permerror (client-ip:209.127.230.11) smtp.mailfrom=thanhkh@kdigi.vn;\r\n    dkim=pass header.b=XMYvmGGPqv header.i=@kdigi.vn header.s=lark2301150744;\r\n    dmarc=none;\r\n    arc=none","x-lms-autotransfer-id":"X-LMS-AutoTransfer-ID: t=1694424488; b=ekCoXd5wzqkbH5qvLQtMML0uZTxaDk/WyTgDW8X7Cew","sender":"Sender: autoForward_recruitment-test_424488@mela.com.vn","x-lms-autotransfer":"X-LMS-AutoTransfer: auto","x-lms-pvf":"X-Lms-Pvf: MnwyfDJ8fGKKWM74XkdG8lhTt0z7SvsxSYJojmUQvB5ERF13lXSyii36ZAo6sIOtMYFztB7whrwah2XrHNmfTgZQJyQoj3jdvVN59tWnzngDblJzJkPBMSoO5/F8R2UFrbmsgUC0nQ==","x-fangmail-anti-spam-filtered":"X-Fangmail-Anti-Spam-Filtered: true","x-fangmail-mid-qid":"X-Fangmail-Mid-Qid: 64FEDD96.000/4RkhFy1pKnzRZR4N","x-lms-egress-gw":"X-Lms-Egress-Gw: EgressFangMail","x-fangmail-gw-spam-type":"X-Fangmail-Gw-Spam-Type: 0","x-fangmail-miltered":"X-Fangmail-Miltered: at n100-022-169 with ID 64FEDD96.000 by FangMail milter!","x-fangmail-envelope":"X-Fangmail-Envelope: 1694424470/4RkhFy1pKnzRZR4N/64FEDD96.000/209.127.230.11/s01.bc.larksuite.com/localhost/<thanhkh@kdigi.vn>","x-lms-client-ip":"X-Lms-Client-Ip: 209.127.230.11","x-lms-mail-from":"X-Lms-Mail-From: thanhkh@kdigi.vn","dkim-signature":"DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;\r\n s=lark2301150744; d=kdigi.vn; t=1694424463; h=from:subject:\r\n mime-version:from:date:message-id:subject:to:cc:reply-to:content-type:\r\n mime-version:in-reply-to:message-id;\r\n bh=rBIqcpiKuxSrko1h8hRtRCt9Z421NgKfFf9tyvxcYpY=;\r\n b=XMYvmGGPqvFyaKkswYGGO1ELxjCHx+KVtqYxDULaHEsECrdJLQqYC9ufHGcLTXp9OcuvJ4\r\n 7fqM2wfG6JWvAhd8hF/SbI7IYfU6MUPhBIpi0ykvhHu9aJm0dXuXsF1Y98/wijPlLMEHMW\r\n rgIOfJjIYM+DCcfDluYimqydWMxybsnyTMhNUOuWpWJraErg9OV/Dmh71xdrJH9O+AZ5PZ\r\n d3zIf5wVadX+jI6ypDXLR5vU8ygO9zSGrJp6XauyNyYtdx0CZ9O4LWfKky+iWCu7IJscdC\r\n //UcfEwmY5g98RRZq8UkLP4TrHUq5NZE2hJfi/l5D4fWfBA2QngGqUzhd424Sw==","mime-version":"Mime-Version: 1.0","x-lms-return-path":"X-Lms-Return-Path: <lba+164fedd8e+4b6386+mela.com.vn+thanhkh@kdigi.vn>","message-id":"Message-Id: <0076523b2df036bab6e0354949ee9d0c205e0a6b.3c938db4.03cd.4c65.bc38.ff93ac05feed@larksuite.com>","subject":"Subject: Kdigi test attachment 88888","from":"From: \"Kieu Hieu Thanh\" <thanhkh@kdigi.vn>","to":"To: =?utf-8?q?Test_flow_tuy=E1=BB=83n_d=E1=BB=A5ng?= <recruitment-test@mela.com.vn>","content-type":"Content-Type: multipart/mixed;\r\n boundary=d614cd7afa8911d60121c23052f9813f4750d33ee2a6922f279e2ffb0973","date":"Date: Mon, 11 Sep 2023 09:27:41 +0000","x-lms-gw-filter":"X-Lms-Gw-Filter: true"},"html":"<div id=\"editor_version_1.41.6_ArKlWq9s\" style=\"word-break:break-word;\"><div data-zone-id=\"0\" data-line-index=\"0\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><span style=\"font-size: 16px;\">This is an email containing attachment 8888</span></div></div><div data-zone-id=\"0\" data-line-index=\"1\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"2\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"3\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"4\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"5\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"6\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"7\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"0\" data-line-index=\"8\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><div id=\"7267892875106598917\" class=\"lark-mail-signature\" data-serialized=\"\"><div data-zone-id=\"zhua6hq3ds\" data-line-index=\"0\" data-line=\"true\" style=\"line-height: 1.6; margin-top: 4px; margin-bottom: 4px;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"zhua6hq3ds\" data-line-index=\"1\" data-line=\"true\" style=\"line-height: 1.6; margin-top: 4px; margin-bottom: 4px;\"><div style=\"font-size: 14px;\"><span style=\"font-size: 16px;\">Thanks and Best regards,</span></div></div><div data-zone-id=\"zhua6hq3ds\" data-line-index=\"2\" data-line=\"true\" style=\"line-height: 1.6; margin-top: 4px; margin-bottom: 4px;\"><div style=\"font-size: 14px;\"><br></div></div><div data-zone-id=\"zhua6hq3ds\" data-line-index=\"3\" data-line=\"true\" style=\"line-height: 1.6; margin-top: 4px; margin-bottom: 4px;\"><div style=\"font-size: 14px;\"><span style=\"font-size: 16px;\">ThanhKH</span></div></div></div></div></div><div data-zone-id=\"0\" data-line-index=\"9\" data-line=\"true\" style=\"margin-top: 4px; margin-bottom: 4px; line-height: 1.6;\"><div style=\"font-size: 14px;\"><br></div></div></div>","text":"This is an email containing attachment 8888\n\n\n\n\n\n\n\n\nThanks and Best regards,\n\nThanhKH\n\n","textAsHtml":"<p>This is an email containing attachment 8888</p><p>Thanks and Best regards,</p><p>ThanhKH</p>","subject":"Kdigi test attachment 88888","date":"2023-09-11T09:27:41.000Z","to":{"value":[{"address":"recruitment-test@mela.com.vn","name":"Test flow tuyển dụng"}],"html":"<span class=\"mp_address_group\"><span class=\"mp_address_name\">Test flow tuy&#x1EC3;n d&#x1EE5;ng</span> &lt;<a href=\"mailto:recruitment-test@mela.com.vn\" class=\"mp_address_email\">recruitment-test@mela.com.vn</a>&gt;</span>","text":"Test flow tuyển dụng <recruitment-test@mela.com.vn>"},"from":{"value":[{"address":"thanhkh@kdigi.vn","name":"Kieu Hieu Thanh"}],"html":"<span class=\"mp_address_group\"><span class=\"mp_address_name\">Kieu Hieu Thanh</span> &lt;<a href=\"mailto:thanhkh@kdigi.vn\" class=\"mp_address_email\">thanhkh@kdigi.vn</a>&gt;</span>","text":"Kieu Hieu Thanh <thanhkh@kdigi.vn>"},"messageId":"<0076523b2df036bab6e0354949ee9d0c205e0a6b.3c938db4.03cd.4c65.bc38.ff93ac05feed@larksuite.com>"}}]},"versionId":"5514f9dc-1be1-4a9a-9da8-a59ba3f77f78","triggerCount":1,"tags":[]}