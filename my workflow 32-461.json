{"createdAt":"2023-08-07T07:26:45.245Z","updatedAt":"2023-08-07T07:26:45.245Z","id":"461","name":"My workflow 32","active":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"tin_nguyen-nhanh-sync-base-08-04-2023","options":{}},"id":"926e192b-f5bd-4bd1-8f5a-3c74ff83187b","name":"webhook-nhanh","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[2620,1560],"webhookId":"d44e3fdf-5027-4515-8ab7-6efe1029de87"},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Order').item.json[\"baseId\"] }}/tables/{{ $('Set-Order').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_order').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n{\n\"money_kh\":{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"calcTotalMoney\"] }},\n\"address_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerAddress\"] }}\",\n\"ward_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerWard\"] }}\",\n\"district_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerDistrict\"] }}\",\n\"city_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerCity\"] }}\",\n\"email_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerEmail\"] }}\",\n\"name_kh\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerName\"] }}\",\n\"phone_kh\":\"{{$node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"customerMobile\"]}}\",\n\"order_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"orderId\"] }}\",\n\"status\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"statusDescription\"] }}\",\n\"product_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"products\"][0][\"id\"] }}\"\n}\n}","options":{}},"id":"bdb6f9b6-b7c3-4beb-8595-4a8466534901","name":"add-base-larksuite","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3840,1340]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Order').item.json[\"baseId\"] }}/tables/{{ $('Set-Order').item.json[\"tableId\"] }}/records?filter=CurrentValue.[order_id] = \"{{ $('webhook-nhanh').item.json[\"body\"][\"data\"][\"orderId\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_order').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"03c24a9c-0da6-4f30-8ba9-8bcb2816887f","name":"get-records","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3840,1500]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Order').item.json[\"baseId\"] }}/tables/{{ $('Set-Order').item.json[\"tableId\"] }}/records/{{ $node[\"get-records\"].json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_order').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n{\n\"order_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"orderId\"] }}\",\n\"status\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"statusDescription\"] }}\"\n}\n}","options":{}},"id":"110ff10c-b424-42a7-ac4a-1f508e938810","name":"update-records","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4020,1500]},{"parameters":{"values":{"string":[{"name":"appId"},{"name":"appSecret"},{"name":"baseId"},{"name":"tableId"}]},"options":{}},"id":"697a80e9-ebd6-4467-916c-7503866866d7","name":"Set-Order","type":"n8n-nodes-base.set","typeVersion":2,"position":[3080,1400]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('webhook-nhanh').item.json.body.event }}","value2":"orderAdd"},{"value1":"={{ $('webhook-nhanh').item.json.body.event }}","value2":"orderUpdate"}]},"combineOperation":"any"},"id":"8a20b5e0-7727-41c4-a01d-894e8c4076c7","name":"check-order-or-product","type":"n8n-nodes-base.if","typeVersion":1,"position":[2840,1560]},{"parameters":{"values":{"string":[{"name":"appId"},{"name":"appSecret"},{"name":"baseId"},{"name":"tableId"}]},"options":{}},"id":"41bae2b0-a9db-4e39-be2b-f6da2ee77c28","name":"Set-Product","type":"n8n-nodes-base.set","typeVersion":2,"position":[3080,1760]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\": \"{{ $('Set-Product').item.json[\"appId\"] }}\",\n\"app_secret\": \"{{ $('Set-Product').item.json[\"appSecret\"] }}\"\n}","options":{}},"id":"e1f97120-24ef-4594-942a-5ca62437f761","name":"app_access_token_product","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3260,1760]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\": \"{{ $('Set-Order').item.json[\"appId\"] }}\",\n\"app_secret\": \"{{ $('Set-Order').item.json[\"appSecret\"] }}\"\n}","options":{}},"id":"c8478fe2-d082-4bff-9a0c-a375783da5d7","name":"app_access_token_order","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3260,1400]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('webhook-nhanh').item.json.body.event }}","value2":"orderAdd"}]}},"id":"c899a8dc-dfa6-4a98-bcba-b14abcba6f8f","name":"IF-order-base","type":"n8n-nodes-base.if","typeVersion":1,"position":[3600,1400]},{"parameters":{},"id":"e11cb253-249b-45e2-9408-0508173d8fb6","name":"push base order","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3440,1400]},{"parameters":{},"id":"4a244b76-b679-4db7-83be-71ce3639690f","name":"push base product","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3440,1760]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('webhook-nhanh').item.json.body.event }}","value2":"productAdd"}]}},"id":"76e1f75a-49be-4e07-b114-fa360f6d7bd5","name":"IF-product-base","type":"n8n-nodes-base.if","typeVersion":1,"position":[3600,1760]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Product').item.json[\"baseId\"] }}/tables/{{ $('Set-Product').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_product').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n{\n\"product_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"productId\"] }}\",\n\"brand_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"brandId\"] }}\",\n\"product_name\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"name\"] }}\"\n}\n}","options":{}},"id":"1eabe438-e1f5-47b4-bda8-c00f9e5000ed","name":"add-product-base-larksuite","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3840,1680]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Product').item.json[\"baseId\"] }}/tables/{{ $('Set-Product').item.json[\"tableId\"] }}/records?filter=CurrentValue.[product_id] = \"{{ $('webhook-nhanh').item.json[\"body\"][\"data\"][\"productId\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_product').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"c92d5a66-d037-4884-94a6-1c27cdd12548","name":"get-records-product","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3840,1840]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set-Product').item.json[\"baseId\"] }}/tables/{{ $('Set-Product').item.json[\"tableId\"] }}/records/{{ $node[\"get-records-product\"].json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_access_token_product').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n{\n\"product_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"productId\"] }}\",\n\"brand_id\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"brandId\"] }}\",\n\"product_name\":\"{{ $node[\"webhook-nhanh\"].json[\"body\"][\"data\"][\"name\"] }}\"\n}\n}","options":{}},"id":"31c20677-8ec6-48a6-890e-47f4ed75f6e2","name":"update-product","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4040,1840]},{"parameters":{"content":"Automation - Order","height":80},"id":"fe75707b-f3cb-4680-9502-136365aa54bd","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2760,1280]},{"parameters":{"content":"Automation - Product","height":80},"id":"38867a13-9513-46a9-a266-e778c855d3d4","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2760,1820]}],"connections":{"webhook-nhanh":{"main":[[{"node":"check-order-or-product","type":"main","index":0}]]},"get-records":{"main":[[{"node":"update-records","type":"main","index":0}]]},"Set-Order":{"main":[[{"node":"app_access_token_order","type":"main","index":0}]]},"check-order-or-product":{"main":[[{"node":"Set-Order","type":"main","index":0}],[{"node":"Set-Product","type":"main","index":0}]]},"Set-Product":{"main":[[{"node":"app_access_token_product","type":"main","index":0}]]},"app_access_token_order":{"main":[[{"node":"push base order","type":"main","index":0}]]},"IF-order-base":{"main":[[{"node":"add-base-larksuite","type":"main","index":0}],[{"node":"get-records","type":"main","index":0}]]},"app_access_token_product":{"main":[[{"node":"push base product","type":"main","index":0}]]},"push base order":{"main":[[{"node":"IF-order-base","type":"main","index":0}]]},"push base product":{"main":[[{"node":"IF-product-base","type":"main","index":0}]]},"IF-product-base":{"main":[[{"node":"add-product-base-larksuite","type":"main","index":0}],[{"node":"get-records-product","type":"main","index":0}]]},"get-records-product":{"main":[[{"node":"update-product","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"8405cb7e-5740-4576-ac30-f7839f411c74","triggerCount":0,"tags":[]}