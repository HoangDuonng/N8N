{"createdAt":"2023-05-22T10:50:13.490Z","updatedAt":"2023-10-12T21:27:44.000Z","id":"105","name":"Medicar: Push order from Shopify to Nhanh","active":true,"nodes":[{"parameters":{"authentication":"accessToken","topic":"orders/create"},"id":"62885e5f-0b9c-4dc1-9e46-ec4bf83904ee","name":"Shopify Trigger","type":"n8n-nodes-base.shopifyTrigger","typeVersion":1,"position":[460,460],"webhookId":"ea1cf77b-b570-454d-96e2-94c0943955b4","credentials":{"shopifyAccessTokenApi":{"id":"54","name":"Medicar-Vietnam: Shopify Access Token"}}},{"parameters":{"method":"POST","url":"https://open.nhanh.vn/api/order/add","sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"version","value":"2.0"},{"name":"appId","value":"73499"},{"name":"businessId","value":"112545"},{"name":"accessToken","value":"bAHzqbYptLMywCYGtwLWmtAwC3EeX2WYsf9JzdRzInV1PVXaf8Qf5cxGRr3Rdl6sdR7jPdf0VBBCLxEo2gagmKPqLNCDdjO1UGjvbdm9pMvQwzrvVjDiqbK0ZXGu5CRYDhlyazWR1O0RuS7VsE19EvzTWOiiIXC9mpv8G10qK9jBpKW4EVtzdsQeU8jHlYJb"},{"name":"data","value":"={\"id\":{{ $json[\"order_number\"] }},\n\"customerName\":\"{{ $json[\"billing_address\"][\"name\"] }}\",\n\"customerMobile\":\"{{ $json[\"customerPhone\"] }}\",\n\"customerEmail\":\"{{ $json[\"customer\"][\"email\"] }}\",\n\"customerAddress\":\"{{ $json[\"billing_address\"][\"address1\"] }}\",\n\"customerWardLocationName\":\"{{ $json[\"billing_address\"][\"address2\"] }}\",\n\"customerCityName\":\"{{ $json[\"billing_address\"][\"city\"] }}\",\n\"paymentMethod\":\"{{ $json[\"payment_gateway_names\"][0] }}\",\n\"saleId\": 3100490,\n\"trafficSource\": \"Website\",\n\"status\":\"New\",\n\"moneyTransfer\":\"{{ $node[\"Collect items of Order\"].json[\"orderMoney\"] }}\",\n\"privateDescription\":\"{{ $node[\"Collect items of Order\"].json[\"paymentNote\"] }}\",\n\"productList\":{{ $json[\"products\"] }}}"}]},"options":{}},"id":"fb0f2e65-3280-4474-bc49-ce0a4265e6fe","name":"Push Order to Nhanh","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[900,460],"notes":"{\"id\":{{ $json[\"order_number\"] }},\n\"customerName\":{{ $json[\"billing_address\"][\"name\"] }},\n\"customerMobile\":{{ $json[\"billing_address\"][\"phone\"] }},\n\"customerEmail\":{{ $json[\"customer\"][\"email\"] }},\n\"customerAddress\":{{ $json[\"billing_address\"][\"address1\"] }},\n\"customerWardLocationName\":{{ $json[\"billing_address\"][\"address2\"] }},\n\"customerCityName\":{{ $json[\"billing_address\"][\"city\"] }},\n\"paymentMethod\":{{ $json[\"payment_gateway_names\"][0] }},\n\"status\":\"New\",\n\"productList\":{{ $json[\"products\"] }}}"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/93bbe2ad-20f4-4ba1-967d-c021dae137c7","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üè∑ Phone:**\\n {{ $node[\"Collect items of Order\"].json[\"customerPhone\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üë§ Customer:**\\n {{ $node[\"Shopify Trigger\"].json[\"billing_address\"][\"name\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üí∞ Total Money:**\\n {{ $node[\"Collect items of Order\"].json[\"orderMoneySt\"] }} VND\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üõí Address:**\\n {{ $node[\"Shopify Trigger\"].json[\"billing_address\"][\"city\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üí∞ Payment Gate:**\\n {{ $node[\"Shopify Trigger\"].json[\"payment_gateway_names\"][0] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": false,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**üì• Order Note:**\\n {{ $node[\"Collect items of Order\"].json[\"paymentNote\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"üéâ Shopify Order: {{ $node[\"Collect items of Order\"].json[\"orderMoneySt\"] }} VND üéâ\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"71c259c6-d2ea-40e7-bcfc-f23032f0c466","name":"Push message to Lark","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1120,460]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.products = $('Shopify Trigger').item.json.line_items;\n$input.item.json.orderItems = []\nlet pI = 0\nlet orderMoney = 0\nlet pLength = $input.item.json.products.length;\nwhile (pI < pLength) {\n  let person = {\n    id:$input.item.json.products[pI].product_id, \n    quantity:$input.item.json.products[pI].quantity, \n    name:$input.item.json.products[pI].name,\n    //code:$input.item.json.products[pI].sku, \n    //type:$input.item.json.products[pI].title, \n    price:$input.item.json.products[pI].price, \n    //weight:$input.item.json.products[pI].grams\n  };\n  orderMoney += $input.item.json.products[pI].quantity * $input.item.json.products[pI].price\n  $input.item.json.orderItems[pI] = person;\n  pI++;\n}\n$input.item.json.customerPhone = $('Shopify Trigger').item.json.billing_address.phone.replaceAll(\" \",\"\")\n$input.item.json.orderMoney = 0\nif (\"Chuy·ªÉn Kho·∫£n Ng√¢n H√†ng Th·ªß C√¥ng\" == $('Shopify Trigger').item.json.payment_gateway_names || \"Thanh to√°n Alepay ATM,QRCode,Th·∫ª Qu·ªëc t·∫ø,Tr·∫£ g√≥p\" == $('Shopify Trigger').item.json.payment_gateway_names) {\n  $input.item.json.orderMoney = orderMoney;\n  $input.item.json.paymentNote = \"Check chuyen khoan truoc\";\n}\n$input.item.json.orderMoneySt = orderMoney.toLocaleString(\"de-DE\")\n\n$input.item.json.products = JSON.stringify($input.item.json.orderItems)\n\nreturn $input.item.json;"},"id":"1c0794e2-1efc-45f3-8081-d7eb960a96c0","name":"Collect items of Order","type":"n8n-nodes-base.code","typeVersion":1,"position":[680,460],"notes":"\n$input.item.json.order = \"\"\n$input.item.json.order.id = \n$input.item.json.order.customerName = \n$input.item.json.order.customerMobile = \n$input.item.json.order.customerEmail = \n$input.item.json.order.customerAddress = \n$input.item.json.order.customerCityName = \n$input.item.json.order.customerDistrictName = \n$input.item.json.order.customerWardLocationName = \n$input.item.json.order.paymentMethod = \n$input.item.json.order.status = \"New\";\n$input.item.json.order.productList = $input.item.json.orderItems"}],"connections":{"Shopify Trigger":{"main":[[{"node":"Collect items of Order","type":"main","index":0}]]},"Push Order to Nhanh":{"main":[[{"node":"Push message to Lark","type":"main","index":0}]]},"Collect items of Order":{"main":[[{"node":"Push Order to Nhanh","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Shopify Trigger":{"webhookId":1206718726361}},"pinData":{},"versionId":"21651ffd-a74c-4e75-887d-7df4a97efc69","triggerCount":1,"tags":[]}