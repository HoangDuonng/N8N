{"createdAt":"2023-08-25T22:07:54.848Z","updatedAt":"2023-08-26T00:53:52.000Z","id":"489","name":"L365_ASKNOW","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"ctl","options":{}},"id":"eced7bd4-999a-49fc-b07b-afa2c82333a7","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-240,-240],"webhookId":"63ee6009-e0f3-4b3a-869b-f9ec10510474"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal/","sendBody":true,"specifyBody":"json","jsonBody":"={ \"app_id\" : \"cli_a459df5dd6b8500a\",\n \"app_secret\" : \"TTFD16iqQU0Psui0fewGVg2q2bcWIFBt\" } ","options":{}},"id":"38d2eb0d-d94b-43d6-9e9e-46760ea17b22","name":"app_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[60,-240]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/SFdibrWjyaVvaNsqQxnugyp5sHg/tables/tblSqYSk5r1cSvut/records/batch_create\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('app_token').item.json.app_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":\n{{ JSON.stringify($('CV').first().json.records) }}}","options":{}},"id":"4a9cad1f-5429-440e-8b85-32583a16801f","name":"Update record","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[480,-260]},{"parameters":{"jsCode":"// Hàm chuyển đổi chuỗi đầu vào thành chuỗi JSON\nfunction transformToJSON(items) {\n  const dateArray = items.date.split(\",\");\n  const QsArray = items.Qs.split(\",\");\n  const UseransArray = items.Userans.split(\",\");\n  const WhoArray = items.Who.split(\",\");\n\n  const resultArray = [];\n\n  for (let i = 0; i < Math.min(QsArray.length); i++) {\n    const unixDate = dateToUnix(dateArray[i]);\n    // Chuyển chuỗi Userans thành danh sách các chuỗi\n    const useransList = UseransArray[i].split(\",\");\n    \n    const obj = {\n      fields: {\n        \"Date\": unixDate,\n        \"Qs\": QsArray[i],\n        \"Userans\": useransList,\n        \"tennhan\": WhoArray[i],\n        \"GET_DONE\" : \"Done\"\n        \n        \n      },\n    };\n    resultArray.push(obj);\n  }\n\n  return resultArray;\n}\n\n// Chuỗi đầu vào\nconst inputString = $node[\"Webhook\"].json[\"body\"];\n\n// Thực hiện chuyển đổi và trả về kết quả\nconst result = transformToJSON(inputString);\nreturn { records: result };\n\n//...................\nfunction dateToUnix(dateStr) {\n    const dateParts = dateStr.split('/');\n    if (dateParts.length !== 3) {\n        return null; // Chuỗi ngày tháng không đúng định dạng\n    }\n\n    const year = parseInt(dateParts[0], 10);\n    const month = parseInt(dateParts[1], 10) - 1; // Tháng trong JavaScript bắt đầu từ 0\n    const day = parseInt(dateParts[2], 10);\n\n    const dateObject = new Date(year, month, day);\n    if (isNaN(dateObject.getTime())) {\n        return null; // Ngày tháng không hợp lệ\n    }\n\n    const unixTimestamp = dateObject.getTime();\n    return unixTimestamp;\n}\n\n"},"id":"a088b918-cbed-4105-97e3-085e87cf980d","name":"CV","type":"n8n-nodes-base.code","typeVersion":1,"position":[-80,-240]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').item.json.body.Qs }}","operation":"isNotEmpty"}]},"combineOperation":"any"},"id":"957c12fb-cfa7-498a-ad07-632418e8f146","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[200,-240]}],"connections":{"Webhook":{"main":[[{"node":"CV","type":"main","index":0}]]},"app_token":{"main":[[{"node":"IF1","type":"main","index":0}]]},"CV":{"main":[[{"node":"app_token","type":"main","index":0}]]},"IF1":{"main":[[{"node":"Update record","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"c987b35e-1c16-470c-9e51-22330b3b3257","triggerCount":1,"tags":[{"createdAt":"2023-07-27T13:18:08.568Z","updatedAt":"2023-07-27T13:18:08.568Z","id":"29","name":"Lark365"}]}