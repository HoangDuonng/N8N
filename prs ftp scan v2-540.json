{"createdAt":"2023-09-23T07:05:24.866Z","updatedAt":"2023-09-23T10:24:09.000Z","id":"540","name":"PRS FTP Scan v2","active":false,"nodes":[{"parameters":{"protocol":"sftp","operation":"list"},"id":"62dd4077-412e-4ed2-ae6a-5a330516791f","name":"FTP","type":"n8n-nodes-base.ftp","typeVersion":1,"position":[220,920],"credentials":{"sftp":{"id":"128","name":"SFTP PRS"}}},{"parameters":{},"id":"9ae5cc88-3daa-4a55-9e1d-dc290fec2bea","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-260,620]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"apiUrl","value":"https://dstt.postmart.com.vn/api/prs"},{"name":"apiToken","value":"7a51b166dfe235dfec2901a24ed2f671"},{"name":"cutOffTime","value":"={{$today.minus({days: 22})}}"},{"name":"cutOffTime1","value":"={{ $if($json[\"Hour\"] === 0 && $json[\"Minute\"] < 30, $today.minus({days: 1}), $today) }}"}]},"options":{}},"id":"fab2c88d-cc03-469c-a802-2f19705104bc","name":"setData","type":"n8n-nodes-base.set","typeVersion":2,"position":[0,820]},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.path }}"},"id":"f5999117-8bd1-47ec-9bca-b6d46211557a","name":"ScanFolderNCC","type":"n8n-nodes-base.ftp","typeVersion":1,"position":[960,1040],"retryOnFail":true,"maxTries":5,"waitBetweenTries":5000,"credentials":{"sftp":{"id":"128","name":"SFTP PRS"}}},{"parameters":{"conditions":{"dateTime":[{"value1":"={{ $json.modifyTime }}","value2":"={{ $('setData').item.json.cutOffTime }}"}],"string":[{"value1":"={{ $json.name }}","operation":"notEqual","value2":"SLTonKho"}]},"combineConditions":"OR"},"id":"2e9182ac-1f64-4c72-8ea2-053890ac578a","name":"ifFolder","type":"n8n-nodes-base.filter","typeVersion":1,"position":[460,920]},{"parameters":{"conditions":{"dateTime":[{"value1":"={{ $json.modifyTime }}","value2":"={{ $('setData').item.json.cutOffTime }}"}],"string":[{"value1":"={{ $json.type }}","value2":"d"},{"value1":"={{ $json.name }}","operation":"notEqual","value2":"backup"}]}},"id":"29cbdb17-20ae-42bd-a53f-fb2726950b2c","name":"ifConditionDate","type":"n8n-nodes-base.if","typeVersion":1,"position":[1160,1040]},{"parameters":{"workflowId":"539"},"id":"1f64278f-f260-415b-b47d-ebd86c27a0eb","name":"Execute Workflow","type":"n8n-nodes-base.executeWorkflow","typeVersion":1,"position":[1600,960]},{"parameters":{"dataType":"string","value1":"={{ $json.name }}","rules":{"rules":[{"value2":"GoodsReceipt"},{"value2":"GoodsShipment"},{"value2":"PurchaseOrder"},{"value2":"SalesOrder"}]},"fallbackOutput":1},"id":"a68d6127-58a5-4e11-bbaf-127ab76a6374","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":1,"position":[700,920]},{"parameters":{"batchSize":1,"options":{}},"id":"1b40f263-58d0-40f7-b557-6ca326bec095","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1380,980]},{"parameters":{},"id":"8c81aea9-0d76-4a26-9410-c1dcea0fdab2","name":"No Operation, do nothing","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1820,960]},{"parameters":{},"id":"14889755-10cf-4e5b-8566-2ffda1def14e","name":"ScanOneMonth","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-260,820]},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":8},{"triggerAtMinute":15}]}},"id":"2196466c-8080-4fea-a04b-38d9bbc65407","name":"ScanProduction","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-260,1040],"disabled":true},{"parameters":{"values":{"string":[{"name":"apiUrl","value":"https://dstt.postmart.com.vn/api/prs"},{"name":"apiToken","value":"7a51b166dfe235dfec2901a24ed2f671"},{"name":"cutOffTime","value":"={{$today.minus({days: 22})}}"},{"name":"cutOffTimeProd","value":"={{ $if($json[\"Hour\"] === 0 && $json[\"Minute\"] < 30, $today.minus({days: 1}), $today) }}"}]},"options":{}},"id":"ed0164e7-3aee-4aa6-af05-a9f3b41fbb49","name":"setData2","type":"n8n-nodes-base.set","typeVersion":2,"position":[0,1040]}],"connections":{"FTP":{"main":[[{"node":"ifFolder","type":"main","index":0}]]},"setData":{"main":[[{"node":"FTP","type":"main","index":0}]]},"When clicking \"Execute Workflow\"":{"main":[[{"node":"setData","type":"main","index":0}]]},"ScanFolderNCC":{"main":[[{"node":"ifConditionDate","type":"main","index":0}]]},"ifFolder":{"main":[[{"node":"Switch","type":"main","index":0}]]},"ifConditionDate":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Split In Batches","type":"main","index":0}],[{"node":"ScanFolderNCC","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"Execute Workflow","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Execute Workflow":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"ScanOneMonth":{"main":[[{"node":"setData","type":"main","index":0}]]},"ScanProduction":{"main":[[{"node":"setData2","type":"main","index":0}]]},"setData2":{"main":[[{"node":"FTP","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[10]}},"pinData":{},"versionId":"9c60dbd7-0645-4094-9d0c-fd7eb353734c","triggerCount":1,"tags":[]}