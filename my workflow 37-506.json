{"createdAt":"2023-09-01T17:43:53.796Z","updatedAt":"2023-09-02T07:14:11.000Z","id":"506","name":"My workflow 37","active":false,"nodes":[{"parameters":{},"id":"4294a658-a8dd-4e8b-a536-b31febfb6b08","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[580,320]},{"parameters":{"httpMethod":"POST","path":"1b91679a-ecce-4da8-95fd-97b1fb15edbf","options":{}},"id":"65283ed3-1fe9-4c59-ac13-a1b309bad5d1","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-440,660],"webhookId":"1b91679a-ecce-4da8-95fd-97b1fb15edbf"},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a3f06e972d78d009"},{"name":"appSecret","value":"pL1iYqdStpaLkk3nDzh6ehmaC2l1vLnW"},{"name":"baseId","value":"Ebg8bGQekarOvAsbCHouKlvvsNd"},{"name":"tableId","value":"tblwFknbZEqS4rOh"}]},"options":{}},"id":"4cefb8e0-09f0-4bd3-b06a-daa1e72293cd","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[-220,660]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\" : \"{{ $('Set').item.json[\"appId\"] }}\",\n\"app_secret\" : \"{{ $('Set').item.json[\"appSecret\"] }}\" \n}","options":{}},"id":"9f01563b-9a22-48a3-b4fc-367bb8b2d0f8","name":"get app_access_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,660]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{ $('Set').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \n    \"name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"full_name\"] }}\",\n    \"id\":\"{{$('Webhook').item.json[\"body\"][\"id\"]}}\",\n    \"phone\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"phone_number\"] }}\",\n    \"status\":\"{{$('Webhook').item.json[\"body\"][\"status_name\"]}}\",\n    \"product_id\":\"{{$('Webhook').item.json[\"body\"][\"items\"][0][\"product_id\"]}}\",\n    \"variation_id\":\"{{$('Webhook').item.json[\"body\"][\"items\"][0][\"variation_id\"]}}\",\n    \"product_name\":\"{{$('Webhook').item.json[\"body\"][\"items\"][0][\"variation_info\"][\"name\"]}}\",\n    \"quantity\":{{$('Webhook').item.json[\"body\"][\"items\"][0][\"quantity\"]}},\n    \"total_price\":{{$('Webhook').item.json[\"body\"][\"total_price\"]}},\n    \"total_discount\":{{$('Webhook').item.json[\"body\"][\"total_discount\"]}},\n    \"total_price_after_sub_discount\":{{$('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"]}},\n    \"nguon\":\"{{$('Webhook').item.json[\"body\"][\"order_sources_name\"]}}\",\n    \"phi_ship\":{{$('Webhook').item.json[\"body\"][\"shipping_fee\"]}},\n    \"address\":\"{{$('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"]}}\",\n    \"commnue_name\":\"{{$('Webhook').item.json[\"body\"][\"shipping_address\"][\"commnue_name\"]}}\",\n    \"district_name\":\"{{$('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"]}}\",\n    \"province_name\":\"{{$('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"]}}\"\n   }\n}","options":{}},"id":"8c929d6d-39d1-457d-89b0-7db6bde5faaf","name":"Add base","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[460,460]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').item.json.body.status_name }}","value2":"new"}]}},"id":"15f942ad-ecde-45e6-b5d7-1f310b8a0f96","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[220,660]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records?filter=CurrentValue.[id] = \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"42771daf-257a-4d6d-8546-988ddc70cbfe","name":"Get record ID","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[460,840]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records/{{ $('Get record ID').item.json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \n \"status\":\"{{$('Webhook').item.json[\"body\"][\"status_name\"]}}\"\n   }\n}","options":{}},"id":"40997ec3-647f-42ec-a792-2930d988daf1","name":"Update","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[640,840]}],"connections":{"Webhook":{"main":[[{"node":"Set","type":"main","index":0}]]},"Set":{"main":[[{"node":"get app_access_token","type":"main","index":0}]]},"get app_access_token":{"main":[[{"node":"IF","type":"main","index":0}]]},"IF":{"main":[[{"node":"Add base","type":"main","index":0}],[{"node":"Get record ID","type":"main","index":0}]]},"Get record ID":{"main":[[{"node":"Update","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{"Get record ID":[{"json":{"code":0,"data":{"has_more":false,"items":[{"fields":{"address":"test","commnue_name":"Xã Hưng Nhượng","district_name":"Huyện Giồng Trôm","id":"9","name":"Thang","nguon":"Facebook","phi_ship":"0","phone":"0587897777","product_id":"c728e483-8d38-4b8d-ab23-fa9c9531d7f7","province_name":"Bến Tre","quantity":"1","status":"new","time":1691486564646,"total_discount":"0","total_price":"999999","total_price_after_sub_discount":"999999"},"id":"recfE3Xmp6","record_id":"recfE3Xmp6"}],"page_token":"recfE3Xmp6","total":1},"msg":"success"},"pairedItem":{"item":0}}]},"versionId":"d1c620b3-b7ae-4234-91ed-eceebfb01f87","triggerCount":0,"tags":[]}