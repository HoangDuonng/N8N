{"createdAt":"2023-10-18T03:32:35.795Z","updatedAt":"2023-10-24T10:29:35.000Z","id":"562","name":"PRS API Order","active":true,"nodes":[{"parameters":{},"id":"7a3f11b1-c2e1-420c-866e-ba6c8dc95ab5","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[1460,580]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"api","value":"https://dstt.postmart.vn/api/prs/v2/"},{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"},{"name":"modules[0]","value":"salesOrder"},{"name":"modules[1]","value":"purchasesOrder"},{"name":"modules[2]","value":"goodsReceipt"},{"name":"apiCom","value":"https://dstt.postmart.com.vn/api/prs/v2/"},{"name":"modules[3]","value":"suppliers"},{"name":"modules[4]","value":"organization"}],"number":[{"name":"limit","value":50}]},"options":{}},"id":"eff68f36-d875-42fc-843a-19a57d93a6ae","name":"meta","type":"n8n-nodes-base.set","typeVersion":2,"position":[1680,580]},{"parameters":{"method":"POST","url":"={{ $('meta').item.json.apiCom }}contents/{{ $('Set').item.json.module }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.data }}","options":{}},"id":"4cf131e4-5780-426d-aa57-21d6a034b85c","name":"UpdateData","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3660,680],"retryOnFail":true},{"parameters":{"url":"={{ $('meta').item.json.api }}contents/{{ $('Set').item.json.module }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"={{ $('meta').item.json.limit }}"},{"name":"last_updated","value":"={{ $json.data.last_updated }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"715be169-6bef-48d7-b370-94d03788ba13","name":"getDataApi","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2860,560],"retryOnFail":true},{"parameters":{"fieldToSplitOut":"body.data.data","options":{"destinationFieldName":"data"}},"id":"9a592396-158a-4a8a-947b-f74c8da5faa0","name":"ItemLists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[3120,560]},{"parameters":{"fieldToSplitOut":"modules","options":{"destinationFieldName":"module"}},"id":"aaa01eaa-0cfe-436b-ac4e-c1f6c328ad3f","name":"ModuleLists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[1900,580]},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":2}]}},"id":"7169156f-88ae-4ec6-96fa-388386e27592","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[1460,840]},{"parameters":{"url":"={{ $('meta').item.json.apiCom }}last-updated/{{ $json.module }}","options":{}},"id":"cb7f8f08-a846-44d1-8715-eb1990b3e11a","name":"LastUpdateTime","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2600,480],"retryOnFail":true},{"parameters":{"options":{}},"id":"d9a9706d-8d58-420c-b050-f7e68777dfb1","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[2380,480]},{"parameters":{"conditions":{"boolean":[{"value1":true,"value2":"={{ $('SplitOrders').context[\"noItemsLeft\"] }}"}]}},"id":"e97bf300-f0c3-4f8b-b89b-396666c27ab7","name":"IFDone","type":"n8n-nodes-base.if","typeVersion":1,"position":[3860,680]},{"parameters":{"conditions":{"boolean":[{"value1":true,"value2":"={{ $('SplitOrderLines').context[\"noItemsLeft\"] }}"}]}},"id":"0549d969-ad86-4023-837b-62d560c68e99","name":"IFDoneOrderLine","type":"n8n-nodes-base.if","typeVersion":1,"position":[4820,440]},{"parameters":{"method":"POST","url":"=https://dstt.postmart.com.vn/api/prs/v2/contents/{{ $('Set').item.json.module }}Products","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.data }}","options":{"response":{"response":{"fullResponse":true}}}},"id":"c0cb1c5d-83a9-4801-9f2e-54fbfb6424d0","name":"PutOrderLine","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4640,440],"retryOnFail":true},{"parameters":{"batchSize":1,"options":{"reset":"={{ $('SplitOrderLines').context[\"noItemsLeft\"] }}"}},"id":"acf9b82e-def1-46a3-a56c-6271f1748c65","name":"SplitOrderLines","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[4200,460]},{"parameters":{"fieldToSplitOut":"data.data","options":{"destinationFieldName":"data"}},"id":"73770ddd-6a59-401b-9cdd-0b427aa7ac0a","name":"OrderLineLists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[3980,460]},{"parameters":{"url":"=https://dstt.postmart.vn/api/prs/v2/contents/{{ $('Set').item.json.module }}Products","sendQuery":true,"queryParameters":{"parameters":[{"name":"order_id","value":"={{ $json.data.id }}"},{"name":"limit","value":"30"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"={{ $('meta').item.json.token }}"}]},"options":{}},"id":"2a4ab913-6290-479b-be9f-82b6f00f8df2","name":"GetOrderLine","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3760,460],"retryOnFail":true},{"parameters":{"batchSize":1,"options":{}},"id":"9b2b4a94-8ed3-41e5-9a5f-b52a8097872f","name":"SplitModules","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[2160,580]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Set').item.json.module }}","operation":"notEqual","value2":"suppliers"},{"value1":"={{ $('Set').item.json.module }}","operation":"notEqual","value2":"organization"}]}},"id":"a5f68cef-c5a4-4030-bd72-a5fca6ae392f","name":"ifHasProducts","type":"n8n-nodes-base.if","typeVersion":1,"position":[3540,480]},{"parameters":{"batchSize":1,"options":{"reset":"={{ $('SplitOrders').context[\"noItemsLeft\"] }}"}},"id":"23a14141-115f-419c-897e-07871bbb5db3","name":"SplitOrders","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[3380,700]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","operation":"isEmpty"}]}},"id":"df8becf6-6c3d-463a-8213-3c06fe054de5","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[4420,360]}],"connections":{"When clicking \"Execute Workflow\"":{"main":[[{"node":"meta","type":"main","index":0}]]},"meta":{"main":[[{"node":"ModuleLists","type":"main","index":0}]]},"getDataApi":{"main":[[{"node":"ItemLists","type":"main","index":0}]]},"ModuleLists":{"main":[[{"node":"SplitModules","type":"main","index":0}]]},"UpdateData":{"main":[[{"node":"IFDone","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"meta","type":"main","index":0}]]},"LastUpdateTime":{"main":[[{"node":"getDataApi","type":"main","index":0}]]},"Set":{"main":[[{"node":"LastUpdateTime","type":"main","index":0}]]},"ItemLists":{"main":[[{"node":"SplitOrders","type":"main","index":0}]]},"IFDone":{"main":[[{"node":"SplitModules","type":"main","index":0}],[{"node":"SplitOrders","type":"main","index":0}]]},"PutOrderLine":{"main":[[{"node":"IFDoneOrderLine","type":"main","index":0}]]},"SplitOrderLines":{"main":[[{"node":"IF","type":"main","index":0}]]},"OrderLineLists":{"main":[[{"node":"SplitOrderLines","type":"main","index":0}]]},"GetOrderLine":{"main":[[{"node":"OrderLineLists","type":"main","index":0}]]},"IFDoneOrderLine":{"main":[[],[{"node":"SplitOrderLines","type":"main","index":0}]]},"SplitModules":{"main":[[{"node":"Set","type":"main","index":0}]]},"ifHasProducts":{"main":[[{"node":"GetOrderLine","type":"main","index":0}]]},"SplitOrders":{"main":[[{"node":"ifHasProducts","type":"main","index":0},{"node":"UpdateData","type":"main","index":0}]]},"IF":{"main":[[{"node":"PutOrderLine","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"27252767-fac6-4ab2-bf17-c2982ff5ebdd","triggerCount":1,"tags":[]}