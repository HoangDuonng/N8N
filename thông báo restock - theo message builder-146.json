{"createdAt":"2023-06-22T08:26:16.742Z","updatedAt":"2023-09-14T09:55:28.000Z","id":"146","name":"Th√¥ng b√°o RESTOCK - THEO MESSAGE BUILDER","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"CASSO","options":{"rawBody":false}},"id":"08efff00-6962-46c5-91cc-5dfa5156bb44","name":"Input","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-320,460],"webhookId":"4fba380b-3d01-4602-b012-a53ff9ae0543"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/63157d5b-78fd-4a48-9f7c-826bbe8807a4","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"config\": {\n      \"wide_screen_mode\": true,\n      \"enable_forward\": true\n    },\n    \"elements\": [\n      {\n        \"tag\": \"markdown\",\n        \"content\": \"**C·∫¨P NH·∫¨T L·ªäCH RESTOCK**\\n\"\n      },\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"bisect\",\n        \"background_style\": \"grey\",\n        \"horizontal_spacing\": \"default\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"text_align\": \"center\",\n                \"content\": \"M√£ S·∫£n ph·∫©m\\n**{{ $('Input').item.json['body']['sku'] }}**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"text_align\": \"center\",\n                \"content\": \"M√†u\\n**{{$('Input').item.json['body']['somau']}} m√†u**\\n\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"text_align\": \"center\",\n                \"content\": \"D·ª± ki·∫øn Nh·∫≠p Kho\\n**{{$('Input').item.json['body']['deadline']}}**\"\n              }\n            ]\n          }\n        ]\n      },\n      {\n        \"tag\": \"markdown\",\n        \"content\": \"**C√°c M√£ Restock ƒëang tr√™n chuy·ªÅn**\"\n      },\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"grey\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**M√£ SKU**\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**S·ªë L∆∞·ª£ng**\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**D·ª± ki·∫øn**\",\n                \"text_align\": \"center\"\n              }\n            ]\n          }\n        ]\n      },\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"default\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$('getInfo').item.json['body']['data']['items'][0]['fields']['M√£ SKU']}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$json[\"body\"][\"data\"][\"items\"][0][\"fields\"][\"T·ªïng Slg\"]}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$('Input').item.json['body']['deadline']}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          }\n        ]\n      },\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"default\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$('getInfo').item.json['body']['data']['items'][1]['fields']['M√£ SKU']}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$('Set').item.json[\"body\"][\"data\"][\"items\"][1][\"fields\"][\"T·ªïng Slg\"]}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"{{$('Input').item.json['body']['deadline']}}\",\n                \"text_align\": \"center\"\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n","options":{}},"id":"3d92618a-f725-4e9d-b267-7613c0f8cdd6","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[420,460]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal","sendBody":true,"bodyParameters":{"parameters":[{"name":"app_id","value":"cli_a4d6c704d9b85009"},{"name":"app_secret","value":"mY1fnsO5t2PvCRhKV6TxLfYuO5Iw57zh"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"f786322d-c847-4c88-a691-02ed2cea9900","name":"tenantAccess","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-100,460]},{"parameters":{"url":"https://open.larksuite.com/open-apis/bitable/v1/apps/JOk4bfCo4avzkwsU8y2ua8uestb/tables/tbljfp0pcwzI1LEZ/records","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter","value":"=CurrentValue.[M√£ LSX]=\"{{ $node[\"Input\"].json[\"body\"][\"malsx\"] }}\""},{"name":"page_size","value":"20"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"body\"][\"tenant_access_token\"] }}"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"009c2532-c9ae-4a18-854c-7a3f24835e2a","name":"getInfo","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[80,460]},{"parameters":{"jsCode":"let htmlTables = '<div class=\"table-wrapper\">';\nlet maSKU = \"\"; // T√™n M√£ SKU bi·∫øn th·ªÉ m√†u\nlet tenSP = \"\"; // T√™n SP\nconst quantity = \"\"; // T·ªïng s·ªë l∆∞·ª£ng SX\nlet lenhSXexport='';\n\n\nfor (const item of $input.all()) {\n  for (const items of item.json.body.data.items) {\n    maSKU = items.fields[\"M√£ SKU\"]|| \"\";\n    quantity = items.fields[\"T·ªïng Slg\"]\n    }\n\nhtmlTables += ;\n\n  break; // Tho√°t kh·ªèi v√≤ng l·∫∑p sau khi l·∫•y gi√° tr·ªã ƒë·∫ßu ti√™n\n  }\n}\nfor (const item of $input.all()) {\n  for (const items of item.json.body.data.items) {\n    const MaVaiChinh = items.fields[\"M√£ V·∫£i Ch√≠nh\"] || \"\";;\n    const sizeS = items.fields[\"üìù S\"] || \"\";;\n    const sizeM = items.fields[\"üìù M\"] || \"\";;\n    const sizeL = items.fields[\"üìù L\"] || \"\";;\n    const sizeXL = items.fields[\"üìù XL\"] || \"\";;\n    const sizeFS = items.fields[\"üìù FS\"] || \"0\";;\n    const DinhMuc = items.fields[\"‚õî ƒê·ªãnh m·ª©c\"] || \"\";;\n    const SoMet = items.fields[\"T·ªïng Slg V·∫£i Ch√≠nh (m)\"] || \"\";;\n    const MaVaiPhu = items.fields[\"üìùM√£ V·∫£i ph·ª•\"] || \"\";;\n    const DinhMucPhu = items.fields[\"‚õî ƒê·ªãnh m·ª©c v·∫£i ph·ª•\"] || \"\";;\n    const TongMetPhu = items.fields[\"T·ªïng Slg V·∫£i ph·ª• (m)\"] || \"\";;  \n    const TongSML = items.fields[\"T·ªïng Slg\"] || \"\";;  \n\n        htmlTables += `\n<table>\n  <thead>\n    <tr>\n      <td colspan=\"2\" class=\"bentrai bold-big\">V·∫£i ch√≠nh:</td>\n      <td class=\"bold-big\">ƒê·ªãnh m·ª©c</td>\n      <td class=\"bold-big\">S·ªë m√©t</td>\n      <td class=\"bold-big\">S</td>\n      <td class=\"bold-big\">M</td>\n      <td class=\"bold-big\">L</td>\n      <td class=\"bold-big\">XL</td>\n      <td class=\"bold-big\">FS</td>\n      <td class=\"bold-big cot-cuoi\">T·ªïng SL</td>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class=\"cot-1 bentrai bold-big\" rowspan=\"2\">${MaVaiChinh}</td>\n      <td class=\"cot-2\" style=\"font-weight:bold;\">Y√™u c·∫ßu</td>\n      <td class=\"cot-3 bold-big\">${DinhMuc}</td>\n      <td class=\"cot-4 bold-big\">${SoMet}</td>\n      <td class=\"cot-5 bold-big\">${sizeS}</td>\n      <td class=\"cot-5 bold-big\">${sizeM}</td>\n      <td class=\"cot-5 bold-big\">${sizeL}</td>\n      <td class=\"cot-5 bold-big\">${sizeXL}</td>\n      <td class=\"cot-5 bold-big\">${sizeFS}</td>\n      <td class=\"cot-5 bold-big\">${TongSML}</td>\n    </tr>\n    <tr>\n      <td>Th·ª±c c·∫Øt</td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td class=\"bentrai bold-big\">V·∫£i l√≥t</td>\n      <td>${MaVaiPhu}</td>\n      <td>${DinhMucPhu}</td>\n      <td>${TongMetPhu}</td>\n      <td class=\"ghichu\" colspan=\"3\" rowspan=\"3\">*Ghi ch√∫ n·ªôi b·ªô</td>\n      <td class=\"ghichu\" colspan=\"3\" rowspan=\"3\">*Ghi ch√∫ x∆∞·ªüng</td>\n    </tr>\n    <tr>\n      <td class=\"bentrai bold-big\">N√∫t</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td class=\"bentrai bold-big\">Ph·ª• li·ªáu kh√°c</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table></br>\n`;\n  }\n}\n\nhtmlTables += `</div>`;\nreturn {\n  htmlTables: htmlTables,\n  lenhsx: lenhSXexport\n};"},"id":"6cc061db-17e7-4f10-9bd1-ac74556711ec","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[240,660]},{"parameters":{"values":{"number":[{"name":"qty1","value":"={{ $('getInfo').item.json[\"body\"][\"data\"][\"items\"][0][\"fields\"][\"T·ªïng Slg\"] }}"},{"name":"qty2","value":"={{ $('getInfo').item.json[\"body\"][\"data\"][\"items\"][1][\"fields\"][\"T·ªïng Slg\"] }}"}]},"options":{}},"id":"c6fc6160-40a8-4f98-9ba5-181528753747","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[260,460]}],"connections":{"Input":{"main":[[{"node":"tenantAccess","type":"main","index":0}]]},"tenantAccess":{"main":[[{"node":"getInfo","type":"main","index":0}]]},"getInfo":{"main":[[{"node":"Set","type":"main","index":0}]]},"HTTP Request":{"main":[[]]},"Set":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"e5f81640-44ef-401a-8be4-c5870f975e37","triggerCount":1,"tags":[]}