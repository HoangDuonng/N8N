{"createdAt":"2023-05-13T03:30:22.436Z","updatedAt":"2023-05-16T05:57:58.000Z","id":"93","name":"Mieu-Auto-Tao-Don-Dat-Hang","active":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"b89bc4bd-a37b-47a3-9f9f-8e2631d1ca96","options":{}},"id":"629e9a43-0bea-4422-94a4-854bcedaeb52","name":"Get[MaCha]SP","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[260,440],"webhookId":"b89bc4bd-a37b-47a3-9f9f-8e2631d1ca96"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal","sendBody":true,"bodyParameters":{"parameters":[{"name":"app_id","value":"cli_a4d6c704d9b85009"},{"name":"app_secret","value":"mY1fnsO5t2PvCRhKV6TxLfYuO5Iw57zh"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"0b40b00c-086d-44b8-b074-9fa5ad960754","name":"LayTenant","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[440,440]},{"parameters":{"url":"https://open.larksuite.com/open-apis/bitable/v1/apps/Msutb7MNoaCxwvsCC95ucZGbs1b/tables/tbl9gF3qOqEk1dT2/records","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter","value":"=CurrentValue.[Mã cha]=\"{{ $node[\"Get[MaCha]SP\"].json[\"body\"][\"macha\"] }}\""},{"name":"page_size","value":"20"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $node[\"LayTenant\"].json[\"body\"][\"tenant_access_token\"] }}"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"9f1bf527-8d0c-4f71-85b5-50530560d303","name":"LayInfoDonHang","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[640,440]},{"parameters":{"jsCode":"let htmlTables = '<div class=\"table-wrapper\">';\nlet tenXuongSX = \"\"; // Tên Xưởng SX\nlet tenSP = \"\"; // Tên SP\nlet maRap = \"\"; // Mã Rập\n\nlet tongsp=0;\nfor (const item of $input.all()) {\n  for (const items of item.json.body.data.items) {\n    tongsp += parseInt(items.fields[\"S\"]) || 0;;\n    tongsp += parseInt(items.fields[\"M\"]) || 0;;\n    tongsp += parseInt(items.fields[\"L\"]) || 0;;\n    tongsp += parseInt(items.fields[\"XL\"]) || 0;;\n  }\n}\n\n\nfor (const item of $input.all()) {\n  for (const items of item.json.body.data.items) {\n    tenXuongSX = items.fields[\"Tên Xưởng SX\"]|| \"\";\n    tenSP = items.fields[\"Tên SP Cha\"]?.[0]?.text || \"\";\n\n    const maRapArray = items.fields[\"Mã Rập\"];\n    if (Array.isArray(maRapArray) && maRapArray.length > 0) {\n      maRap = maRapArray[0]?.text || \"\";\n    }\n\n\n\nhtmlTables += `<table><thead><tr><th class=\"bentrai\">Mã Rập</th><th>${maRap}</th> <th>Tên SP</th><th>${tenSP}</th></tr></thead><tbody><tr><td>Xưởng gia công</td><td>${tenXuongSX}</td>\n      <td>Số lượng SX</td>\n      <td>${tongsp}</td>\n    </tr>\n    <tr>\n      <td>Ngày đặt hàng</td>\n      <td>12/03/2004</td>\n      <td>Lệnh SX</td>\n      <td>ACB123</td>\n    </tr>\n    <tr>\n      <td>Ngày giao dự kiến</td>\n      <td>15/03/2004</td>\n      <td>Loại SX</td>\n      <td>Mới</td>\n    </tr>\n  </tbody>\n</table>\n`;\n  break; // Thoát khỏi vòng lặp sau khi lấy giá trị đầu tiên\n  }\n}\nfor (const item of $input.all()) {\n  for (const items of item.json.body.data.items) {\n    const maSKU = items.fields[\"Mã SKU\"] || \"\";;\n    const sizeS = items.fields[\"S\"] || \"\";;\n    const sizeM = items.fields[\"M\"] || \"\";;\n    const sizeL = items.fields[\"L\"] || \"\";;\n    const sizeXL = items.fields[\"XL\"] || \"\";;\n    htmlTables += `\n<table><thead><tr><td colspan=\"2\">Vải chính:</td><td>Định mức</td><td>Số mét</td><td>S</td><td>M</td><td>L</td><td>XL</td><td>Tổng SL</td></tr></thead><tbody><tr><td class=\"cot-1 bentrai\" rowspan=\"2\">${maSKU}</td><td class=\"cot-2\">Yêu cầu</td><td class=\"cot-3\"></td><td class=\"cot-4\"></td><td class=\"cot-5\">${sizeS}</td><td class=\"cot-5\">${sizeM}</td><td class=\"cot-5\">${sizeL}</td><td class=\"cot-5\">${sizeXL}</td><td></td></tr><tr><td>Thực cắt</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Vải lót</td><td></td><td></td><td></td><td colspan=\"5\" rowspan=\"3\"></td></tr><tr><td>Nút</td><td></td><td></td><td></td></tr><tr><td>Phụ liệu khác</td><td></td><td></td><td></td></tr></tbody></table></br>\n`;\n  }\n}\nhtmlTables += `</div>`;\nreturn {\n  htmlTables: htmlTables\n};\n"},"id":"8bd3d0f5-c857-46f7-b009-5d4063479d9b","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[840,440]},{"parameters":{"html":"<!DOCTYPE html>\n\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>My HTML document</title>\n</head>\n<body>\n  <div class=\"container\">\n    <h1><img src=\"https://theme.hstatic.net/200000561729/1000985167/14/logo.png?v=311\" width=\"18%\"/></h1>\n    <span>  Địa chỉ: 406/2 Lê Văn Sỹ, Q3 </span>\n    <h2 style=\"text-align:center;font-size:2em;font-weight:bold;\">ĐƠN ĐẶT HÀNG</h2>\n    <p>Tháng:</p>\n    {{ $node[\"Code\"].json[\"htmlTables\"] }}\n    \n  </div>\n</body>\n</html>\n\n<style>\n.container {\n  background-color: #ffffff;\n  /*text-align: center;*/\n  padding: 16px;\n  border-radius: 8px;\n}\n\nbody{\n  text-align:left;\n}\nh1 {\n  color: #ff6d5a;\n  font-size: 24px;\n  font-weight: bold;\n  padding: 8px;\n}\n\nh2 {\n  color: #909399;\n  font-size: 18px;\n  font-weight: bold;\n  padding: 8px;\n}\n.table-wrapper {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .table-wrapper table {\n    width: 100%;\n    border-collapse: collapse;\n    font-family: Arial, sans-serif;\n    margin-bottom: 20px;\n  }\n\n  .table-wrapper th,\n  .table-wrapper td {\n    border: 1px solid #ddd;\n    padding: 8px;\n    text-align: center;\n  }\n\n  .table-wrapper th {\n    background-color: #f2f2f2;\n    font-weight: bold;\n  }\n\n  .table-wrapper tbody tr:nth-child(even) {\n    background-color: #f9f9f9;\n  }\n  .bentrai{\n    text-align: left;\n  }\n  .cot-1{\n    width:20%;\n  }\n  .cot-2,.cot-3,.cot-4{\n    width:15%;\n  }\n  .cot-5{\n   width:8%; \n  }\n</style>"},"id":"feee2cc6-0be2-46d6-b9d5-a05f69393c8f","name":"HTML","type":"n8n-nodes-base.html","typeVersion":1,"position":[1020,440]}],"connections":{"Get[MaCha]SP":{"main":[[{"node":"LayTenant","type":"main","index":0}]]},"LayTenant":{"main":[[{"node":"LayInfoDonHang","type":"main","index":0}]]},"LayInfoDonHang":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"HTML","type":"main","index":0}]]},"HTML":{"main":[[]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"3d747ef3-a754-4266-849e-c0a71dfeab78","triggerCount":0,"tags":[]}