{"createdAt":"2023-08-05T08:16:05.367Z","updatedAt":"2023-08-05T08:16:05.367Z","id":"454","name":"ReadGmail Zns","active":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{"q":" subject:xác nhận đặt phòng"},"options":{}},"id":"b0f8c7bf-aeb4-494f-a219-9173d712e8c4","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1,"position":[880,420],"credentials":{"gmailOAuth2":{"id":"72","name":"Gmail account 2"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the JSON of the item\n$input.item.json.email = $json.text.match(/[\\w.-]+@[\\w.-]+\\.[A-Za-z]{2,}/)[0];\n$input.item.json.bkno = $json.text.match(/Booking:\\s(\\d{4})/)[0];\n$input.item.json.phone = $json.text.match(/Số điện thoại\\s*:\\s*(\\d{10})/)[0];\n$input.item.json.phone = $json.text.match(/Số điện thoại\\s*:\\s*(\\d{10})/)[1];\n$input.item.json.guestname = $json.text.match(/Tên khách hàng:\\s*(.*)/)[0];\nreturn $input.item;\n"},"id":"daa1a393-2812-42fc-a54e-32e54f05f240","name":"Gedata","type":"n8n-nodes-base.code","typeVersion":1,"position":[1120,420]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={ \n\"app_id\": \"{{ $('Set').params[\"values\"][\"string\"][0][\"value\"] }}\", \n\"app_secret\": \"{{ $('Set').params[\"values\"][\"string\"][1][\"value\"] }}\"\n}","options":{}},"id":"1823b499-a56d-4074-9cd9-d481eb7856e3","name":"Get app token key","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1560,420]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').params[\"values\"][\"string\"][2][\"value\"] }}/tables/{{ $('Set').params[\"values\"][\"string\"][3][\"value\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('Get app token key').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={   \"fields\": \n{\n\"email\": \"{{ $('Set').item.json[\"email\"] }}\",\n\"phone\": \"{{ $('Set').item.json[\"phone\"] }}\",\n\"guestname\": \"{{ $('Set').item.json[\"guestname\"] }}\",\n\"bkno\": \"{{ $('Set').item.json[\"bkno\"] }}\"\n} \n\n}","options":{}},"id":"d02749c0-4b51-41fc-a1ac-4505d02dd3d9","name":"Push Base Lark","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1780,420]},{"parameters":{"values":{"string":[{"name":"appid","value":"cli_a379fd6670b89009"},{"name":"appsecret","value":"LQsJKWGA7aXQnPDQuaIUWgwIcVtZjU3Q"},{"name":"baseid","value":"WbGGb5ObFakE6UsANrvupF4Dsdd"},{"name":"tableid","value":"tblQrP0VPPuKgSBT"},{"name":"email","value":"={{ $json.email }}"},{"name":"phone","value":"={{ $json.phone }}"},{"name":"guestname","value":"={{ $json.guestname }}"},{"name":"bkno","value":"={{ $json.bkno }}"}]},"options":{}},"id":"a616440e-46fc-4a3d-8afc-0d685743e836","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[1340,420]}],"connections":{"Gmail Trigger":{"main":[[{"node":"Gedata","type":"main","index":0}]]},"Gedata":{"main":[[{"node":"Set","type":"main","index":0}]]},"Get app token key":{"main":[[{"node":"Push Base Lark","type":"main","index":0}]]},"Set":{"main":[[{"node":"Get app token key","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"de381c9b-c339-4846-936c-33be9a669eea","triggerCount":0,"tags":[]}