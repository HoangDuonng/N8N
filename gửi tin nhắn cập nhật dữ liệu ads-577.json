{"createdAt":"2023-11-21T13:24:13.774Z","updatedAt":"2023-11-21T13:55:08.000Z","id":"577","name":"Gửi tin nhắn cập nhật dữ liệu ads","active":true,"nodes":[{"parameters":{"rule":{"interval":[{"triggerAtHour":7}]}},"id":"93450f7a-43e8-4fba-a2ad-5d869501ff45","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-520,140]},{"parameters":{"documentId":{"__rl":true,"value":"1kfET9iXm7RaHANOdJeV8UfkG9oLrZ5_gfJhO0exQq6Q","mode":"id"},"sheetName":{"__rl":true,"value":"1494838516","mode":"id"},"options":{}},"id":"6c646f1f-ca9c-4e78-839f-d1282daf5f26","name":"Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[-300,140],"credentials":{"googleSheetsOAuth2Api":{"id":"139","name":"Google Sheets account 3"}}},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nconst output = {\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"config\": {\"wide_screen_mode\": true},\n    \"elements\": [\n      {\n        \"tag\": \"column_set\",\n        \"flex_mode\": \"none\",\n        \"background_style\": \"grey\",\n        \"columns\": [\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Tên Tài Khoản**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Sản phẩm**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Tuổi**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Target**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Chi phí / Đơn**\"\n              }\n            ]\n          },\n          {\n            \"tag\": \"column\",\n            \"width\": \"weighted\",\n            \"weight\": 1,\n            \"vertical_align\": \"top\",\n            \"elements\": [\n              {\n                \"tag\": \"markdown\",\n                \"content\": \"**Chi phí / Mess**\"\n              }\n            ]\n          }\n        ]\n      }\n    ],\n    \"header\": {\n      \"template\": \"blue\",\n      \"title\": {\n        \"content\": \"Báo cáo đơn tồn\",\n        \"tag\": \"plain_text\"\n      }\n    }\n  }\n}\n\n\nfor (const item of $input.all()) {\n  let format_item = {\n      \"tag\": \"column_set\",\n      \"flex_mode\": \"none\",\n      \"background_style\": \"grey\",\n      \"columns\": [\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Tên Tài Khoản\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Sản phẩm\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Tuổi\"].toString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Target\"],\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Chi phí / Đơn\"].toLocaleString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        },\n        {\n          \"tag\": \"column\",\n          \"width\": \"weighted\",\n          \"weight\": 1,\n          \"vertical_align\": \"top\",\n          \"elements\": [\n            {\n              \"tag\": \"div\",\n              \"text\": {\n                \"content\": item.json[\"Chi phí / mess\"].toLocaleString(),\n                \"tag\": \"plain_text\"\n              }\n            }\n          ]\n        }\n      ]\n    }\n  output['card']['elements'].push(format_item);\n  output['card']['header'].title.content = \"Dữ liệu quảng cáo \" + item.json[\"Tên Tài Khoản\"] + \" - \" + item.json[\"Sản phẩm\"];\n}\n\nreturn {'card': output};"},"id":"65d7c3f2-3330-42fd-9e6f-e8c7b7a427fe","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,120]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/cb0e3c9c-13af-494e-8337-9753472f18d3","sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.card }}","options":{}},"id":"dea6c3d9-4e80-4d19-b88c-9f3ebac9a027","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[360,120]},{"parameters":{"batchSize":1,"options":{"reset":false}},"id":"2cd9d954-7527-481a-aafa-90b6badb3074","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[-80,140]}],"connections":{"Schedule Trigger":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"Code":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"Code","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"115ce0c7-d702-4bf9-b39a-22b5790e862b","triggerCount":1,"tags":[]}