{"createdAt":"2023-07-18T04:39:40.941Z","updatedAt":"2023-09-05T11:54:28.000Z","id":"187","name":"Crawl FTP PRS","active":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 */6 * * *"}]}},"id":"23eab27e-2fc1-4b71-86be-14659ecacb92","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[80,1480]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/scan-folder","sendQuery":true,"queryParameters":{"parameters":[{"name":"shift_date","value":"0"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"ab83a953-22fd-4615-aed8-91ab1bb44bcd","name":"ListFolder","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[360,1480]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.data }}","operation":"isNotEmpty"}]}},"id":"0d9249fc-b5e8-4f30-b0f7-a1246ca1bc60","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[600,1480]},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"09fac41f-af5c-4073-8dc2-ea8422a566b4","name":"ItemListsFolder","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[860,1460]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/scan-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"file_path","value":"={{ $json.data }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"d2d6f908-b880-42b9-a6d3-8173657262b0","name":"ScanFileInFolder","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1320,1440],"retryOnFail":true,"waitBetweenTries":5000},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"e3f4fb6a-89b9-4c6f-9bd8-af31bfd82660","name":"ListFilePRS","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[1440,900]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/save-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"=path","value":"={{ $json.path }}"},{"name":"filename","value":"={{ $json.filename }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"ebc337b1-6b07-4497-b034-157e91e3ee75","name":"SaveFile2Storage","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2020,880],"alwaysOutputData":false,"executeOnce":false,"retryOnFail":true,"waitBetweenTries":5000,"maxTries":5,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.code }}","value2":"success"},{"value1":"={{ $json.data.file_id }}","operation":"isNotEmpty"}]},"combineOperation":"any"},"id":"c20c3173-e605-450f-b9a8-75f79bfb784b","name":"IF-Have-Row","type":"n8n-nodes-base.if","typeVersion":1,"position":[2740,280]},{"parameters":{"method":"POST","url":"https://dstt.postmart.vn/api/prs/workflow/read-file","sendQuery":true,"queryParameters":{"parameters":[{}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"sendBody":true,"contentType":"raw","rawContentType":"application/json","body":"={{ $json.data }}","options":{"batching":{"batch":{"batchSize":1,"batchInterval":2000}},"response":{"response":{"fullResponse":true}}}},"id":"47115d68-f705-41b5-b3b3-637f69c4dc88","name":"Insert2db","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3040,260],"retryOnFail":true,"waitBetweenTries":5000},{"parameters":{"fieldToSplitOut":"body.data.link_summary","options":{"destinationFieldName":"link"}},"id":"62873407-5c37-47df-80d0-2f2ad9ac40dc","name":"Item Lists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[3560,240]},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"95aca9e8-96ec-4a17-9a04-d912e09cc32d","name":"Tổng hợp BC","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3800,-40],"retryOnFail":true,"waitBetweenTries":3000,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"}]}},"id":"2c307af9-a902-4e49-adbd-6704695feb08","name":"Check exist Link","type":"n8n-nodes-base.if","typeVersion":1,"position":[3280,260]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/list-day","options":{}},"id":"520ad75e-3ef0-4e9f-b2e9-6ce569c082f4","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[280,1020]},{"parameters":{"fieldToSplitOut":"data","options":{"destinationFieldName":"link"}},"id":"ef821039-8f43-4650-9cca-d9905d31f828","name":"Item Lists1","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[480,1020]},{"parameters":{},"id":"9a7856aa-6972-4b6b-a64d-2745b29ed2b2","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[80,1020],"disabled":true},{"parameters":{"batchSize":1,"options":{}},"id":"e9e3a9d9-dbd3-4885-ab41-f3ec2496b748","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[700,1020],"executeOnce":false},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"62e44f8c-2eb0-4d4a-87d0-68bb2c1e125f","name":"ScanFileByLink","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1140,900],"executeOnce":false,"notesInFlow":false,"retryOnFail":true,"alwaysOutputData":false,"waitBetweenTries":5000,"maxTries":5,"continueOnFail":true},{"parameters":{"chatId":"-548413896","text":"PRS - Đã xử lý hết gói tin 500 năm","additionalFields":{}},"id":"f3a42bb4-92f8-4e08-a99f-71565c0aad32","name":"Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1140,1120],"credentials":{"telegramApi":{"id":"85","name":"Telegram account"}}},{"parameters":{"batchSize":1,"options":{}},"id":"c3305592-43a0-49e8-bdfe-22500d2ee916","name":"Split In Batches1","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[2340,580]},{"parameters":{"batchSize":1,"options":{}},"id":"58ad3a5d-651c-49d2-997b-0f12cd26e3fd","name":"Split In Batches2","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1760,900]},{"parameters":{"batchSize":1,"options":{}},"id":"9434b1b9-9a6d-4438-9141-125d98a7bca1","name":"Split In Batches3","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1080,1460]}],"connections":{"Schedule Trigger":{"main":[[{"node":"ListFolder","type":"main","index":0}]]},"IF":{"main":[[{"node":"ItemListsFolder","type":"main","index":0}]]},"ItemListsFolder":{"main":[[{"node":"Split In Batches3","type":"main","index":0}]]},"ListFilePRS":{"main":[[{"node":"Split In Batches2","type":"main","index":0}]]},"SaveFile2Storage":{"main":[[{"node":"Split In Batches1","type":"main","index":0}]]},"IF-Have-Row":{"main":[[{"node":"Insert2db","type":"main","index":0}],[{"node":"Split In Batches1","type":"main","index":0}]]},"Insert2db":{"main":[[{"node":"Check exist Link","type":"main","index":0}]]},"Item Lists":{"main":[[{"node":"Tổng hợp BC","type":"main","index":0}]]},"Check exist Link":{"main":[[{"node":"Item Lists","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Item Lists1","type":"main","index":0}]]},"Item Lists1":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"When clicking \"Execute Workflow\"":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"ScanFileByLink","type":"main","index":0}],[{"node":"Telegram","type":"main","index":0}]]},"Tổng hợp BC":{"main":[[{"node":"Split In Batches1","type":"main","index":0}]]},"ListFolder":{"main":[[{"node":"IF","type":"main","index":0}]]},"ScanFileByLink":{"main":[[{"node":"ListFilePRS","type":"main","index":0}]]},"ScanFileInFolder":{"main":[[{"node":"ListFilePRS","type":"main","index":0}]]},"Split In Batches1":{"main":[[{"node":"IF-Have-Row","type":"main","index":0}],[{"node":"Split In Batches2","type":"main","index":0}]]},"Split In Batches2":{"main":[[{"node":"SaveFile2Storage","type":"main","index":0}],[{"node":"Split In Batches","type":"main","index":0}]]},"Split In Batches3":{"main":[[{"node":"ScanFileInFolder","type":"main","index":0}]]}},"settings":{"callerPolicy":"workflowsFromSameOwner","saveManualExecutions":false},"staticData":null,"pinData":{"ScanFileInFolder":[{"json":{"body":{"code":"success","message":"Thành công","data":[{"filename":"BTCOM_XuatKho_05-09-2023+07-49-00.xml","path":"/GoodsShipment"},{"filename":"BTCOM_XuatKho_05-09-2023+09-49-00.xml","path":"/GoodsShipment"},{"filename":"BTCOM_XuatKho_05-09-2023+11-49-00.xml","path":"/GoodsShipment"},{"filename":"BTCOM_XuatKho_05-09-2023+14-49-00.xml","path":"/GoodsShipment"}]},"headers":{"server":"nginx/1.20.1","content-type":"application/json","transfer-encoding":"chunked","x-powered-by":"PHP/8.0.27","cache-control":"no-cache, private","date":"Tue, 05 Sep 2023 08:18:38 GMT","x-ratelimit-limit":"600","x-ratelimit-remaining":"600","vary":"Origin","x-frame-options":"SAMEORIGIN","x-content-type-options":"nosniff","content-security-policy":"upgrade-insecure-requests","strict-transport-security":"max-age=31536000; includeSubDomains; preload","expect-ct":"max-age=31536000, enforce","referrer-policy":"no-referrer-when-downgrade","x-xss-protection":"1; mode=block","x-permitted-cross-domain-policies":"master-only","x-download-options":"noopen","connection":"close"},"statusCode":200,"statusMessage":"OK"},"pairedItem":{"item":0}}]},"versionId":"b9fc12b4-72f9-4980-b457-00a3e1327653","triggerCount":0,"tags":[]}