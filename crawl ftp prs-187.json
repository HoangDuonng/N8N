{"createdAt":"2023-07-18T04:39:40.941Z","updatedAt":"2023-09-19T12:30:29.000Z","id":"187","name":"Crawl FTP PRS","active":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 */6 * * *"},{}]}},"id":"23eab27e-2fc1-4b71-86be-14659ecacb92","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-520,980]},{"parameters":{"url":"https://dstt.postmart.com.vn/api/prs/workflow/scan-folder","sendQuery":true,"queryParameters":{"parameters":[{"name":"shift_date","value":"0"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"ab83a953-22fd-4615-aed8-91ab1bb44bcd","name":"ListFolder","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-180,1220]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.data }}","operation":"isNotEmpty"}]}},"id":"0d9249fc-b5e8-4f30-b0f7-a1246ca1bc60","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[60,1220]},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"09fac41f-af5c-4073-8dc2-ea8422a566b4","name":"ItemListsFolder","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[320,1200]},{"parameters":{"url":"https://dstt.postmart.com.vn/api/prs/workflow/scan-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"file_path","value":"={{ $json.data }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"d2d6f908-b880-42b9-a6d3-8173657262b0","name":"ScanFileInFolder","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[780,1180],"retryOnFail":true,"waitBetweenTries":5000},{"parameters":{"fieldToSplitOut":"body.data","options":{}},"id":"e3f4fb6a-89b9-4c6f-9bd8-af31bfd82660","name":"ListFilePRS","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[1440,900]},{"parameters":{"url":"https://dstt.postmart.com.vn/api/prs/workflow/save-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"=path","value":"={{ $json.path }}"},{"name":"filename","value":"={{ $json.filename }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"ebc337b1-6b07-4497-b034-157e91e3ee75","name":"SaveFile2Storage","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2020,880],"alwaysOutputData":false,"executeOnce":false,"retryOnFail":true,"waitBetweenTries":5000,"maxTries":5,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"},{"value1":"={{ $json.body.data.file_id }}","operation":"isNotEmpty"}]}},"id":"c20c3173-e605-450f-b9a8-75f79bfb784b","name":"IF-Have-Row","type":"n8n-nodes-base.if","typeVersion":1,"position":[2380,540]},{"parameters":{"method":"POST","url":"https://dstt.postmart.com.vn/api/prs/workflow/read-file","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"sendBody":true,"contentType":"raw","rawContentType":"={{ $json.headers[\"content-type\"] }}","body":"={{ $json.body.data }}","options":{"response":{"response":{"fullResponse":true}}}},"id":"47115d68-f705-41b5-b3b3-637f69c4dc88","name":"Insert2db","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2820,260],"retryOnFail":true,"waitBetweenTries":5000,"alwaysOutputData":false},{"parameters":{"fieldToSplitOut":"body.data.link_summary","options":{"destinationFieldName":"link"}},"id":"62873407-5c37-47df-80d0-2f2ad9ac40dc","name":"Item Lists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[3420,240]},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"95aca9e8-96ec-4a17-9a04-d912e09cc32d","name":"Tổng hợp BC","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3940,0],"retryOnFail":true,"waitBetweenTries":3000,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"}]}},"id":"2c307af9-a902-4e49-adbd-6704695feb08","name":"Check exist Link","type":"n8n-nodes-base.if","typeVersion":1,"position":[3120,260]},{"parameters":{"batchSize":1,"options":{}},"id":"9434b1b9-9a6d-4438-9141-125d98a7bca1","name":"Split In Batches3","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[540,1200]},{"parameters":{"batchSize":1,"options":{}},"id":"bca8f02e-4c7d-4995-8cd5-a4afdc997dd2","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[3660,240]},{"parameters":{"batchSize":1,"options":{}},"id":"58ad3a5d-651c-49d2-997b-0f12cd26e3fd","name":"Split In File Store","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1740,900]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.code }}","value2":"success"}]}},"id":"c8bf027d-984b-4dee-a871-b4636c7b2392","name":"Check Sum Report API","type":"n8n-nodes-base.if","typeVersion":1,"position":[4180,-80]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"},{"value1":"={{ $json.body.data }}","operation":"isNotEmpty"}]}},"id":"6ebd61aa-08ea-4254-9d00-b1ac0f8b7a36","name":"Check Exists File","type":"n8n-nodes-base.if","typeVersion":1,"position":[1080,1180]},{"parameters":{"rule":{"interval":[{"triggerAtHour":1}]}},"id":"62c85b18-4f96-4189-87bc-3a68bb89214f","name":"Schedule Trigger1","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[-520,1600]},{"parameters":{"url":"https://dstt.postmart.com.vn/api/prs/workflow/scan-folder","sendQuery":true,"queryParameters":{"parameters":[{"name":"shift_date","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{}},"id":"3a382f3d-54f3-4e6c-8680-1e0ff9a47d69","name":"Quét lại 1 ngày","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-180,1600]}],"connections":{"Schedule Trigger":{"main":[[{"node":"ListFolder","type":"main","index":0}]]},"IF":{"main":[[{"node":"ItemListsFolder","type":"main","index":0}]]},"ItemListsFolder":{"main":[[{"node":"Split In Batches3","type":"main","index":0}]]},"ListFilePRS":{"main":[[{"node":"Split In File Store","type":"main","index":0}]]},"SaveFile2Storage":{"main":[[{"node":"IF-Have-Row","type":"main","index":0}]]},"IF-Have-Row":{"main":[[{"node":"Insert2db","type":"main","index":0}],[{"node":"Split In File Store","type":"main","index":0}]]},"Insert2db":{"main":[[{"node":"Check exist Link","type":"main","index":0}]]},"Item Lists":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"Check exist Link":{"main":[[{"node":"Item Lists","type":"main","index":0}]]},"ListFolder":{"main":[[{"node":"IF","type":"main","index":0}]]},"ScanFileInFolder":{"main":[[{"node":"Check Exists File","type":"main","index":0}]]},"Split In Batches3":{"main":[[{"node":"ScanFileInFolder","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"Tổng hợp BC","type":"main","index":0}],[{"node":"Split In File Store","type":"main","index":0}]]},"Split In File Store":{"main":[[{"node":"SaveFile2Storage","type":"main","index":0}],[{"node":"Split In Batches3","type":"main","index":0}]]},"Tổng hợp BC":{"main":[[{"node":"Check Sum Report API","type":"main","index":0},{"node":"Split In Batches","type":"main","index":0}]]},"Check Exists File":{"main":[[{"node":"ListFilePRS","type":"main","index":0}],[{"node":"Split In Batches3","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Quét lại 1 ngày","type":"main","index":0}]]},"Quét lại 1 ngày":{"main":[[{"node":"IF","type":"main","index":0}]]}},"settings":{"callerPolicy":"workflowsFromSameOwner","saveManualExecutions":false},"staticData":{"node:Schedule Trigger":{"recurrencyRules":[]},"node:Schedule Trigger1":{"recurrencyRules":[]}},"pinData":{},"versionId":"dc1f0b59-6972-4053-9929-bb2502cc48a8","triggerCount":2,"tags":[]}