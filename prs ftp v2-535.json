{"createdAt":"2023-09-19T03:10:13.069Z","updatedAt":"2023-09-19T12:30:21.000Z","id":"535","name":"PRS FTP v2","active":false,"nodes":[{"parameters":{"protocol":"sftp","operation":"list"},"id":"e5991475-6238-4e7d-8a8e-4986eebc0244","name":"FTP","type":"n8n-nodes-base.ftp","typeVersion":1,"position":[660,940],"credentials":{"sftp":{"id":"128","name":"SFTP account"}}},{"parameters":{"conditions":{"dateTime":[{"value1":"={{ $json.modifyTime }}","value2":"={{ $today }}"}]}},"id":"3235f269-60d1-4a0c-ab64-c45e7c1b7c8e","name":"Lọc Folder hôm nay","type":"n8n-nodes-base.filter","typeVersion":1,"position":[900,940]},{"parameters":{"batchSize":1,"options":{}},"id":"d9ef2dd8-54ae-4ca9-98ab-8b6e09aa9b62","name":"Cắt từng Folder","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1180,940]},{"parameters":{"protocol":"sftp","operation":"list","path":"={{ $json.path }}"},"id":"abcd20a2-9c67-48cd-bf7b-53c4d42d0cb1","name":"Quét file trong folder","type":"n8n-nodes-base.ftp","typeVersion":1,"position":[1400,920],"retryOnFail":true,"maxTries":5,"waitBetweenTries":5000,"credentials":{"sftp":{"id":"128","name":"SFTP account"}}},{"parameters":{"conditions":{"dateTime":[{"value1":"={{ $json.modifyTime }}","value2":"={{ $today }}"}]}},"id":"c1bb0eaf-2ead-4b0b-9947-24331e81ee40","name":"Lọc file hôm nay","type":"n8n-nodes-base.filter","typeVersion":1,"position":[1620,920]},{"parameters":{"batchSize":1,"options":{}},"id":"b9c73a0e-8732-433e-81ba-aeeb53abc253","name":"Cắt từng file","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1860,920]},{"parameters":{"protocol":"sftp","path":"={{ $json.body.data.path }}/{{ $json.body.data.filename }}"},"id":"176fde82-753a-4919-a528-8e7abadc08ac","name":"Down file","type":"n8n-nodes-base.ftp","typeVersion":1,"position":[2540,640],"alwaysOutputData":true,"retryOnFail":true,"waitBetweenTries":3000,"credentials":{"sftp":{"id":"128","name":"SFTP account"}}},{"parameters":{"options":{"normalize":true}},"id":"f3a0ddee-3c16-4013-b81a-f125a54bc1a3","name":"Chuyển sang json","type":"n8n-nodes-base.xml","typeVersion":1,"position":[2980,640],"alwaysOutputData":false,"executeOnce":false},{"parameters":{"setAllData":false,"options":{"encoding":"utf8"}},"id":"dad20529-8215-4629-b00a-45e605768048","name":"Chuyển dữ liệu ra xml","type":"n8n-nodes-base.moveBinaryData","typeVersion":1,"position":[2760,640]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"data","value":"={{ Object.values($json.Data)[0] }}"}]},"options":{}},"id":"0da011cc-1cc9-482e-ad4c-98f60fcdb7b5","name":"Làm sạch data","type":"n8n-nodes-base.set","typeVersion":2,"position":[3660,620]},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"533976df-ef83-4481-b9c0-f2947a18913e","name":"Chuyển data sang List","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[3900,620],"executeOnce":false},{"parameters":{"batchSize":"1","options":{"reset":false}},"id":"1c81ca58-1d0c-47ec-8a96-a296c0b24416","name":"Chia nhỏ item","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[4060,380]},{"parameters":{},"id":"9fec2089-1912-40d7-bb7d-9239d590a545","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[820,520],"disabled":true},{"parameters":{"jsCode":"return $input.first();"},"id":"e1c91b9d-b64f-4f49-a34c-9229e9a50ac2","name":"Code","type":"n8n-nodes-base.code","typeVersion":1,"position":[3200,640]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.Data }}","operation":"isNotEmpty"}]}},"id":"4de9c02b-c254-453f-ad07-7d99b8b69bec","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[3420,640]},{"parameters":{"method":"POST","url":"https://dstt.postmart.com.vn/api/prs/workflow/save-content","sendQuery":true,"queryParameters":{"parameters":[{"name":"bug","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{"response":{"response":{"fullResponse":true}}}},"id":"23eaf224-055b-4761-aaf8-f81144e78189","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4820,100],"retryOnFail":true,"waitBetweenTries":5000,"maxTries":5},{"parameters":{"url":"https://dstt.postmart.com.vn/api/prs/workflow/save-file-v2","sendQuery":true,"queryParameters":{"parameters":[{"name":"full_path","value":"={{ $json.path }}"},{"name":"filename","value":"={{ $json.name }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"ee2aafdc-259b-4e1b-86da-30fc57ab34cf","name":"Check File","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2100,900]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"}]}},"id":"cf37d4e8-7801-47d3-8436-c855649d5764","name":"IF1","type":"n8n-nodes-base.if","typeVersion":1,"position":[2320,900]},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.datafile = $('Check File').item.json.body.data;\n  \n}\nreturn $input.all();"},"id":"f7f909c9-981b-44e9-9459-196109d83b1f","name":"Code1","type":"n8n-nodes-base.code","typeVersion":1,"position":[4600,360]},{"parameters":{"fieldToSplitOut":"body.link_summary","options":{"destinationFieldName":"link"}},"id":"73481de3-3752-4c02-8878-2efb189f7e18","name":"Item Lists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[4720,800]},{"parameters":{"batchSize":1,"options":{}},"id":"08f11c22-0c5f-411e-a5ca-c9d5e8b5d7ac","name":"Split In Batches","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[4840,1160]},{"parameters":{"method":"POST","url":"https://dstt.postmart.com.vn/api/prs/workflow/save-filename","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Check File').item.json[\"body\"][\"data\"] }}","options":{"response":{"response":{"fullResponse":true}}}},"id":"868d65f5-dd39-47ca-a04b-a993abdaef88","name":"Đánh dấu file đã xong","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4220,600],"retryOnFail":true,"waitBetweenTries":5000},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"829431dc-f9c2-477b-895b-76cb0fcf0684","name":"Tổng hợp BC","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[5100,1140],"retryOnFail":true,"waitBetweenTries":3000,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"body.link_summary","operation":"isNotEmpty"}]}},"id":"8d5dc79e-fa63-4629-b028-12d34ab0975b","name":"IF2","type":"n8n-nodes-base.if","typeVersion":1,"position":[4440,680]},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":8}]}},"id":"d921d7b1-d519-4f13-9097-b14e1008d6fd","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[660,1300]}],"connections":{"FTP":{"main":[[{"node":"Lọc Folder hôm nay","type":"main","index":0}]]},"Lọc Folder hôm nay":{"main":[[{"node":"Cắt từng Folder","type":"main","index":0}]]},"Cắt từng Folder":{"main":[[{"node":"Quét file trong folder","type":"main","index":0}]]},"Quét file trong folder":{"main":[[{"node":"Lọc file hôm nay","type":"main","index":0}]]},"Lọc file hôm nay":{"main":[[{"node":"Cắt từng file","type":"main","index":0}]]},"Cắt từng file":{"main":[[{"node":"Check File","type":"main","index":0}],[{"node":"Cắt từng Folder","type":"main","index":0}]]},"Down file":{"main":[[{"node":"Chuyển dữ liệu ra xml","type":"main","index":0}]]},"Chuyển sang json":{"main":[[{"node":"Code","type":"main","index":0}]]},"Chuyển dữ liệu ra xml":{"main":[[{"node":"Chuyển sang json","type":"main","index":0}]]},"Làm sạch data":{"main":[[{"node":"Chuyển data sang List","type":"main","index":0}]]},"Chuyển data sang List":{"main":[[{"node":"Chia nhỏ item","type":"main","index":0}]]},"Chia nhỏ item":{"main":[[{"node":"Code1","type":"main","index":0}],[{"node":"Đánh dấu file đã xong","type":"main","index":0}]]},"When clicking \"Execute Workflow\"":{"main":[[]]},"Code":{"main":[[{"node":"IF","type":"main","index":0}]]},"IF":{"main":[[{"node":"Làm sạch data","type":"main","index":0}],[{"node":"Cắt từng file","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Chia nhỏ item","type":"main","index":0}]]},"Check File":{"main":[[{"node":"IF1","type":"main","index":0}]]},"IF1":{"main":[[{"node":"Down file","type":"main","index":0}],[{"node":"Cắt từng file","type":"main","index":0}]]},"Code1":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Item Lists":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"Đánh dấu file đã xong":{"main":[[{"node":"IF2","type":"main","index":0}]]},"Split In Batches":{"main":[[{"node":"Tổng hợp BC","type":"main","index":0}],[{"node":"Cắt từng file","type":"main","index":0}]]},"Tổng hợp BC":{"main":[[{"node":"Split In Batches","type":"main","index":0}]]},"IF2":{"main":[[{"node":"Item Lists","type":"main","index":0}],[{"node":"Cắt từng file","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"FTP","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"f39de93e-39fb-45b3-bf69-34f4cd3abb84","triggerCount":0,"tags":[]}