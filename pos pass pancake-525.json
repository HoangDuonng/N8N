{"createdAt":"2023-09-12T07:35:14.780Z","updatedAt":"2023-11-04T07:03:12.000Z","id":"525","name":"POS pass Pancake","active":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"1b91679a-ecce-4da8-95fd-123stufarm","options":{}},"id":"b7bff0ba-b70e-4334-a4d0-8af61c47ca19","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-440,660],"webhookId":"1b91679a-ecce-4da8-95fd-97b1fb15edbf"},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a4728c89b9b89010"},{"name":"appSecret","value":"VPxBThYjNh7CuRxNnXWQoGXCZmz7NWuP"},{"name":"baseId","value":"AYlRbXuWzaoThTsHtjult88dgMe"},{"name":"tableId","value":"=tblqgYrHPrnMyIes"}]},"options":{}},"id":"8109e508-9d0a-42d6-9237-044c2621a2e6","name":"Set","type":"n8n-nodes-base.set","typeVersion":2,"position":[0,660]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"app_id\" : \"{{ $('Set').item.json[\"appId\"] }}\",\n\"app_secret\" : \"{{ $('Set').item.json[\"appSecret\"] }}\" \n}","options":{}},"id":"e74960a4-296f-4530-a82e-ee1aa9463940","name":"get app_access_token","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[420,660]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{ $('Set').item.json[\"tableId\"] }}/records","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n    \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"partner_fee\": {{ $('Webhook').item.json[\"body\"][\"partner_fee\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"72998ddb-5035-48b8-b478-292ebb18075f","name":"Add base","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[960,580]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Get record ID').item.json[\"data\"][\"items\"] }}","operation":"isEmpty"}]}},"id":"4113c263-94d2-482d-9c87-698a337f08b9","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[780,660]},{"parameters":{"url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records?filter=CurrentValue.[id] = \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\"","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"options":{}},"id":"ff15cd41-3801-44b8-ac4c-e7cbf0c40ca7","name":"Get record ID","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[640,660]},{"parameters":{"method":"PUT","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $('Set').item.json[\"baseId\"] }}/tables/{{$('Set').item.json[\"tableId\"]}}/records/{{ $('Get record ID').item.json[\"data\"][\"items\"][0][\"record_id\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('get app_access_token').item.json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\":\n  { \"updated_at\" :{{ $('Date & Time').item.json[\"formattedDate\"] }} ,\n    \"name\": \"{{ $('Webhook').item.json[\"body\"][\"bill_full_name\"] }}\" ,\n    \"id\": \"{{ $('Webhook').item.json[\"body\"][\"id\"] }}\",\n    \"phone\": \"{{ $('Webhook').item.json[\"body\"][\"bill_phone_number\"] }}\",\n    \"status\": \"{{ $('Webhook').item.json[\"body\"][\"status_name\"] }}\",\n    \"total_price\": {{ $('Webhook').item.json[\"body\"][\"total_price\"] }},\n    \"total_discount\": {{ $('Webhook').item.json[\"body\"][\"total_discount\"] }},\n    \"total_price_after_sub_discount\": {{ $('Webhook').item.json[\"body\"][\"total_price_after_sub_discount\"] }},\n    \"nguon\": \"{{ $('Webhook').item.json[\"body\"][\"order_sources_name\"] }}\", \n \"phi_ship\": {{ $('Webhook').item.json[\"body\"][\"shipping_fee\"] }},\n    \"partner_fee\": {{ $('Webhook').item.json[\"body\"][\"partner_fee\"] }},\n    \"address\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"address\"] }}\",\n    \"commnue_name\":\"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"commune_id\"] }}\",\n    \"district_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"district_name\"] }}\",\n    \"province_name\": \"{{ $('Webhook').item.json[\"body\"][\"shipping_address\"][\"province_name\"] }}\"\n\n\n   }\n}","options":{}},"id":"a7c65114-91fb-4648-9c24-2019a5b7da3a","name":"Update","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[960,780]},{"parameters":{"operation":"formatDate","date":"={{ $('Webhook').item.json[\"body\"][\"updated_at\"] }}","format":"x","options":{}},"id":"f95a69fa-ed39-4480-b6a0-81a05a50fe2a","name":"Date & Time","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[240,660]}],"connections":{"Webhook":{"main":[[{"node":"Set","type":"main","index":0}]]},"Set":{"main":[[{"node":"Date & Time","type":"main","index":0}]]},"get app_access_token":{"main":[[{"node":"Get record ID","type":"main","index":0}]]},"IF":{"main":[[{"node":"Add base","type":"main","index":0}],[{"node":"Update","type":"main","index":0}]]},"Get record ID":{"main":[[{"node":"IF","type":"main","index":0}]]},"Date & Time":{"main":[[{"node":"get app_access_token","type":"main","index":0}]]}},"settings":{"saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"525","executionTimeout":300},"staticData":null,"pinData":{},"versionId":"6d0cbccd-83c1-4c85-a8da-1a1707e695f4","triggerCount":1,"tags":[]}