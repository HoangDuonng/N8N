{"createdAt":"2023-08-31T02:06:52.998Z","updatedAt":"2023-08-31T03:23:11.000Z","id":"502","name":"PRS Processing","active":false,"nodes":[{"parameters":{"conditions":{"string":[{"value1":"={{ $json.data }}","operation":"isNotEmpty"}]}},"id":"9fb4a49f-aa02-411d-a3d2-46c7186c8df7","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[-880,800]},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"825f268d-1321-49b8-ad59-85e81f5a4ff4","name":"ItemListsFolder","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[-640,780]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/scan-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"file_path","value":"={{ $json.data }}"},{}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"batching":{"batch":{"batchSize":1,"batchInterval":5000}},"timeout":30000}},"id":"68916cf5-3a8a-4e77-b914-a86fa0c03212","name":"ScanFileInFolder","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-400,780],"retryOnFail":true,"waitBetweenTries":5000,"continueOnFail":true},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"dd644026-009a-4bc6-b167-736407af4195","name":"ListFilePRS","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[-160,780]},{"parameters":{"url":"https://dstt.postmart.vn/api/prs/workflow/save-file","sendQuery":true,"queryParameters":{"parameters":[{"name":"=path","value":"={{ $json.path }}"},{"name":"filename","value":"={{ $json.filename }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"batching":{"batch":{"batchSize":1,"batchInterval":5000}},"response":{"response":{}}}},"id":"c9d99ada-225d-4acf-aea5-6d663559c52c","name":"SaveFile2Storage","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[80,780],"alwaysOutputData":false,"executeOnce":false,"retryOnFail":true,"waitBetweenTries":5000,"continueOnFail":true},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.code }}","value2":"success"},{"value1":"={{ $json.data.file_id }}","operation":"isNotEmpty"}]}},"id":"15b8d8d7-8f4e-47c0-b5a5-d4f4311f1882","name":"IF-Have-Row","type":"n8n-nodes-base.if","typeVersion":1,"position":[320,780]},{"parameters":{"method":"POST","url":"https://dstt.postmart.vn/api/prs/workflow/read-file","sendQuery":true,"queryParameters":{"parameters":[{}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"sendBody":true,"contentType":"raw","rawContentType":"application/json","body":"={{ $json.data }}","options":{"batching":{"batch":{"batchSize":1,"batchInterval":2000}},"response":{"response":{"fullResponse":true}}}},"id":"695250cb-4c68-4035-8248-50264b47c5d7","name":"Insert2db","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[560,760],"retryOnFail":true,"waitBetweenTries":5000},{"parameters":{"fieldToSplitOut":"body.data.link_summary","options":{"destinationFieldName":"link"}},"id":"8b8afeac-8e5c-4810-82a8-c06bb22a1584","name":"Item Lists","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[1040,540]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.body.code }}","value2":"success"}]}},"id":"3ab57db6-e11f-4404-b40e-22099a240114","name":"Check exist Link","type":"n8n-nodes-base.if","typeVersion":1,"position":[780,760]},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"token","value":"7a51b166dfe235dfec2901a24ed2f671"}]},"options":{"batching":{"batch":{"batchSize":1,"batchInterval":300000}}}},"id":"05a73bb6-de09-4b45-a058-35cd506d544c","name":"List Again","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1080,800],"executeOnce":false,"notesInFlow":false,"retryOnFail":true,"alwaysOutputData":false,"continueOnFail":true},{"parameters":{},"id":"5ad851af-0165-4807-b74f-a50baf99ddf5","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[-1260,800],"alwaysOutputData":false}],"connections":{"IF":{"main":[[{"node":"ItemListsFolder","type":"main","index":0}]]},"ItemListsFolder":{"main":[[{"node":"ScanFileInFolder","type":"main","index":0}]]},"ScanFileInFolder":{"main":[[{"node":"ListFilePRS","type":"main","index":0}]]},"ListFilePRS":{"main":[[{"node":"SaveFile2Storage","type":"main","index":0}]]},"SaveFile2Storage":{"main":[[{"node":"IF-Have-Row","type":"main","index":0}]]},"IF-Have-Row":{"main":[[{"node":"Insert2db","type":"main","index":0}]]},"Insert2db":{"main":[[{"node":"Check exist Link","type":"main","index":0}]]},"Check exist Link":{"main":[[{"node":"Item Lists","type":"main","index":0}]]},"List Again":{"main":[[{"node":"IF","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"List Again","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"878862ed-caca-485f-8529-0e9629046297","triggerCount":0,"tags":[]}