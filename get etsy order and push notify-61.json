{"createdAt":"2023-04-07T10:52:49.969Z","updatedAt":"2023-09-01T21:00:24.000Z","id":"61","name":"Get Etsy order and push Notify","active":true,"nodes":[{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"emailFrom","value":"={{ $json[\"from\"][\"value\"][0][\"address\"] }}"},{"name":"emailSubject","value":"={{ $json[\"subject\"] }}"},{"name":"emailContent","value":"={{ $json[\"text\"] }}"},{"name":"emailTo","value":"={{ $json[\"to\"][\"value\"][0][\"address\"] }}"}]},"options":{"dotNotation":false}},"id":"3cfcef77-f1fb-4118-b55f-ac9680e8c7d1","name":"Set","type":"n8n-nodes-base.set","typeVersion":1,"position":[-620,1140]},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"simple":false,"filters":{},"options":{}},"id":"ca6f31f5-901b-458d-b68e-292942577a99","name":"Etsy Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1,"position":[-820,1140],"credentials":{"gmailOAuth2":{"id":"24","name":"Gmail Etsy.TaloMedia@gmail.com"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// JSON of the item\n$input.item.json.shop = $('Set').all()[0].json.emailContent.split('Shop ')[1]\n$input.item.json.shop = $input.item.json.shop.split(':')[0]\n\n$input.item.json.card = $('Set').all()[0].json.emailContent.split(' account ending in ')[1]\n$input.item.json.card = $input.item.json.card.split(':')[0]\n\n$input.item.json.money = $('Set').all()[0].json.emailSubject.split('Your funds of ')[1]\n$input.item.json.money = $input.item.json.money.split(' ')[0]\n\n\nreturn $input.item;"},"id":"3b6224fe-3525-42ff-a253-385eda3e9e52","name":"Etsy.Deposit","type":"n8n-nodes-base.code","typeVersion":1,"position":[-140,1780]},{"parameters":{"dataType":"string","value1":"={{ $json[\"emailFrom\"] }}","rules":{"rules":[{"operation":"contains","value2":"transaction@etsy.com"},{"operation":"contains","value2":"conversations@mail.etsy.com","output":1},{"operation":"contains","value2":"support@etsy.com","output":2},{"operation":"contains","value2":"noreply@etsy.com","output":3},{"operation":"contains","value2":"legal@etsy.com","output":3},{"operation":"contains","value2":"trust@etsy.com>","output":3},{"operation":"contains","value2":"billing@etsy.com","output":3},{"operation":"contains","value2":"noreply@mail.etsy.com","output":3},{"operation":"contains","value2":"HappyHuesCo108@gmail.com "}]}},"id":"aa46e6ec-dfed-439d-9448-97b147539fcc","name":"Switch Etsy Email","type":"n8n-nodes-base.switch","typeVersion":1,"position":[-400,1140],"notesInFlow":false,"notes":"1. Etsy Order: \n- Digital: \"Etsy Order confirmation for\":  transaction@etsy.com\n- Physical: \"You made a sale on Etsy - Ship by\": transaction@etsy.com\n2. Etsy Conversation: \"Etsy Conversation with\": conversation@mail.etsy.com\n3. Deposit: \"Your funds of €1,206.19 EUR are on the way!\" support@etsy.com\n4.  Khách mở case: \"Etsy Support commented on your case\": noreply@etsy.com\n5. Bị Report: \"Notice of Intellectual Property Infringement\": noreply@etsy.com \n6. Đã điền Counter: \"We’ve processed your counter notice\": legal@etsy.com"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/6f9ac876-945b-4234-9936-cfe96918acd6","sendBody":true,"specifyBody":"json","jsonBody":"={{ $json[\"messageJson\"] }}","options":{}},"id":"11d3402b-7bf2-43ca-b06b-4bddcecf990e","name":"Push to Lark message1","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[440,1480]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.emailSubject = $('Set').all()[0].json.emailSubject.split('Etsy Conversation with ')[1]\n$input.item.json.buyerName = $input.item.json.emailSubject.split(' from ')[0]\n//Kiem tra tin nhan khach co Store ko\nif ($input.item.json.emailSubject.includes(' from ')) {\n  $input.item.json.buyerStore = $input.item.json.emailSubject.split(' from ')[1]\n  //Gan json ten store\n  $input.item.json.buyerStoreJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💈 Store:**\\\\n \" + \n$input.item.json.buyerStore + \"\\\"}},\";\n  //Gan json link ve store\n  $input.item.json.buyerStoreJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"View Shop\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/shop/\" + $input.item.json.buyerStore + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n}\n\n$input.item.json.buyerMess = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/conversations/')[2]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('>')[1]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('Reply')[0]\n// $input.item.json.buyerMess = JSON.stringify($input.item.json.buyerMess);\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(/\\n/g, \" \");\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(\"\\\"\", \" \");\n\n//Kiem tra tin nhan co listing ko\nif ($input.item.json.buyerMess.includes('etsy.com/listing/')) {\n  $input.item.json.buyerListing = $input.item.json.buyerMess.split('etsy.com/listing/')[1]\n  $input.item.json.buyerListing = $input.item.json.buyerListing.split('/')[0]\n  $input.item.json.buyerListingJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**🏷 Listing:**\\\\n \" + $input.item.json.buyerListing + \"\\\"}},\";\n    //Kiem tra co listing ko, neu ko co them , gan json bt\n    $input.item.json.buyerListingJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"ViewListing\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/listing/\" + $input.item.json.buyerListing + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n  \n}\n//Noi json lai thanh message push ve Lark\nif ($input.item.json.buyerListing && $input.item.json.buyerStore) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \",\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 WalterKlooShop message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerListing) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 WalterKlooShop message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerStore) {\n    $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 WalterKlooShop message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 WalterKlooShop message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n}\n\n\nreturn $input.item;"},"id":"fe48e6a0-0965-4913-a7a3-1d9613422c7c","name":"Etsy.Conversation.DE01","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,1380],"notes":"link etsy truoc: https://anotepad.com/notes/4hg8493d\nlink etsy sau: "},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.emailSubject = $('Set').all()[0].json.emailSubject.split('Etsy Conversation with ')[1]\n$input.item.json.buyerName = $input.item.json.emailSubject.split(' from ')[0]\n//Kiem tra tin nhan khach co Store ko\nif ($input.item.json.emailSubject.includes(' from ')) {\n  $input.item.json.buyerStore = $input.item.json.emailSubject.split(' from ')[1]\n  //Gan json ten store\n  $input.item.json.buyerStoreJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💈 Store:**\\\\n \" + \n$input.item.json.buyerStore + \"\\\"}},\";\n  //Gan json link ve store\n  $input.item.json.buyerStoreJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"View Shop\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/shop/\" + $input.item.json.buyerStore + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n}\n\n$input.item.json.buyerMess = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/conversations/')[2]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('>')[1]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('Reply')[0]\n// $input.item.json.buyerMess = JSON.stringify($input.item.json.buyerMess);\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(/\\n/g, \" \");\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(\"\\\"\", \" \");\n\n//Kiem tra tin nhan co listing ko\nif ($input.item.json.buyerMess.includes('etsy.com/listing/')) {\n  $input.item.json.buyerListing = $input.item.json.buyerMess.split('etsy.com/listing/')[1]\n  $input.item.json.buyerListing = $input.item.json.buyerListing.split('/')[0]\n  $input.item.json.buyerListingJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**🏷 Listing:**\\\\n \" + $input.item.json.buyerListing + \"\\\"}},\";\n    //Kiem tra co listing ko, neu ko co them , gan json bt\n    $input.item.json.buyerListingJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"ViewListing\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/listing/\" + $input.item.json.buyerListing + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n  \n}\n//Noi json lai thanh message push ve Lark\nif ($input.item.json.buyerListing && $input.item.json.buyerStore) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \",\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RgbShirt message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerListing) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RgbShirt message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerStore) {\n    $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RgbShirt message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RgbShirt message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n}\n\n\nreturn $input.item;"},"id":"eb9789b0-6838-4e64-ae7b-f04f645e5cf5","name":"Etsy.Conversation.OTB01","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,1520],"notes":"link etsy truoc: https://anotepad.com/notes/4hg8493d\nlink etsy sau: "},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/cea8a270-7e98-4dd2-b219-33148d5050ce","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🏷 Order ID:**\\n {{ $json[\"orderID\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**👤 Customer:**\\n {{ $json[\"buyerName\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🛒 Total Items:**\\n {{ $json[\"orderQuantity\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💈 Store:**\\n {{ $json[\"shopName\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💰 Order Value:**\\n {{ $json[\"orderTotal\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": false,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**📥 Order Detail:**\\n{{ $json[\"orderProductDetail\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"🎉 Digital Order: {{ $json[\"orderQuantity\"] }} items, {{ $json[\"orderTotal\"] }} from {{ $json[\"shopName\"] }} 🎉\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"e870ac0c-e2bc-45ce-b403-09b7c4569bb6","name":"Order Digital push","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[460,620]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/cea8a270-7e98-4dd2-b219-33148d5050ce","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🏷 Order ID:**\\n {{ $json[\"orderID\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**👤 Customer:**\\n {{ $json[\"buyerName\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🛒 Total Items:**\\n {{ $json[\"orderQuantity\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💈 Store:**\\n {{ $json[\"shopName\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💰 Order Value:**\\n {{ $json[\"orderTotal\"] }}\"\n                        }\n                    },\n        {\n          \"is_short\": true,\n          \"text\": {\n            \"tag\": \"lark_md\",\n            \"content\": \"**🚀 Ship Date:**\\n {{ $json[\"shipDate\"] }}\"\n          }\n        },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**📦 Shipment Address:**\\n {{ $json[\"shippingAdress\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": false,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**📥 Order Detail:**\\n  {{ $json[\"orderProductDetail\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"🎉 New Order: {{ $json[\"orderQuantity\"] }} items, {{ $json[\"orderTotal\"] }} from {{ $json[\"shopName\"] }} 🎉\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"569ceea0-dd0a-4865-8d7c-3d83b0461490","name":"Order Shirt push","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[460,980]},{"parameters":{"url":"https://open.larksuite.com/open-apis/bot/v2/hook/f10ed0c1-eeb6-4fd7-9e18-414ef0dd999d","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💈 Store:**\\n {{ $json[\"shop\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🏷 End card:**\\n {{ $json[\"card\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💰 Money:**\\n {{ $json[\"money\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"🎉 Deposit to: {{ $json[\"shop\"] }} with {{ $json[\"money\"] }} 🎉\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"152cc4a9-3362-4c7f-b639-1d01d8dc4717","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[140,1840]},{"parameters":{"url":"https://open.larksuite.com/open-apis/bot/v2/hook/f10ed0c1-eeb6-4fd7-9e18-414ef0dd999d","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💈 Store email:**\\n {{ $json[\"emailTo\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"🥹 {{ $json[\"emailSubject\"] }} 🥹\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"a42fade8-14b7-4b46-89ab-6557dbbead44","name":"HTTP Request1","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-140,2020]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"//Get order Total\n$input.item.json.orderTotal = $('Set').item.json.emailSubject.split('Etsy Order confirmation for: ')[1];\n$input.item.json.orderTotal = $input.item.json.orderTotal.split(' ')[0];\n\n//Get buyer Name\n$input.item.json.buyerName = $('Set').item.json.emailSubject.split(' from: ')[1];\n$input.item.json.buyerName = $input.item.json.buyerName.split(' (')[0];\n\n//Get Order ID\n$input.item.json.orderID = $('Set').item.json.emailSubject.split('(')[1];\n$input.item.json.orderID = $input.item.json.orderID.split(')')[0];\n\n//Get Orrder Quantity\n$input.item.json.orderQuantity = $('Set').item.json.emailContent.split('Congratulations on your Etsy sale of ')[1];\n$input.item.json.orderQuantity = $input.item.json.orderQuantity.split(' item')[0];\n\n//Get Shop Name\n$input.item.json.shopName = $('Set').item.json.emailContent.split('Shop: ')[1];\n$input.item.json.shopName = $input.item.json.shopName.split('\\n')[0];\n\n//Get Buyer Name\n$input.item.json.buyerName = $('Set').item.json.emailContent.split('<https://www.etsy.com/people/')[1];\n$input.item.json.buyerName = $input.item.json.buyerName.split('?')[0];\n\n//Get Buyer Email\n$input.item.json.buyerEmail = $('Set').item.json.emailContent.split('Send them an email <')[1];\n$input.item.json.buyerEmail = $input.item.json.buyerEmail.split('>')[0];\n$input.item.json.buyerEmail = $input.item.json.buyerEmail.replaceAll('mailto:', '');\n\n//Get Order Products list\n$input.item.json.orderProducts = $('Set').item.json.emailContent.split('<https://www.etsy.com/transaction/');\n//Remove first item\n$input.item.json.orderProducts.shift();\nlet i = 0;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].split('>')[1];\n  i++;\n} while (i < $input.item.json.orderProducts.length);\n\n//Get Order paid\n$input.item.json.orderPaid = $input.item.json.orderProducts[$input.item.json.orderProducts.length - 1].split('Order total')[1];\n//$input.item.json.orderPaid = $input.item.json.orderPaid.replaceAll('\\n', ' ');\n$input.item.json.orderPaid = $input.item.json.orderPaid.trim()\n\n//Beauty last order item detail\n$input.item.json.orderProducts[$input.item.json.orderProducts.length - 1] = $input.item.json.orderProducts[$input.item.json.orderProducts.length - 1].split('Order total')[0];\n//Beauty title\ni = 0;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].replaceAll('\\n',' ');\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].trim();\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n//Beauty order detail\ni = 1;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].split('Personalized item')[0];\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].trim();\n  let index01 = $input.item.json.orderProducts[i].indexOf(\"Shop\");\n  index01 = $input.item.json.orderProducts[i].substring(0,index01)\n  let index02 = $input.item.json.orderProducts[i].indexOf(\"Quantity:\");\n  index02 = $input.item.json.orderProducts[i].substring(index02,$input.item.json.orderProducts[i].length)\n  $input.item.json.orderProducts[i] = index01 + index02;\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n\n//Merch order detail to string\n$input.item.json.orderProductDetail = '';\ni = 0;\ndo {\n  $input.item.json.orderProductDetail += $input.item.json.orderProducts[i] + '\\n' + $input.item.json.orderProducts[i+1] + '\\n \\n ';\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n$input.item.json.orderProductDetail = $input.item.json.orderProductDetail.replaceAll('\\n', '\\\\n');\n$input.item.json.orderProductDetail = $input.item.json.orderProductDetail.trim()\n\n$input.item.json.orderProductDetail = $input.item.json.orderProductDetail.split('No returns or exchanges');\ni = 0;\ndo {\n  if ($input.item.json.orderProductDetail[i].includes(']')) {\n    $input.item.json.orderProductDetail[i] = $input.item.json.orderProductDetail[i].split(']')[1]\n    $input.item.json.orderProductDetail[i] = $input.item.json.orderProductDetail[i].trim()\n  }\n  i+=1;\n} while (i < $input.item.json.orderProductDetail.length);\n//Remove last items\n$input.item.json.orderProductDetail.pop()\n\nreturn $input.item;"},"id":"25104f81-fa12-4334-af8e-2330d95f2c2b","name":"Order Digital","type":"n8n-nodes-base.code","typeVersion":1,"position":[120,700]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"//Get Ship date\n$input.item.json.shipDate = $('Set').all()[0].json.emailSubject.split('Ship by ')[1];\n$input.item.json.shipDate = $input.item.json.shipDate.split(' - [')[0];\n\n//Get Order ID\n$input.item.json.orderID = $('Set').all()[0].json.emailSubject.split(', Order ')[1];\n$input.item.json.orderID = $input.item.json.orderID.replaceAll(']','');\n\n//Get Order Total\n$input.item.json.orderTotal = $('Set').all()[0].json.emailSubject.split(', Order ')[0];\n$input.item.json.orderTotal = $input.item.json.orderTotal.split('[')[1];\n\n//Get Orrder Quantity\n$input.item.json.orderQuantity = $('Set').all()[0].json.emailContent.split('Congratulations on your Etsy sale of ')[1];\n$input.item.json.orderQuantity = $input.item.json.orderQuantity.split(' item')[0];\n\n//Get Shop Name\n$input.item.json.shopName = $('Set').all()[0].json.emailContent.split('Shop: ')[1];\n$input.item.json.shopName = $input.item.json.shopName.split('\\n')[0];\n\n//Get Buyer Name\n$input.item.json.buyerName = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/people/')[1];\n$input.item.json.buyerName = $input.item.json.buyerName.split('?')[0];\n\n//Get Buyer Email\n$input.item.json.buyerEmail = $('Set').all()[0].json.emailContent.split('Send them an email <')[1];\n$input.item.json.buyerEmail = $input.item.json.buyerEmail.split('>')[0];\n$input.item.json.buyerEmail = $input.item.json.buyerEmail.replaceAll('mailto:', '');\n\n//Get Shipping Address\nif ($('Set').all()[0].json.emailContent.includes('United States')) {\n  $input.item.json.shippingAdress = $('Set').all()[0].json.emailContent.split('Shipping address')[1];\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress.replaceAll('\\n', ' ');\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress.replaceAll('*', '');\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress.trim();\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress.split('United States')[0];\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress.trim();\n  $input.item.json.shippingAdress = $input.item.json.shippingAdress + \", US\"\n} else {\n  $input.item.json.shippingAdress = 'International Shipping'\n}\n\n//Get Order Products list\n$input.item.json.orderProducts = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/transaction/');\n//Remove first item\n$input.item.json.orderProducts.shift();\nlet i = 0;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].split('>')[1];\n  i++;\n} while (i < $input.item.json.orderProducts.length);\n\n//Get Order paid\n$input.item.json.orderPaid = $input.item.json.orderProducts[$input.item.json.orderProducts.length - 1].split('Order total')[1];\n//$input.item.json.orderPaid = $input.item.json.orderPaid.replaceAll('\\n', ' ');\n$input.item.json.orderPaid = $input.item.json.orderPaid.trim()\n\n//Beauty last order item detail\n$input.item.json.orderProducts[$input.item.json.orderProducts.length - 1] = $input.item.json.orderProducts[$input.item.json.orderProducts.length - 1].split('Order total')[0];\n//Beauty title\ni = 0;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].replaceAll('\\n',' ');\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].trim();\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n//Beauty order detail\ni = 1;\ndo {\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].split('Personalized item')[0];\n  $input.item.json.orderProducts[i] = $input.item.json.orderProducts[i].trim();\n  let index01 = $input.item.json.orderProducts[i].indexOf(\"Shop\");\n  index01 = $input.item.json.orderProducts[i].substring(0,index01)\n  let index02 = $input.item.json.orderProducts[i].indexOf(\"Quantity:\");\n  index02 = $input.item.json.orderProducts[i].substring(index02,$input.item.json.orderProducts[i].length)\n  $input.item.json.orderProducts[i] = index01 + index02;\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n\n//Merch order detail to string\n$input.item.json.orderProductDetail = '';\ni = 0;\ndo {\n  $input.item.json.orderProductDetail += $input.item.json.orderProducts[i] + '\\n' + $input.item.json.orderProducts[i+1] + '\\n \\n ';\n  i+=2;\n} while (i < $input.item.json.orderProducts.length);\n$input.item.json.orderProductDetail = $input.item.json.orderProductDetail.replaceAll('\\n', '\\\\n');\n$input.item.json.orderProductDetail = $input.item.json.orderProductDetail.trim()\n\nconsole.log($input.item.json.orderProductDetail)\n\nreturn $input.item;"},"id":"790e01a8-0f88-47e7-a0dd-e26341351e10","name":"Order Shirt","type":"n8n-nodes-base.code","typeVersion":1,"position":[120,840]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"//Get Ship date\n$input.item.json.orderID = $('Set').all()[0].json.emailSubject.split('Order #')[1];\n$input.item.json.orderID = $input.item.json.orderID.split(')')[0];\n\n$input.item.json.orderTotal = $('Set').all()[0].json.emailContent.split('a refund of ')[1];\n$input.item.json.orderTotal = $input.item.json.orderTotal.split(' for order number')[0];\n\n$input.item.json.shop = $('Set').all()[0].json.emailContent.split('Transaction ID:')[0];\n$input.item.json.index = $input.item.json.shop.lastIndexOf('>');\n$input.item.json.shop = $input.item.json.shop.substring($input.item.json.index + 1, $input.item.json.shop.leght)\n$input.item.json.shop = $input.item.json.shop.trim()\n\nreturn $input.item;"},"id":"ef625c2b-0c42-4cc3-9d89-8913d63ee822","name":"Refund","type":"n8n-nodes-base.code","typeVersion":1,"position":[120,1000]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bot/v2/hook/cea8a270-7e98-4dd2-b219-33148d5050ce","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"msg_type\": \"interactive\",\n    \"card\": {\n        \"config\": {\n            \"wide_screen_mode\": true,\n            \"enable_forward\": true\n        },\n        \"elements\": [\n            {\n                \"tag\": \"div\",\n                \"fields\": [\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**🏷 Order ID:**\\n {{ $json[\"orderID\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💈 Store:**\\n {{ $json[\"shop\"] }}\"\n                        }\n                    },\n                    {\n                        \"is_short\": true,\n                        \"text\": {\n                            \"tag\": \"lark_md\",\n                            \"content\": \"**💰 Order Value:**\\n {{ $json[\"orderTotal\"] }}\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"header\": {\n            \"template\": \"green\",\n            \"title\": {\n                \"content\": \"🥹 Refund order: {{ $json[\"orderID\"] }}, {{ $json[\"orderTotal\"] }} from {{ $json[\"shop\"] }} 🥹\",\n                \"tag\": \"plain_text\"\n            }\n        }\n    }\n}","options":{}},"id":"d1b19ce0-588f-492c-a472-9d180a54d208","name":"Order refund push","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[460,1180]},{"parameters":{"dataType":"string","value1":"={{ $json[\"emailSubject\"] }}","rules":{"rules":[{"operation":"contains","value2":"Etsy Order confirmation"},{"operation":"contains","value2":"You made a sale on Etsy","output":1},{"operation":"contains","value2":"You have issued a refund","output":2}]}},"id":"3377ba18-aff0-4c1f-a9d2-011ab2f421d1","name":"Switch Order","type":"n8n-nodes-base.switch","typeVersion":1,"position":[-80,860],"notes":"0: Digital\n1: Shirt\n2: Refund"},{"parameters":{"dataType":"string","value1":"={{ $json[\"emailTo\"] }}","rules":{"rules":[{"operation":"contains","value2":"snguyenthihong1@gmail.com"},{"operation":"contains","value2":"mylittlesuitcase@hotmail.com","output":1},{"operation":"contains","value2":"Pdxot@outlook.com","output":2},{"operation":"contains","value2":"rockwoodprinting@outlook.com","output":3}]}},"id":"73814cf2-b831-45bb-a108-791735ee8b64","name":"Switch Conversation","type":"n8n-nodes-base.switch","typeVersion":1,"position":[-100,1380],"notesInFlow":false,"notes":"1. Etsy Order: \n- Digital: \"Etsy Order confirmation for\":  transaction@etsy.com\n- Physical: \"You made a sale on Etsy - Ship by\": transaction@etsy.com\n2. Etsy Conversation: \"Etsy Conversation with\": conversation@mail.etsy.com\n3. Deposit: \"Your funds of €1,206.19 EUR are on the way!\" support@etsy.com\n4.  Khách mở case: \"Etsy Support commented on your case\": noreply@etsy.com\n5. Bị Report: \"Notice of Intellectual Property Infringement\": noreply@etsy.com \n6. Đã điền Counter: \"We’ve processed your counter notice\": legal@etsy.com"},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bitable/v1/apps/basusWMkQKs4oizEv3IdwmTW5cb/tables/tbllED6JBrfYxc0s/records/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\": {\n  \"Order ID\": {{ $node[\"Convert Order Physical info to push Order Total Bitable\"].json[\"orderID\"] }},\n  \"Shop\": \"{{ $node[\"Order Shirt\"].json[\"shopName\"] }}\",\n  \"Type\": \"Physical\",\n  \"Quantity\": {{ $node[\"Convert Order Physical info to push Order Total Bitable\"].json[\"orderQuantity\"] }},\n  \"Value\": {{ $node[\"Convert Order Physical info to push Order Total Bitable\"].json[\"orderTotal\"] }},\n  \"Ship\": \"{{ $node[\"Order Shirt\"].json[\"shipDate\"] }}\",\n  \"Customer Email\": \"{{ $node[\"Order Shirt\"].json[\"buyerEmail\"] }}\"\n      }\n}","options":{}},"id":"8e56b72f-f779-4bc7-945b-e8667fc38626","name":"Push order Physical to Order Total","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[980,800]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/bitable/v1/apps/basusWMkQKs4oizEv3IdwmTW5cb/tables/tbllED6JBrfYxc0s/records/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json[\"app_access_token\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"fields\": {\n  \"Order ID\": {{ $node[\"Convert Order Digital info to push Order Total Bitable\"].json[\"orderID\"] }},\n  \"Shop\": \"{{ $node[\"Order Digital\"].json[\"shopName\"] }}\",\n  \"Type\": \"Digital\",\n  \"Quantity\": {{ $node[\"Convert Order Digital info to push Order Total Bitable\"].json[\"orderQuantity\"] }},\n  \"Value\": {{ $node[\"Convert Order Digital info to push Order Total Bitable\"].json[\"orderTotal\"] }},\n  \"Customer Email\": \"{{ $node[\"Order Digital\"].json[\"buyerEmail\"] }}\"\n      }\n}","options":{}},"id":"e8c30702-de8a-4e61-9d64-c5ba6b1f0177","name":"Push order Digital to Order Total","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[980,460]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.orderID = Number($('Order Digital').all()[0].json.orderID.replace(\"#\",\"\"));\n$input.item.json.orderTotal = Number($('Order Digital').all()[0].json.orderTotal.replaceAll(\"$\",\"\").replaceAll(\"€\",\"\"));\n$input.item.json.orderQuantity = Number($('Order Digital').all()[0].json.orderQuantity);\n\nreturn $input.item;"},"id":"3ddff51b-c512-4906-8677-f9faa7c6541e","name":"Convert Order Digital info to push Order Total Bitable","type":"n8n-nodes-base.code","typeVersion":1,"position":[720,460]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.orderID = Number($('Order Shirt').all()[0].json.orderID.replace(\"#\",\"\"));\n$input.item.json.orderTotal = Number($('Order Shirt').all()[0].json.orderTotal.replaceAll(\"$\",\"\").replaceAll(\"€\",\"\"));\n$input.item.json.orderQuantity = Number($('Order Shirt').all()[0].json.orderQuantity);\n\nreturn $input.item;"},"id":"403627e9-5c67-4de8-8499-435634f933e6","name":"Convert Order Physical info to push Order Total Bitable","type":"n8n-nodes-base.code","typeVersion":1,"position":[720,800]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"{    \"app_id\": \"cli_a31d441721f8500a\",     \"app_secret\": \"pgsa9rESeuH6ltJlMpR8EfbemxaJOnCu\"   }","options":{}},"id":"ee942248-e790-4f61-b198-83b0c913b36b","name":"Get token for Physical from Lark","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[460,800]},{"parameters":{"method":"POST","url":"https://open.larksuite.com/open-apis/auth/v3/app_access_token/internal","sendBody":true,"specifyBody":"json","jsonBody":"{    \"app_id\": \"cli_a31d441721f8500a\",     \"app_secret\": \"pgsa9rESeuH6ltJlMpR8EfbemxaJOnCu\"   }","options":{}},"id":"5e014f7a-c06d-42f4-a65c-ca3782659ed5","name":"Get token for Digital from Lark","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[460,460]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.emailSubject = $('Set').all()[0].json.emailSubject.split('Etsy Conversation with ')[1]\n$input.item.json.buyerName = $input.item.json.emailSubject.split(' from ')[0]\n//Kiem tra tin nhan khach co Store ko\nif ($input.item.json.emailSubject.includes(' from ')) {\n  $input.item.json.buyerStore = $input.item.json.emailSubject.split(' from ')[1]\n  //Gan json ten store\n  $input.item.json.buyerStoreJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💈 Store:**\\\\n \" + \n$input.item.json.buyerStore + \"\\\"}},\";\n  //Gan json link ve store\n  $input.item.json.buyerStoreJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"View Shop\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/shop/\" + $input.item.json.buyerStore + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n}\n\n$input.item.json.buyerMess = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/conversations/')[2]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('>')[1]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('Reply')[0]\n// $input.item.json.buyerMess = JSON.stringify($input.item.json.buyerMess);\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(/\\n/g, \" \");\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(\"\\\"\", \" \");\n\n//Kiem tra tin nhan co listing ko\nif ($input.item.json.buyerMess.includes('etsy.com/listing/')) {\n  $input.item.json.buyerListing = $input.item.json.buyerMess.split('etsy.com/listing/')[1]\n  $input.item.json.buyerListing = $input.item.json.buyerListing.split('/')[0]\n  $input.item.json.buyerListingJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**🏷 Listing:**\\\\n \" + $input.item.json.buyerListing + \"\\\"}},\";\n    //Kiem tra co listing ko, neu ko co them , gan json bt\n    $input.item.json.buyerListingJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"ViewListing\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/listing/\" + $input.item.json.buyerListing + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n  \n}\n//Noi json lai thanh message push ve Lark\nif ($input.item.json.buyerListing && $input.item.json.buyerStore) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \",\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RockwoodPrints message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerListing) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RockwoodPrints message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerStore) {\n    $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RockwoodPrints message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 RockwoodPrints message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n}\n\n\nreturn $input.item;"},"id":"2522b9c9-1c56-4453-b510-ca3607336364","name":"Etsy.Conversation.OTB05","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,1660],"notes":"link etsy truoc: https://anotepad.com/notes/4hg8493d\nlink etsy sau: "},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the\n// JSON of the item\n$input.item.json.emailSubject = $('Set').all()[0].json.emailSubject.split('Etsy Conversation with ')[1]\n$input.item.json.buyerName = $input.item.json.emailSubject.split(' from ')[0]\n//Kiem tra tin nhan khach co Store ko\nif ($input.item.json.emailSubject.includes(' from ')) {\n  $input.item.json.buyerStore = $input.item.json.emailSubject.split(' from ')[1]\n  //Gan json ten store\n  $input.item.json.buyerStoreJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💈 Store:**\\\\n \" + \n$input.item.json.buyerStore + \"\\\"}},\";\n  //Gan json link ve store\n  $input.item.json.buyerStoreJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"View Shop\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/shop/\" + $input.item.json.buyerStore + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n}\n\n$input.item.json.buyerMess = $('Set').all()[0].json.emailContent.split('<https://www.etsy.com/conversations/')[2]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('>')[1]\n$input.item.json.buyerMess = $input.item.json.buyerMess.split('Reply')[0]\n// $input.item.json.buyerMess = JSON.stringify($input.item.json.buyerMess);\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(/\\n/g, \" \");\n$input.item.json.buyerMess = $input.item.json.buyerMess.replaceAll(\"\\\"\", \" \");\n\n//Kiem tra tin nhan co listing ko\nif ($input.item.json.buyerMess.includes('etsy.com/listing/')) {\n  $input.item.json.buyerListing = $input.item.json.buyerMess.split('etsy.com/listing/')[1]\n  $input.item.json.buyerListing = $input.item.json.buyerListing.split('/')[0]\n  $input.item.json.buyerListingJsonLabel = \"{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**🏷 Listing:**\\\\n \" + $input.item.json.buyerListing + \"\\\"}},\";\n    //Kiem tra co listing ko, neu ko co them , gan json bt\n    $input.item.json.buyerListingJsonAction = \"{\\\"tag\\\":\\\"button\\\",\\\"text\\\":{\\\"content\\\":\\\"ViewListing\\\",\\\"tag\\\":\\\"lark_md\\\"},\\\"url\\\":\\\"https://etsy.com/listing/\" + $input.item.json.buyerListing + \"\\\",\\\"type\\\":\\\"default\\\",\\\"value\\\":{}}\"\n  \n}\n//Noi json lai thanh message push ve Lark\nif ($input.item.json.buyerListing && $input.item.json.buyerStore) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \",\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 SanSanthLTD message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerListing) {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerListingJsonLabe + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerListingJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 SanSanthLTD message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else if ($input.item.json.buyerStore) {\n    $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[ \" + $input.item.json.buyerStoreJsonLabel + \"{\\\"is_short\\\":false,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]},{\\\"actions\\\":[\" + $input.item.json.buyerStoreJsonAction + \"],\\\"tag\\\":\\\"action\\\"}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 SanSanthLTD message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n} else {\n  $input.item.json.messageJson = \"{\\\"msg_type\\\":\\\"interactive\\\",\\\"card\\\":{\\\"config\\\":{\\\"wide_screen_mode\\\":true,\\\"enable_forward\\\":true},\\\"elements\\\":[{\\\"tag\\\":\\\"div\\\",\\\"fields\\\":[{\\\"is_short\\\":true,\\\"text\\\":{\\\"tag\\\":\\\"lark_md\\\",\\\"content\\\":\\\"**💭Message:**\\\\n\" + $input.item.json.buyerMess + \"\\\"}}]}],\\\"header\\\":{\\\"template\\\":\\\"green\\\",\\\"title\\\":{\\\"content\\\":\\\"👋 SanSanthLTD message: \" + $input.item.json.emailSubject + \" 👋\\\",\\\"tag\\\":\\\"plain_text\\\"}}}}\"\n}\n\n// $input.item.json.messageJson = JSON.parse($input.item.json.messageJson);\n\n\nreturn $input.item;"},"id":"b9997396-b0a5-4daf-900f-7b027aff1258","name":"Etsy.Conversation.UK40","type":"n8n-nodes-base.code","typeVersion":1,"position":[160,1240],"notes":"link etsy truoc: https://anotepad.com/notes/4hg8493d\nlink etsy sau: "}],"connections":{"Set":{"main":[[{"node":"Switch Etsy Email","type":"main","index":0}]]},"Etsy Gmail Trigger":{"main":[[{"node":"Set","type":"main","index":0}]]},"Switch Etsy Email":{"main":[[{"node":"Switch Order","type":"main","index":0}],[{"node":"Switch Conversation","type":"main","index":0}],[{"node":"Etsy.Deposit","type":"main","index":0}],[{"node":"HTTP Request1","type":"main","index":0}]]},"Etsy.Conversation.DE01":{"main":[[{"node":"Push to Lark message1","type":"main","index":0}]]},"Etsy.Conversation.OTB01":{"main":[[{"node":"Push to Lark message1","type":"main","index":0}]]},"Etsy.Deposit":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Order Digital":{"main":[[{"node":"Order Digital push","type":"main","index":0},{"node":"Get token for Digital from Lark","type":"main","index":0}]]},"Order Shirt":{"main":[[{"node":"Order Shirt push","type":"main","index":0},{"node":"Get token for Physical from Lark","type":"main","index":0}]]},"Refund":{"main":[[{"node":"Order refund push","type":"main","index":0}]]},"Switch Order":{"main":[[{"node":"Order Digital","type":"main","index":0}],[{"node":"Order Shirt","type":"main","index":0}],[{"node":"Refund","type":"main","index":0}]]},"Switch Conversation":{"main":[[{"node":"Etsy.Conversation.UK40","type":"main","index":0}],[{"node":"Etsy.Conversation.DE01","type":"main","index":0}],[{"node":"Etsy.Conversation.OTB01","type":"main","index":0}],[{"node":"Etsy.Conversation.OTB05","type":"main","index":0}]]},"Convert Order Digital info to push Order Total Bitable":{"main":[[{"node":"Push order Digital to Order Total","type":"main","index":0}]]},"Convert Order Physical info to push Order Total Bitable":{"main":[[{"node":"Push order Physical to Order Total","type":"main","index":0}]]},"Get token for Physical from Lark":{"main":[[{"node":"Convert Order Physical info to push Order Total Bitable","type":"main","index":0}]]},"Get token for Digital from Lark":{"main":[[{"node":"Convert Order Digital info to push Order Total Bitable","type":"main","index":0}]]},"Etsy.Conversation.OTB05":{"main":[[{"node":"Push to Lark message1","type":"main","index":0}]]},"Etsy.Conversation.UK40":{"main":[[{"node":"Push to Lark message1","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Etsy Gmail Trigger":{"possibleDuplicates":["18a528ba0500ea25"],"lastTimeChecked":1693601986}},"pinData":{},"versionId":"43dac0a9-a3a8-4378-a316-4ce5a1e7d3a1","triggerCount":1,"tags":[{"createdAt":"2023-04-07T10:40:23.898Z","updatedAt":"2023-04-07T10:40:23.898Z","id":"13","name":"Talo Media"}]}