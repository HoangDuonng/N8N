{"createdAt":"2023-08-29T14:29:18.968Z","updatedAt":"2023-08-31T07:06:01.000Z","id":"496","name":"[CuongLV] WooCommerce","active":true,"nodes":[{"parameters":{"mode":"runOnceForEachItem","jsCode":"const orderContent = $('Webhook1').first().json.body;\n  // Convert to Lark Base format\n  const record =\n    {\n      msg_type: orderContent.msg_type,\n      card: orderContent.card\n    };\n\n  return record;\n"},"id":"01ffb174-72c3-4e44-bdd4-3e62d01b2d87","name":"Convert to Lark Message Card","type":"n8n-nodes-base.code","typeVersion":1,"position":[1160,900]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal/","sendBody":true,"specifyBody":"json","jsonBody":"={ \"app_id\" : \"{{ $input.item.json[\"appId\"] }}\", \"app_secret\" : \"{{ $input.item.json[\"appSecret\"] }}\" }","options":{}},"id":"afb2bbb1-cae9-4c89-9d1d-3f0ef5752acd","name":"Get Lark tenant access token","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[920,480]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bot/v2/hook/a87d9a04-4d77-4a9f-ab4f-4def2d66dd7b","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($input.item.json) }}","options":{}},"id":"0aa3b9cc-ca56-482c-9de5-638bab27f258","name":"[Lark] Send noti to group chat","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1420,900]},{"parameters":{"method":"POST","url":"=https://open.larksuite.com/open-apis/bitable/v1/apps/{{ $json[\"configs\"][\"baseId\"] }}/tables/{{  $json[\"configs\"][\"tableId\"]}}/records/batch_create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $node[\"Get Lark tenant access token\"].json.tenant_access_token }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"records\":{{ JSON.stringify($json[\"records\"]) }}}","options":{}},"id":"b6aec972-9c11-4866-9fd7-62f38dfe8f85","name":"[SMS Log] Add records to Bitable","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[2100,340]},{"parameters":{},"id":"c6efbfb8-8c84-4cb2-8f1c-5003478d013b","name":"Start Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[300,720]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"if (\n  ($('getBankData').item.json.result.transactionType.type === '-' &&\n    $input.item.json.enableOutgoing) ||\n  ($('getBankData').item.json.result.transactionType.type === '+' &&\n    $input.item.json.enableIncoming)\n) {\n  const data = $('getBankData').first().json.result;\n\n  let message = [];\n\n  message.push(\n    `<b>${data.bankName.toUpperCase()}-${data.receiverAccount} (${\n      data.transactionType.type\n    }) ${data.transactionAmount.amountText}VND</b>\\n`,\n    `<b>Ngân hàng:</b> ${data.bankName.toUpperCase()}`,\n    `<b>Số tài khoản:</b> ${data.receiverAccount}`,\n    `<b>Số dư thay đổi:</b> ${data.transactionType.type} ${data.transactionAmount.amountText} VND`\n  );\n\n  // Add balance\n  if ($input.item.json.enableBalance) {\n    message.push(`<b>Số dư tạm tính:</b> ${data.balance.amountText} VND`);\n  }\n\n  message.push(`<b>Nội dung:</b>\\n ${data.transactionMessage}`);\n\n  // Check transaction ID\n  if (data.transactionId) {\n    message.push(`<b>Mã giao dịch:</b> ${data.transactionId}`);\n  }\n\n  message.push(`<b>Thời gian nhận:</b> ${data.receivedTime.text}`);\n\n  return {\n    json: {\n      isSend: true,\n      botToken: $input.item.json.botToken,\n      payload: {\n        chat_id: $input.item.json.chatId,\n        parse_mode: 'HTML',\n        text: message.join('\\n'),\n      },\n    },\n  };\n}\n\nreturn {\n  json: {\n    isSend: false,\n  },\n};\n"},"id":"61534525-7393-4e9f-89ab-42d01bcbc2fe","name":"Create Telegram Message","type":"n8n-nodes-base.code","typeVersion":1,"position":[1100,1740]},{"parameters":{"method":"POST","url":"=https://api.telegram.org/bot{{ $input.item.json.botToken }}/sendMessage ","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($input.item.json.payload) }}","options":{}},"id":"42cc9bfd-954c-4cf6-8af2-1664b76091c7","name":"Send to Telegram chat","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1560,1660]},{"parameters":{"values":{"string":[{"name":"appId","value":"cli_a464b87468f89010"},{"name":"appSecret","value":"eA6Lcewgea6JZk0BVa18shQlOvCJLWJb"}]},"options":{}},"id":"6cae2c9a-3c44-4132-962a-37ffe4468d2f","name":"Set Lark Configs","type":"n8n-nodes-base.set","typeVersion":2,"position":[720,480]},{"parameters":{"values":{"string":[{"name":"customBotURL","value":"https://open.larksuite.com/open-apis/bot/v2/hook/a87d9a04-4d77-4a9f-ab4f-4def2d66dd7b"}]},"options":{}},"id":"7743d269-ac46-4339-adae-d23275527576","name":"Set Lark Mess Config","type":"n8n-nodes-base.set","typeVersion":2,"position":[720,900]},{"parameters":{},"id":"091fd6fe-2c4b-4b9a-bd9c-ba1ae4e6b640","name":"Start Lark Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[520,480]},{"parameters":{},"id":"32caaeb7-b136-4c72-b02f-45e4c0296f54","name":"Start Lark Base","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1140,340]},{"parameters":{},"id":"5c2db8c6-40e2-4597-b06a-aeb1cbaa9b47","name":"Start Lark Mess","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[520,900]},{"parameters":{},"id":"c4718cd1-ac95-4c6e-86f0-4a8419005269","name":"Start Telegram Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[300,1660]},{"parameters":{"values":{"string":[{"name":"botToken","value":"6141412510:AAEVEPZcCa7Hehbb9pfnX7M9cpd0f5rK1q4"},{"name":"chatId","value":"-1001958985351"}],"boolean":[{"name":"enableBalance","value":true},{"name":"enableOTP"},{"name":"enableOutgoing","value":true},{"name":"enableIncoming","value":true}]},"options":{}},"id":"01d06a73-762d-450a-b47e-5fe9a8278dcd","name":"Set Telegram Config","type":"n8n-nodes-base.set","typeVersion":2,"position":[500,1540]},{"parameters":{},"id":"6dfbd2e8-77e3-4de1-ad79-397c7e7b126c","name":"Start Lark Base Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1580,340]},{"parameters":{},"id":"34eff878-7496-4b8b-9a46-88d9dae945f4","name":"Start Lark Mess Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[920,900]},{"parameters":{},"id":"295b8397-87fd-42e2-93f7-a28b961a0095","name":"Start Telegram Mess Actions","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[700,1660]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const smsContent = $('Webhook1').first().json.body;\n\nlet message = [];\n\nmessage.push(\n  `<b>${smsContent.from.toUpperCase()}</b>\\n`,\n  `${smsContent.text.toString()}`\n);\n\nreturn {\n  json: {\n    botToken: $input.item.json.botToken,\n    payload: {\n      chat_id: $input.item.json.chatId,\n      parse_mode: 'HTML',\n      text: message.join('\\n'),\n    },\n  },\n};\n"},"id":"dd447988-ad32-4c01-bacc-2ac6f9cbaef4","name":"Create Telegram Message for OTP","type":"n8n-nodes-base.code","typeVersion":1,"position":[1100,1580]},{"parameters":{"values":{"string":[{"name":"baseId","value":"AlIPbkvRSagthssYwbdlbwILgXz"},{"name":"tableId","value":"tbl1lOj3FLJjFI9B"}]},"options":{}},"id":"3f6717e8-d734-4ebc-929b-d505a2eab172","name":"Set Lark Base Config1","type":"n8n-nodes-base.set","typeVersion":2,"position":[1360,340]},{"parameters":{"values":{"string":[{"name":"botToken","value":"6380831923:AAFzYGZTFmXbqKWgNu6Drj6IbERm2j9XYQ8"},{"name":"chatId","value":"-1001958985351"}],"boolean":[{"name":"enableBalance","value":true},{"name":"enableOTP"},{"name":"enableOutgoing","value":true},{"name":"enableIncoming","value":true}]},"options":{}},"id":"cbf470d3-1e9a-4509-a861-8aac2cc17b1a","name":"Set Telegram Config1","type":"n8n-nodes-base.set","typeVersion":2,"position":[500,1780]},{"parameters":{"conditions":{"boolean":[{"value1":"={{ $input.item.json.isSend }}","value2":true}]}},"id":"f3fc00ae-899a-4680-86f1-5ef3c0c33546","name":"ifSend2","type":"n8n-nodes-base.if","typeVersion":1,"position":[1320,1740]},{"parameters":{"values":{"string":[{"name":"botToken","value":"6319174707:AAGXbX_bYMcHUTK0gD6WT159QUL3RqMJ_lo"},{"name":"chatId","value":"-1001958985351"}],"boolean":[{"name":"enableBalance","value":true},{"name":"enableOTP"},{"name":"enableOutgoing","value":true},{"name":"enableIncoming","value":true}]},"options":{}},"id":"d248bfcb-4257-4d50-a8b8-d22a9930306b","name":"Set Telegram Config2","type":"n8n-nodes-base.set","typeVersion":2,"position":[500,1980]},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook1').item.json.body.text }}","operation":"contains","value2":"OTP"}],"boolean":[{"value1":"={{ $input.item.json.enableOTP }}","value2":true}]}},"id":"0a3467ae-e882-4d51-aafb-53b707247abd","name":"ifOTPTelegram","type":"n8n-nodes-base.if","typeVersion":1,"position":[880,1660]},{"parameters":{"httpMethod":"POST","path":"trucmaitram","options":{}},"id":"cbee9a91-f765-4f5d-bcee-a74196037dc4","name":"Webhook1","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[60,720],"webhookId":"b459d9da-c462-43e0-880c-12b8d6304763"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const orderContent = $('Webhook1').first().json.body;\nconsole.log(`orderContent`, orderContent)\n  // Convert to Lark Base format\n  const records = [\n    {\n      fields: {\n        Name: orderContent.total.toString(),\n        Id: orderContent.id.toString(),\n        // 'Transaction Type': 'OTP',\n        // 'Transaction Message': smsContent.text.toString(),\n        // 'Original Message': smsContent.text.toString(),\n        // 'Time received': smsContent.sentStamp,\n      },\n    },\n  ];\n\n  return {\n    json: {\n      records,\n      configs: {\n        baseId: $input.item.json.baseId,\n        tableId: $input.item.json.tableId,\n      },\n    },\n  };\n"},"id":"db871c72-6e4f-4c7a-91fd-3f10555829f4","name":"Convert to Lark Base format OTP","type":"n8n-nodes-base.code","typeVersion":1,"position":[1820,340]}],"connections":{"Convert to Lark Message Card":{"main":[[{"node":"[Lark] Send noti to group chat","type":"main","index":0}]]},"Get Lark tenant access token":{"main":[[{"node":"Start Lark Base","type":"main","index":0}]]},"Create Telegram Message":{"main":[[{"node":"ifSend2","type":"main","index":0}]]},"Set Lark Configs":{"main":[[{"node":"Get Lark tenant access token","type":"main","index":0}]]},"Set Lark Mess Config":{"main":[[{"node":"Start Lark Mess Actions","type":"main","index":0}]]},"Start Lark Actions":{"main":[[{"node":"Set Lark Configs","type":"main","index":0}]]},"Start Lark Base":{"main":[[{"node":"Set Lark Base Config1","type":"main","index":0}]]},"Start Lark Mess":{"main":[[{"node":"Set Lark Mess Config","type":"main","index":0}]]},"Start Telegram Actions":{"main":[[{"node":"Set Telegram Config","type":"main","index":0},{"node":"Set Telegram Config1","type":"main","index":0},{"node":"Set Telegram Config2","type":"main","index":0}]]},"Set Telegram Config":{"main":[[{"node":"Start Telegram Mess Actions","type":"main","index":0}]]},"Start Lark Base Actions":{"main":[[{"node":"Convert to Lark Base format OTP","type":"main","index":0}]]},"Start Lark Mess Actions":{"main":[[{"node":"Convert to Lark Message Card","type":"main","index":0}]]},"Start Telegram Mess Actions":{"main":[[{"node":"ifOTPTelegram","type":"main","index":0}]]},"Create Telegram Message for OTP":{"main":[[{"node":"Send to Telegram chat","type":"main","index":0}]]},"Set Lark Base Config1":{"main":[[{"node":"Start Lark Base Actions","type":"main","index":0}]]},"Set Telegram Config1":{"main":[[{"node":"Start Telegram Mess Actions","type":"main","index":0}]]},"ifSend2":{"main":[[{"node":"Send to Telegram chat","type":"main","index":0}]]},"Set Telegram Config2":{"main":[[{"node":"Start Telegram Mess Actions","type":"main","index":0}]]},"ifOTPTelegram":{"main":[[{"node":"Create Telegram Message for OTP","type":"main","index":0}],[{"node":"Create Telegram Message","type":"main","index":0}]]},"Start Actions":{"main":[[{"node":"Start Lark Actions","type":"main","index":0},{"node":"Start Lark Mess","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"Start Actions","type":"main","index":0}]]},"Convert to Lark Base format OTP":{"main":[[{"node":"[SMS Log] Add records to Bitable","type":"main","index":0}]]}},"settings":{},"staticData":null,"pinData":{},"versionId":"fe3a4d22-751c-46a0-99da-f9104fec5492","triggerCount":1,"tags":[]}